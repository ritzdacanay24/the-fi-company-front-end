<!-- Standalone AGS Serial Form -->
<app-public-form-wrapper
    *ngIf="!isEmbedded"
    pageTitle="AGS Serial Creation"
    pageDescription="Create and track AGS (American Gaming Systems) gaming machine assets with automated serial generation, EyeFi validation, and work order integration"
    pageIcon="mdi-card-account-details-star"
    formTitle="Access Required"
    formDescription="Please authenticate to access the AGS Serial Generator. You can login using your username with password, or simply scan your employee card number."
    (authenticationComplete)="onAuthenticationComplete($event)"
    (userLoggedOut)="onUserLoggedOut()">

  <!-- Success Message -->
  <div *ngIf="showSuccessMessage" class="success-overlay">
    <div class="container">
      <div class="row justify-content-center">
        <div class="col-md-8 col-lg-6">
          <div class="card border-0 shadow-lg">
            <div class="card-body p-5 text-center">
              <div class="success-icon mb-4">
                <i class="mdi mdi-check-circle text-success" style="font-size: 5rem;"></i>
              </div>
              <h3 class="fw-bold text-success mb-3">AGS Serial Created Successfully!</h3>
              <p class="text-muted mb-4 fs-5">
                Your AGS serial record has been created and saved to the system.
              </p>
              
              <!-- Asset Summary -->
              <div class="alert alert-success bg-success bg-opacity-10 border-success">
                <h6 class="fw-bold mb-3 text-success">
                  <i class="mdi mdi-information me-1"></i>
                  Record Details
                </h6>
                <div class="row text-start">
                  <!-- AGS Serial Number -->
                  <div class="col-md-6" *ngIf="createdAssetData?.generated_SG_asset">
                    <strong>AGS Serial:</strong> 
                    <span class="badge bg-primary ms-1">{{ createdAssetData.generated_SG_asset }}</span>
                  </div>
                  
                  <!-- EyeFi Serial -->
                  <div class="col-md-6" *ngIf="createdAssetData?.serialNumber">
                    <strong>EyeFi Serial:</strong>
                    <span class="badge bg-info ms-1">{{ createdAssetData.serialNumber }}</span>
                  </div>
                  
                  <!-- Inspector -->
                  <div class="col-md-6">
                    <strong>Inspector:</strong> {{ createdAssetData?.inspectorName || currentUser?.full_name }}
                  </div>
                  
                  <!-- Timestamp -->
                  <div class="col-md-6">
                    <strong>Created On:</strong> 
                    <span *ngIf="createdAssetData?.timeStamp">{{ formatTimestamp(createdAssetData.timeStamp) }}</span>
                  </div>
                  
                  <!-- AGS Part Number -->
                  <div class="col-md-6" *ngIf="createdAssetData?.sgPartNumber">
                    <strong>AGS Part:</strong> {{ createdAssetData.sgPartNumber }}
                  </div>
                  
                  <!-- Work Order Number -->
                  <div class="col-md-6" *ngIf="createdAssetData?.poNumber">
                    <strong>Work Order:</strong> {{ createdAssetData.poNumber }}
                  </div>
                  
                  <!-- Property Site -->
                  <div class="col-md-6" *ngIf="createdAssetData?.property_site">
                    <strong>Property Site:</strong> {{ createdAssetData.property_site }}
                  </div>
                </div>
              </div>
              
              <div class="d-flex flex-column flex-sm-row gap-3 justify-content-center mt-4">
                <button class="btn btn-success btn-lg" (click)="printLabel()">
                  <i class="mdi mdi-printer me-2"></i>
                  Print Label
                </button>
                <button class="btn btn-primary btn-lg" (click)="createAnother()">
                  <i class="mdi mdi-plus me-2"></i>
                  Create Another Serial
                </button>
                <button class="btn btn-outline-danger" (click)="logout()">
                  <i class="mdi mdi-logout me-2"></i>
                  Log Off
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- AGS Form -->
  <div *ngIf="!showSuccessMessage" class="row justify-content-center">
    <div class="col-lg-10 col-xl-10">
      
      <!-- Unified AGS Form Card -->
      <div class="card border-0 shadow-lg">
        <div class="card-header border-bottom">
          <div class="d-flex align-items-center">
            <div class="me-3">
              <div class="bg-success bg-gradient rounded-circle d-flex align-items-center justify-content-center"
                   style="width: 50px; height: 50px;">
                <i class="mdi mdi-plus text-white fs-5"></i>
              </div>
            </div>
            <div>
              <h4 class="mb-1 text-success">Create New AGS Serial</h4>
              <p class="text-muted mb-0">Fill out the form below to create a new AGS serial record with automatic serial number generation</p>
            </div>
          </div>
        </div>
        
        <div class="card-body p-4">
          <!-- Info Alert -->
          <div class="alert alert-primary border-primary border-opacity-25 bg-primary bg-opacity-10 mb-4" role="alert">
            <div class="d-flex align-items-start">
              <i class="mdi mdi-information-outline text-primary me-3 mt-1 fs-5"></i>
              <div>
                <h6 class="alert-heading text-primary mb-2">Creating a New AGS Serial</h6>
                <p class="mb-2">
                  This form creates asset records for <strong>AGS</strong> (American Gaming Systems) gaming machines. 
                  Serial numbers are <strong>automatically generated</strong> upon submission. All fields marked with an asterisk (*) are required.
                </p>
                <div class="row g-2 small">
                  <div class="col-md-6">
                    <i class="mdi mdi-check-circle text-primary me-1"></i>
                    Auto-generated serial numbers
                  </div>
                  <div class="col-md-6">
                    <i class="mdi mdi-shield-check text-success me-1"></i>
                    EyeFi serial validation
                  </div>
                  <div class="col-md-6">
                    <i class="mdi mdi-file-document text-info me-1"></i>
                    Work order integration
                  </div>
                  <div class="col-md-6">
                    <i class="mdi mdi-history text-warning me-1"></i>
                    Complete audit trail
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- AGS Form Component -->
          <app-ags-serial-form 
            *ngIf="isAuthenticated"
            [submitted]="submitted"
            (setFormEmitter)="setFormEmitter($event)">
          </app-ags-serial-form>
        </div>

        <div class="card-footer bg-light border-top d-flex justify-content-between p-3">
          <button class="btn btn-outline-secondary" type="button" (click)="resetForm()" [disabled]="isLoading">
            <i class="mdi mdi-refresh me-1"></i>Reset Form
          </button>
          <button class="btn btn-primary" type="button" (click)="onSubmit()" 
                  [disabled]="!form || form.invalid || isLoading">
            @if (isLoading) {
              <span class="spinner-border spinner-border-sm me-2" role="status"></span>
              Creating Serial...
            } @else {
              <i class="mdi mdi-check me-1"></i>
              Create AGS Serial
            }
          </button>
        </div>
      </div>

      <!-- Help Section -->
      <div class="card shadow-sm border-0 mt-4">
        <div class="card-header bg-light">
          <h6 class="mb-0">
            <i class="mdi mdi-help-circle text-info me-2"></i>Need Help?
          </h6>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-4 mb-3">
              <div class="d-flex align-items-start">
                <i class="mdi mdi-star text-warning me-2 mt-1"></i>
                <div>
                  <strong>Required Fields</strong>
                  <p class="text-muted small mb-0">All fields marked with an asterisk (*) must be completed before submission</p>
                </div>
              </div>
            </div>
            <div class="col-md-4 mb-3">
              <div class="d-flex align-items-start">
                <i class="mdi mdi-barcode text-primary me-2 mt-1"></i>
                <div>
                  <strong>EyeFi Serial</strong>
                  <p class="text-muted small mb-0">Select an available EyeFi serial number from the dropdown - validated to prevent duplicates</p>
                </div>
              </div>
            </div>
            <div class="col-md-4 mb-3">
              <div class="d-flex align-items-start">
                <i class="mdi mdi-clock-fast text-success me-2 mt-1"></i>
                <div>
                  <strong>Auto-Generated</strong>
                  <p class="text-muted small mb-0">AGS serial numbers are automatically created upon successful submission</p>
                </div>
              </div>
            </div>
            <div class="col-md-12 mt-2">
              <div class="alert alert-info mb-0">
                <i class="mdi mdi-information-outline me-2"></i>
                <strong>AGS (American Gaming Systems)</strong> - This form tracks gaming machine assets including part numbers, work orders, property sites, and EyeFi serial integration with complete audit history.
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</app-public-form-wrapper>

<!-- Embedded mode: Form only (no wrapper, no cards, no submit button) -->
<div *ngIf="isEmbedded">
  <!-- Success Message for embedded mode -->
  <div *ngIf="showSuccessMessage" class="alert alert-success">
    <h4 class="alert-heading">AGS Serial Created Successfully!</h4>
    <p *ngIf="createdAssetData?.generated_SG_asset">
      AGS Serial: <strong class="badge bg-primary">{{ createdAssetData.generated_SG_asset }}</strong>
    </p>
    <button class="btn btn-primary" (click)="createAnother()">Create Another</button>
  </div>

  <!-- Pure form content for embedded mode (parent handles submission) -->
  <div *ngIf="!showSuccessMessage">
    <app-ags-serial-form
      (setFormEmitter)="setFormEmitter($event)"
      [submitted]="submitted">
    </app-ags-serial-form>
  </div>
</div>
