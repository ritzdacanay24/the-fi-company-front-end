<div class="offcanvas-header bg-primary text-white">
  <h4 class="offcanvas-title">
    <i class="mdi mdi-cog me-2"></i>
    Display Settings
  </h4>
  <button type="button" class="btn-close btn-close-white" aria-label="Close" (click)="onClose()"></button>
</div>

<div class="offcanvas-body" style="height: calc(100vh - 60px); overflow-y: auto; overflow-x: hidden; padding-bottom: 2rem;">
  <!-- Display Mode Settings -->
  <div class="settings-section mb-4">
    <h5 class="settings-title">
      <i class="mdi mdi-monitor me-2 text-primary"></i>
      Display Mode
    </h5>
    <p class="text-muted small mb-3">Choose how priority orders are displayed on screen</p>
    
    <div class="row g-2">
      <div class="col-6" *ngFor="let mode of displayModes">
        <div class="card h-100" 
             [class.border-primary]="displayMode === mode.value"
             [class.bg-primary]="displayMode === mode.value"
             [class.text-white]="displayMode === mode.value"
             style="cursor: pointer;"
             (click)="onDisplayModeChange(mode.value)">
          <div class="card-body p-2 text-center">
            <i class="mdi {{ mode.icon }} fs-4 mb-1" 
               [class.text-primary]="displayMode !== mode.value"
               [class.text-white]="displayMode === mode.value"></i>
            <h6 class="card-title mb-1 small">{{ mode.label }}</h6>
            <p class="card-text" style="font-size: 0.7rem; line-height: 1.2; margin-bottom: 0; opacity: 0.8;">{{ mode.description }}</p>
            <i class="mdi mdi-check-circle position-absolute top-0 end-0 m-2" 
               *ngIf="displayMode === mode.value"
               style="color: #fff;"></i>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Card Layout Settings -->
  <div class="settings-section mb-4" *ngIf="displayMode !== 'single'">
    <h5 class="settings-title">
      <i class="mdi mdi-card-multiple-outline me-2 text-primary"></i>
      Card Layout Style
    </h5>
    <p class="text-muted small mb-3">Choose how information is displayed on each priority card</p>
    
    <div class="row g-2">
      <div class="col-6" *ngFor="let layout of cardLayouts">
        <div class="card h-100" 
             [class.border-success]="cardLayout === layout.value"
             [class.bg-success]="cardLayout === layout.value"
             [class.text-white]="cardLayout === layout.value"
             style="cursor: pointer;"
             (click)="onCardLayoutChange(layout.value)">
          <div class="card-body p-2 text-center">
            <i class="mdi {{ layout.icon }} fs-4 mb-1" 
               [class.text-success]="cardLayout !== layout.value"
               [class.text-white]="cardLayout === layout.value"></i>
            <h6 class="card-title mb-1 small">{{ layout.label }}</h6>
            <p class="card-text" style="font-size: 0.7rem; line-height: 1.2; margin-bottom: 0; opacity: 0.8;">{{ layout.description }}</p>
            <i class="mdi mdi-check-circle position-absolute top-0 end-0 m-2" 
               *ngIf="cardLayout === layout.value"
               style="color: #fff;"></i>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Auto-Refresh Settings -->
  <div class="settings-section mb-4">
    <h5 class="settings-title">
      <i class="mdi mdi-timer me-2 text-primary"></i>
      Auto-Refresh Interval
    </h5>
    <p class="text-muted small mb-3">Set how often the display updates automatically</p>
    
    <div class="list-group">
      <label *ngFor="let interval of availableRefreshIntervals" 
             class="list-group-item list-group-item-action d-flex align-items-center"
             [class.active]="refreshInterval === interval.value"
             style="cursor: pointer;">
        <input type="radio" 
               class="form-check-input me-3" 
               [value]="interval.value"
               [(ngModel)]="refreshInterval"
               (change)="onRefreshIntervalChange(interval.value)"
               name="refreshInterval">
        <div class="flex-grow-1">
          <div class="d-flex align-items-center">
            <i class="mdi me-2" 
               [class.mdi-timer]="interval.value > 0"
               [class.mdi-hand-back-right]="interval.value === 0"></i>
            <strong>{{ interval.label }}</strong>
          </div>
          <small class="text-muted" *ngIf="interval.value > 0">
            Updates every {{ interval.value / 1000 }} seconds
          </small>
          <small class="text-muted" *ngIf="interval.value === 0">
            Only refresh when manually triggered
          </small>
        </div>
        <span class="badge bg-secondary ms-2" *ngIf="refreshInterval === interval.value && refreshCountdown && interval.value > 0">
          {{ refreshCountdown }}
        </span>
      </label>
    </div>
  </div>

  <!-- Theme Settings -->
  <div class="settings-section mb-4">
    <h5 class="settings-title">
      <i class="mdi mdi-theme-light-dark me-2 text-primary"></i>
      Theme & LED Protection
    </h5>
    <p class="text-muted small mb-3">Configure theme and automatic switching to prevent LED screen burn-in</p>
    
    <div class="card">
      <div class="card-body p-3">
        <!-- Current Theme Display -->
        <div class="row mb-3">
          <div class="col-6">
            <div class="text-center">
              <i class="mdi mdi-brightness-6 fs-3" 
                 [class.text-warning]="currentTheme === 'light'"
                 [class.text-info]="currentTheme === 'dark'"></i>
              <div class="small text-muted">Current Theme</div>
              <div class="fw-bold">{{ getCurrentThemeLabel() }}</div>
            </div>
          </div>
          <div class="col-6">
            <div class="text-center">
              <i class="mdi mdi-timer-outline fs-3"
                 [class.text-success]="autoSwitchEnabled"
                 [class.text-muted]="!autoSwitchEnabled"></i>
              <div class="small text-muted">Auto Switch</div>
              <div class="fw-bold">{{ autoSwitchEnabled ? getSwitchIntervalLabel() : 'Disabled' }}</div>
              <div class="small text-primary" *ngIf="autoSwitchEnabled && switchCountdown">
                Next: {{ switchCountdown }}
              </div>
            </div>
          </div>
        </div>

        <!-- Manual Theme Toggle -->
        <div class="mb-3">
          <label class="form-label small fw-bold">
            <i class="mdi mdi-palette me-1"></i>
            Theme Selection
          </label>
          <div class="row g-2">
            <div class="col-4" *ngFor="let theme of getAvailableThemes()">
              <button class="btn w-100 theme-btn" 
                      [class.active]="currentTheme === theme.value"
                      [class.btn-warning]="theme.value === 'light' && currentTheme === theme.value"
                      [class.btn-outline-warning]="theme.value === 'light' && currentTheme !== theme.value"
                      [class.btn-dark]="theme.value === 'dark' && currentTheme === theme.value"
                      [class.btn-outline-dark]="theme.value === 'dark' && currentTheme !== theme.value"
                      [class.btn-primary]="(theme.value === 'dark-vibrant' || theme.value === 'midnight' || theme.value === 'neon') && currentTheme === theme.value"
                      [class.btn-outline-primary]="(theme.value === 'dark-vibrant' || theme.value === 'midnight' || theme.value === 'neon') && currentTheme !== theme.value"
                      (click)="onManualThemeChange(theme.value)"
                      [title]="theme.label">
                <span class="theme-icon">{{ theme.icon }}</span>
                <div class="theme-label">{{ theme.label }}</div>
              </button>
            </div>
          </div>
          <div class="form-text small">Choose your preferred color theme</div>
        </div>

        <!-- Auto-Switch Settings -->
        <div class="form-check form-switch mb-3">
          <input class="form-check-input" 
                 type="checkbox" 
                 id="autoSwitchEnabled"
                 [(ngModel)]="autoSwitchEnabled"
                 (change)="onAutoSwitchToggle()">
          <label class="form-check-label" for="autoSwitchEnabled">
            <i class="mdi mdi-autorenew me-1"></i>
            Enable Automatic Theme Switching
          </label>
          <div class="form-text small">
            <i class="mdi mdi-shield-check me-1 text-success"></i>
            Prevents LED screen burn-in by alternating themes
          </div>
        </div>

        <!-- Switch Interval Settings -->
        <div *ngIf="autoSwitchEnabled" class="mb-3">
          <label for="switchInterval" class="form-label small fw-bold">
            <i class="mdi mdi-clock-outline me-1"></i>
            Switch Interval
          </label>
          <select class="form-select"
                  id="switchInterval"
                  [(ngModel)]="switchIntervalMinutes"
                  (change)="onSwitchIntervalChange(switchIntervalMinutes)">
            <option *ngFor="let interval of getThemeIntervalOptions()" 
                    [value]="interval.value">
              {{ interval.label }}
            </option>
          </select>
          <div class="form-text small">How often to automatically switch between light and dark themes</div>
        </div>

        <!-- LED Protection Info -->
        <div class="alert alert-info p-2 mb-0" *ngIf="autoSwitchEnabled">
          <i class="mdi mdi-information me-1"></i>
          <small>
            <strong>LED Protection Active:</strong> Theme will automatically switch every {{ getSwitchIntervalLabel().toLowerCase() }} 
            to prevent static content burn-in on LED displays.
          </small>
        </div>
      </div>
    </div>
  </div>

  <!-- Zoom Settings -->
  <div class="settings-section mb-4">
    <h5 class="settings-title">
      <i class="mdi mdi-magnify me-2 text-primary"></i>
      Display Zoom
    </h5>
    <p class="text-muted small mb-3">Adjust the display size for better visibility on different screens</p>
    
    <div class="card">
      <div class="card-body p-3">
        <!-- Current Zoom Display -->
        <div class="text-center mb-3">
          <i class="mdi mdi-magnify fs-3 text-primary"></i>
          <div class="small text-muted">Current Zoom</div>
          <div class="fw-bold">{{ getCurrentZoomLabel() }}</div>
        </div>

        <!-- Quick Zoom Controls -->
        <div class="row g-2 mb-3">
          <div class="col-4">
            <button class="btn btn-outline-secondary w-100" 
                    (click)="onZoomOut()">
              <i class="mdi mdi-magnify-minus"></i>
              <small class="d-block">Zoom Out</small>
            </button>
          </div>
          <div class="col-4">
            <button class="btn btn-outline-primary w-100" 
                    (click)="onResetZoom()">
              <i class="mdi mdi-magnify"></i>
              <small class="d-block">Reset</small>
            </button>
          </div>
          <div class="col-4">
            <button class="btn btn-outline-secondary w-100" 
                    (click)="onZoomIn()">
              <i class="mdi mdi-magnify-plus"></i>
              <small class="d-block">Zoom In</small>
            </button>
          </div>
        </div>

        <!-- Zoom Level Selector -->
        <div class="mb-3">
          <label for="zoomLevel" class="form-label small fw-bold">
            <i class="mdi mdi-tune-vertical me-1"></i>
            Precise Zoom Level
          </label>
          <select class="form-select"
                  id="zoomLevel"
                  [(ngModel)]="zoomLevel"
                  (change)="onZoomChange(zoomLevel)">
            <option *ngFor="let zoom of getZoomLevelOptions()" 
                    [value]="zoom.value">
              {{ zoom.label }}
            </option>
          </select>
          <div class="form-text small">Select exact zoom level for optimal viewing</div>
        </div>

        <!-- Zoom Info -->
        <div class="alert alert-light p-2 mb-0">
          <i class="mdi mdi-information me-1"></i>
          <small>
            <strong>Zoom Guide:</strong> 
            Use smaller zoom (75-90%) for overview on large screens, 
            larger zoom (125-200%) for detailed viewing or LED displays.
          </small>
        </div>
      </div>
    </div>
  </div>

  <!-- Refresh Overlay Settings -->
  <div class="settings-section mb-4">
    <h5 class="settings-title">
      <i class="mdi mdi-loading me-2 text-primary"></i>
      Refresh Display
    </h5>
    <p class="text-muted small mb-3">Control visual effects during data refresh</p>
    
    <div class="card bg-light">
      <div class="card-body p-3">
        <div class="form-check form-switch">
          <input class="form-check-input" 
                 type="checkbox" 
                 id="showRefreshOverlay"
                 [(ngModel)]="showRefreshOverlay"
                 (change)="onShowRefreshOverlayChange($event)">
          <label class="form-check-label fw-bold" for="showRefreshOverlay">
            Show Loading Animation
          </label>
          <div class="small text-muted mt-1">
            Display shimmer effect and loading indicators when refreshing data
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Coming Up Next Settings -->
  <div class="settings-section mb-4">
    <h5 class="settings-title">
      <i class="mdi mdi-format-list-numbered me-2 text-primary"></i>
      Coming Up Next Queue
    </h5>
    <p class="text-muted small mb-3">Configure the bottom scrolling queue display</p>
    
    <div class="card bg-light">
      <div class="card-body p-3">
        <!-- Show Coming Up Next Toggle -->
        <div class="form-check form-switch mb-3">
          <input class="form-check-input" 
                 type="checkbox" 
                 id="showComingUpNext"
                 [(ngModel)]="showComingUpNext"
                 (change)="onComingUpNextSettingChange()">
          <label class="form-check-label" for="showComingUpNext">
            <i class="mdi mdi-eye me-1"></i>
            Show Coming Up Next Queue
          </label>
          <div class="form-text small">Display the horizontal scrolling queue at bottom of screen</div>
        </div>
        
        <!-- Auto-scroll settings (only show if coming up next is enabled) -->
        <div *ngIf="showComingUpNext">
          <div class="form-check form-switch mb-3">
            <input class="form-check-input" 
                   type="checkbox" 
                   id="autoScrollEnabled"
                   [(ngModel)]="autoScrollEnabled"
                   (change)="onComingUpNextSettingChange()">
            <label class="form-check-label" for="autoScrollEnabled">
              <i class="mdi mdi-play-circle me-1"></i>
              Enable Auto-Scroll
            </label>
            <div class="form-text small">Automatically scroll through the queue items</div>
          </div>
          
          <!-- Scroll speed setting (only show if auto-scroll is enabled) -->
          <div *ngIf="autoScrollEnabled">
            <label for="scrollSpeed" class="form-label small fw-bold">
              <i class="mdi mdi-speedometer me-1"></i>
              Scroll Speed
            </label>
            <div class="row g-2 align-items-center">
              <div class="col-8">
                <input type="range" 
                       class="form-range" 
                       id="scrollSpeed"
                       [(ngModel)]="scrollSpeed"
                       (change)="onComingUpNextSettingChange()"
                       min="10" 
                       max="60" 
                       step="5">
              </div>
              <div class="col-4">
                <small class="text-muted">{{ scrollSpeed }}s per cycle</small>
              </div>
            </div>
            <div class="form-text small">Time for one complete scroll through all items</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Current Status -->
  <div class="settings-section mb-4">
    <h5 class="settings-title">
      <i class="mdi mdi-information me-2 text-primary"></i>
      Current Status
    </h5>
    
    <div class="card bg-light">
      <div class="card-body p-3">
        <div class="row g-3">
          <div class="col-4">
            <div class="text-center">
              <i class="mdi mdi-monitor fs-3 text-primary"></i>
              <div class="small text-muted">Display Mode</div>
              <div class="fw-bold">{{ getDisplayModeName() }}</div>
            </div>
          </div>
          <div class="col-4" *ngIf="displayMode !== 'single'">
            <div class="text-center">
              <i class="mdi mdi-card-multiple-outline fs-3 text-success"></i>
              <div class="small text-muted">Card Layout</div>
              <div class="fw-bold">{{ getCardLayoutName() }}</div>
            </div>
          </div>
          <div class="col-4" [class.col-8]="displayMode === 'single'">
            <div class="text-center">
              <i class="mdi mdi-timer fs-3" 
                 [class.text-success]="refreshInterval > 0"
                 [class.text-warning]="refreshInterval === 0"></i>
              <div class="small text-muted">Refresh</div>
              <div class="fw-bold">{{ getCurrentRefreshIntervalText() }}</div>
              <div class="small text-primary" *ngIf="refreshCountdown && refreshInterval > 0">
                Next: {{ refreshCountdown }}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Actions -->
  <div class="d-grid gap-2">
    <button class="btn btn-primary" (click)="onApplyAndRefresh()">
      <i class="mdi mdi-refresh me-2"></i>
      Apply & Refresh Now
    </button>
    <button class="btn btn-outline-secondary" (click)="onClose()">
      <i class="mdi mdi-check me-2"></i>
      Done
    </button>
  </div>
</div>