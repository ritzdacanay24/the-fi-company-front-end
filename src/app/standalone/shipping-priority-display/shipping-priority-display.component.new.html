<!-- Full Screen Shipping Priority Display -->
<div class="shipping-priority-container">
  
  <!-- Use async pipe to subscribe to the reactive data stream -->
  <ng-container *ngIf="displayData$ | async as displayData">
    
    <!-- Header Section -->
    <div class="priority-header">
      <div class="header-left">
        <h1 class="display-4 fw-bold">
          <i class="mdi mdi-truck-fast text-primary me-3"></i>
          Shipping Priority Queue
        </h1>
        <p class="lead mb-0">Real-time shipping priority display</p>
      </div>
      
      <div class="header-right text-end">
        <div class="d-flex align-items-center gap-3">
          <!-- Display Mode Toggle -->
          <div class="display-mode-toggle">
            <button class="btn btn-outline-light btn-sm" (click)="toggleDisplayMode()">
              <i class="mdi mdi-view-{{ displayMode === 'single' ? 'grid' : 'sequential' }} me-1"></i>
              {{ displayMode === 'single' ? 'Show Top 3' : 'Single View' }}
            </button>
          </div>
          
          <div class="current-time">
            <h2 class="fw-bold mb-1">{{ currentTime }}</h2>
            <p class="mb-0 text-muted">
              <small>
                <i class="mdi mdi-clock-outline me-1"></i>
                Last Updated: {{ displayData.lastUpdated }}
              </small>
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="displayData.isLoading" class="loading-overlay">
      <div class="text-center">
        <div class="spinner-border text-primary" style="width: 4rem; height: 4rem;" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
        <h3 class="mt-3">Loading Priority Data...</h3>
      </div>
    </div>

    <!-- Error State -->
    <div *ngIf="displayData.hasError && !displayData.isLoading" class="error-display">
      <div class="alert alert-danger text-center">
        <i class="mdi mdi-alert-circle display-1 text-danger"></i>
        <h2 class="mt-3">{{ displayData.errorMessage }}</h2>
        <button class="btn btn-outline-danger btn-lg mt-3" (click)="refreshData()">
          <i class="mdi mdi-refresh me-2"></i>
          Retry
        </button>
      </div>
    </div>

    <!-- Main Content -->
    <div *ngIf="!displayData.isLoading && !displayData.hasError" class="priority-content">
      
      <!-- No Priority Orders -->
      <div *ngIf="!displayData.currentPriorityOrder && displayData.topThreePriorityOrders.length === 0" class="no-priorities">
        <div class="text-center">
          <i class="mdi mdi-clipboard-check display-1 text-success"></i>
          <h2 class="mt-4 text-success">All Caught Up!</h2>
          <p class="lead">No orders in the priority queue</p>
          <small class="text-muted">
            ({{ displayData.allPriorityOrders.length }} total priorities found)
          </small>
        </div>
      </div>
      
      <!-- Single Priority Display Mode -->
      <div *ngIf="displayMode === 'single' && displayData.currentPriorityOrder" class="current-priority-section">
        <div class="current-priority-card">
          <div class="card-header">
            <div class="d-flex align-items-center justify-content-between">
              <div>
                <h2 class="fw-bold mb-1">
                  <i class="mdi mdi-star text-warning me-2"></i>
                  NOW PROCESSING
                </h2>
                <p class="mb-0 text-muted">Priority #{{ displayData.currentPriorityOrder.shipping_priority }}</p>
              </div>
              <div class="priority-badge">
                <span [class]="getPriorityBadgeClass(displayData.currentPriorityOrder.shipping_priority)">
                  Priority {{ displayData.currentPriorityOrder.shipping_priority }}
                </span>
              </div>
            </div>
          </div>
          
          <div class="card-body">
            <div class="row">
              <div class="col-md-8">
                <div class="order-details">
                  <h3 class="order-number">{{ displayData.currentPriorityOrder.SOD_NBR }}-{{ displayData.currentPriorityOrder.SOD_LINE }}</h3>
                  
                  <div class="detail-grid">
                    <div class="detail-row">
                      <span class="label">Part Number:</span>
                      <span class="value fw-bold">{{ displayData.currentPriorityOrder.SOD_PART }}</span>
                    </div>
                    <div class="detail-row">
                      <span class="label">Customer:</span>
                      <span class="value">{{ displayData.currentPriorityOrder.CUSTNAME || 'N/A' }}</span>
                    </div>
                    <div class="detail-row">
                      <span class="label">Ship Date:</span>
                      <span class="value">{{ formatDate(displayData.currentPriorityOrder.SOD_SHIP_DATE) }}</span>
                    </div>
                    <div class="detail-row">
                      <span class="label">Status:</span>
                      <span [class]="getStatusBadgeClass(displayData.currentPriorityOrder.STATUS)">
                        {{ displayData.currentPriorityOrder.STATUS }}
                      </span>
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="col-md-4">
                <div class="additional-info">
                  <div class="detail-row" *ngIf="displayData.currentPriorityOrder.priority_notes">
                    <span class="label">Notes:</span>
                    <span class="value">{{ displayData.currentPriorityOrder.priority_notes }}</span>
                  </div>
                  <div class="detail-row" *ngIf="displayData.currentPriorityOrder.SOD_QTY_TO_SHIP">
                    <span class="label">Quantity:</span>
                    <span class="value fw-bold">{{ formatQuantity(displayData.currentPriorityOrder.SOD_QTY_TO_SHIP) }}</span>
                  </div>
                  <div class="detail-row" *ngIf="displayData.currentPriorityOrder.priority_created_by">
                    <span class="label">Priority Set By:</span>
                    <span class="value">{{ displayData.currentPriorityOrder.priority_created_by }}</span>
                  </div>
                  <div class="detail-row" *ngIf="displayData.currentPriorityOrder.priority_created_at">
                    <span class="label">Priority Set:</span>
                    <span class="value">{{ formatDate(displayData.currentPriorityOrder.priority_created_at) }}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Top 3 Priority Display Mode -->
      <div *ngIf="displayMode === 'top3' && displayData.topThreePriorityOrders.length > 0" class="top3-priority-section">
        <div class="row">
          <div class="col-md-4" *ngFor="let order of displayData.topThreePriorityOrders; let i = index">
            <div class="priority-card" [class]="getPriorityRankClass(i)">
              <div class="card-header">
                <div class="d-flex align-items-center justify-content-between">
                  <h3 class="rank-title">{{ getPriorityRankText(i) }}</h3>
                  <span [class]="getPriorityBadgeClass(order.shipping_priority)">
                    Priority {{ order.shipping_priority }}
                  </span>
                </div>
              </div>
              
              <div class="card-body">
                <h4 class="order-number">{{ order.SOD_NBR }}-{{ order.SOD_LINE }}</h4>
                <div class="detail-summary">
                  <p class="part-number">{{ order.SOD_PART }}</p>
                  <p class="customer">{{ order.CUSTNAME || 'N/A' }}</p>
                  <p class="ship-date">Ship: {{ formatDate(order.SOD_SHIP_DATE) }}</p>
                  <span [class]="getStatusBadgeClass(order.STATUS)">{{ order.STATUS }}</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Next Orders Queue -->
      <div *ngIf="displayData.nextPriorityOrders.length > 0" class="next-orders-section">
        <div class="section-header">
          <h3>
            <i class="mdi mdi-format-list-numbered me-2"></i>
            Coming Up Next
          </h3>
        </div>
        
        <div class="next-orders-grid">
          <div class="row">
            <div class="col-lg-3 col-md-6 mb-3" *ngFor="let order of displayData.nextPriorityOrders; let i = index">
              <div class="next-order-card">
                <div class="card-body">
                  <div class="d-flex align-items-center justify-content-between mb-2">
                    <span class="order-number">{{ order.SOD_NBR }}-{{ order.SOD_LINE }}</span>
                    <span [class]="getPriorityBadgeClass(order.shipping_priority)" class="small">
                      #{{ order.shipping_priority }}
                    </span>
                  </div>
                  <p class="part-number mb-1">{{ order.SOD_PART }}</p>
                  <p class="customer small text-muted mb-0">{{ order.CUSTNAME || 'N/A' }}</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Summary Statistics -->
      <div class="summary-section">
        <div class="row">
          <div class="col-md-3">
            <div class="summary-card">
              <div class="summary-icon">
                <i class="mdi mdi-clock-alert text-danger"></i>
              </div>
              <div class="summary-content">
                <h4>{{ displayData.statusCount.pastDue }}</h4>
                <p>Past Due</p>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="summary-card">
              <div class="summary-icon">
                <i class="mdi mdi-clock text-warning"></i>
              </div>
              <div class="summary-content">
                <h4>{{ displayData.statusCount.todayDue }}</h4>
                <p>Due Today</p>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="summary-card">
              <div class="summary-icon">
                <i class="mdi mdi-clock-outline text-success"></i>
              </div>
              <div class="summary-content">
                <h4>{{ displayData.statusCount.futureDue }}</h4>
                <p>Future Orders</p>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="summary-card">
              <div class="summary-icon">
                <i class="mdi mdi-star text-primary"></i>
              </div>
              <div class="summary-content">
                <h4>{{ displayData.allPriorityOrders.length }}</h4>
                <p>Priority Orders</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
  </ng-container>
  
  <!-- Controls Section -->
  <div class="controls-section">
    <div class="d-flex align-items-center justify-content-center gap-3">
      <button class="btn btn-outline-light" (click)="refreshData()">
        <i class="mdi mdi-refresh me-2"></i>
        Refresh Data
      </button>
      <button class="btn btn-outline-light" (click)="goToDashboard()">
        <i class="mdi mdi-arrow-left me-2"></i>
        Back to Dashboard
      </button>
      <small class="text-muted">Press <kbd>Space</kbd> to toggle display mode</small>
    </div>
  </div>
  
</div>
