<div class="container-fluid" [ngClass]="{'p-0': showInModal, 'p-3': !showInModal}">
  <div class="row g-0" [ngClass]="{'h-100': showInModal}">
    <!-- Sidebar Navigation -->
    <div class="col-md-3 border-end bg-light" [ngClass]="{'h-100': showInModal}">
      <div class="p-3">
        <!-- Search -->
        <div class="mb-3">
          <div class="input-group input-group-sm">
            <span class="input-group-text">
              <i class="mdi mdi-magnify"></i>
            </span>
            <input 
              type="text" 
              class="form-control" 
              placeholder="Search help topics..." 
              [(ngModel)]="searchTerm"
              (input)="clearSearch()"
            >
            <button 
              class="btn btn-outline-secondary" 
              type="button" 
              (click)="clearSearch()"
              *ngIf="searchTerm"
            >
              <i class="mdi mdi-close"></i>
            </button>
          </div>
        </div>

        <!-- Categories -->
        <div *ngIf="!searchTerm">
          <h6 class="text-muted mb-3">
            <i class="mdi mdi-book-open me-1"></i>
            Help Topics
          </h6>
          <nav class="nav flex-column">
            <a 
              *ngFor="let category of helpCategories"
              class="nav-link px-2 py-2 rounded mb-1"
              [ngClass]="{'active bg-primary text-white': activeCategory === category.id}"
              (click)="selectCategory(category.id)"
              style="cursor: pointer;"
            >
              <i [ngClass]="category.icon" class="me-2"></i>
              {{category.title}}
              <span class="badge ms-auto" 
                    [ngClass]="activeCategory === category.id ? 'bg-light text-primary' : 'bg-secondary'">
                {{category.sections.length}}
              </span>
            </a>
          </nav>
        </div>

        <!-- Search Results -->
        <div *ngIf="searchTerm">
          <h6 class="text-muted mb-3">
            <i class="mdi mdi-magnify me-1"></i>
            Search Results ({{getFilteredSections().length}})
          </h6>
          <nav class="nav flex-column" *ngIf="getFilteredSections().length > 0">
            <a 
              *ngFor="let section of getFilteredSections()"
              class="nav-link px-2 py-2 rounded mb-1"
              [ngClass]="{'active bg-primary text-white': activeSection === section.id}"
              (click)="selectSection(section.id)"
              style="cursor: pointer;"
            >
              <i [ngClass]="section.icon" class="me-2"></i>
              {{section.title}}
              <span class="badge ms-auto" 
                    [ngClass]="'bg-' + section.type + (activeSection === section.id ? ' bg-light text-' + section.type : '')">
                {{section.type}}
              </span>
            </a>
          </nav>
          <div *ngIf="getFilteredSections().length === 0" class="text-center text-muted py-4">
            <i class="mdi mdi-magnify-scan display-4"></i>
            <p class="mt-2">No results found for "{{searchTerm}}"</p>
            <button class="btn btn-sm btn-outline-primary" (click)="clearSearch()">
              Clear Search
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Main Content -->
    <div class="col-md-9" [ngClass]="{'h-100 overflow-auto': showInModal}">
      <div class="p-4">
        <!-- Header -->
        <div class="d-flex justify-content-between align-items-center mb-4">
          <div>
            <h4 class="mb-1 d-flex align-items-center">
              <i class="mdi" [ngClass]="helpType === 'serial-numbers' ? 'mdi-database' : 'mdi-download'" class="me-2 text-primary"></i>
              {{helpType === 'serial-numbers' ? 'Serial Numbers' : 'IGT Loader'}} Help
            </h4>
            <p class="text-muted mb-0">Comprehensive guide and documentation</p>
          </div>
          <div class="d-flex gap-2">
            <button class="btn btn-outline-primary btn-sm" (click)="printHelp()" title="Print Help">
              <i class="mdi mdi-printer me-1"></i>
              Print
            </button>
            <!-- Close button is handled by the modal component, not needed here -->
          </div>
        </div>

        <!-- Breadcrumb -->
        <nav aria-label="breadcrumb" *ngIf="!searchTerm && activeCategory">
          <ol class="breadcrumb">
            <li class="breadcrumb-item">
              <i class="mdi mdi-home me-1"></i>Help
            </li>
            <li class="breadcrumb-item">
              {{getActiveCategoryTitle()}}
            </li>
            <li class="breadcrumb-item active" *ngIf="activeSection">
              {{getActiveSection()?.title}}
            </li>
          </ol>
        </nav>

        <!-- Content Area -->
        <div class="help-content">
          <!-- Section List (when no specific section selected) -->
          <div *ngIf="!activeSection && !searchTerm && activeCategory" class="row g-3">
            <div class="col-12">
              <h5>{{getActiveCategoryTitle()}}</h5>
              <p class="text-muted">Choose a topic to learn more:</p>
            </div>
            <div 
              *ngFor="let section of getActiveCategorySections()" 
              class="col-md-6"
            >
              <div 
                class="card h-100 border-start border-3 cursor-pointer"
                [ngClass]="'border-' + section.type"
                (click)="selectSection(section.id)"
              >
                <div class="card-body p-3">
                  <div class="d-flex align-items-start">
                    <div class="flex-shrink-0 me-3">
                      <i [ngClass]="section.icon" 
                         class="fs-4"
                         [ngClass]="'text-' + section.type"></i>
                    </div>
                    <div class="flex-grow-1">
                      <h6 class="card-title mb-1">{{section.title}}</h6>
                      <p class="card-text small text-muted" [innerHTML]="section.content | slice:0:100">
                      </p>
                      <span class="badge" [ngClass]="'bg-' + section.type + '-subtle text-' + section.type">
                        {{section.type | titlecase}}
                      </span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Section Content -->
          <div *ngIf="activeSection" class="section-content">
            <div class="card border-0">
              <div class="card-header bg-light border-0 p-3" *ngIf="getActiveSection()">
                <div class="d-flex align-items-center">
                  <div class="flex-shrink-0 me-3">
                    <div class="rounded-circle p-2" [ngClass]="'bg-' + getActiveSection()!.type + '-subtle'">
                      <i [ngClass]="getActiveSection()!.icon" 
                         [ngClass]="'text-' + getActiveSection()!.type"
                         class="fs-5"></i>
                    </div>
                  </div>
                  <div class="flex-grow-1">
                    <h5 class="mb-1">{{getActiveSection()?.title}}</h5>
                    <span class="badge" [ngClass]="'bg-' + getActiveSection()!.type">
                      {{getActiveSection()?.type | titlecase}} Guide
                    </span>
                  </div>
                </div>
              </div>
              <div class="card-body p-4">
                <div [innerHTML]="getActiveSection()?.content" class="help-content-body"></div>
              </div>
            </div>

            <!-- Navigation -->
            <div class="d-flex justify-content-between mt-4" *ngIf="!searchTerm">
              <button 
                class="btn btn-outline-secondary"
                (click)="activeSection = ''"
                title="Back to section list"
              >
                <i class="mdi mdi-arrow-left me-1"></i>
                Back to Topics
              </button>
              
              <!-- Next/Previous Section Navigation -->
              <div class="d-flex gap-2">
                <button 
                  class="btn btn-outline-primary btn-sm"
                  *ngIf="getPreviousSection()"
                  (click)="selectSection(getPreviousSection()!.id)"
                  title="Previous section"
                >
                  <i class="mdi mdi-chevron-left me-1"></i>
                  {{getPreviousSection()?.title}}
                </button>
                <button 
                  class="btn btn-outline-primary btn-sm"
                  *ngIf="getNextSection()"
                  (click)="selectSection(getNextSection()!.id)"
                  title="Next section"
                >
                  {{getNextSection()?.title}}
                  <i class="mdi mdi-chevron-right ms-1"></i>
                </button>
              </div>
            </div>
          </div>

          <!-- Welcome Screen -->
          <div *ngIf="!activeSection && !activeCategory" class="text-center py-5">
            <i class="mdi mdi-book-open-page-variant display-1 text-muted"></i>
            <h3 class="mt-3">Welcome to {{helpType === 'serial-numbers' ? 'Serial Numbers' : 'IGT Loader'}} Help</h3>
            <p class="text-muted">Select a topic from the sidebar to get started</p>
            <div class="row g-3 mt-4">
              <div *ngFor="let category of helpCategories.slice(0, 3)" class="col-md-4">
                <div class="card border-0 bg-light">
                  <div class="card-body text-center p-4">
                    <i [ngClass]="category.icon" class="fs-2 text-primary mb-3"></i>
                    <h6>{{category.title}}</h6>
                    <button 
                      class="btn btn-outline-primary btn-sm mt-2"
                      (click)="selectCategory(category.id)"
                    >
                      Explore
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Floating Quick Actions (only when not in modal) -->
<div class="position-fixed bottom-0 end-0 p-3" *ngIf="!showInModal" style="z-index: 1050;">
  <div class="d-flex flex-column gap-2">
    <button 
      class="btn btn-primary btn-sm rounded-pill shadow"
      title="Quick Start Guide"
      (click)="selectCategory('getting-started'); selectSection('overview')"
    >
      <i class="mdi mdi-rocket-launch me-1"></i>
      Quick Start
    </button>
    <button 
      class="btn btn-outline-secondary btn-sm rounded-pill shadow bg-white"
      title="Troubleshooting"
      (click)="selectCategory('troubleshooting'); selectSection('common-issues')"
    >
      <i class="mdi mdi-help-circle me-1"></i>
      Help
    </button>
  </div>
</div>
