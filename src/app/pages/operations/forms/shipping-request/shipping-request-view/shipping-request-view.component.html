<div class="container-fluid" *ngIf="!data && !id">
  <div class="row justify-content-center">
    <div class="col-12 col-lg-11 col-xl-10 col-xxl-7">
      
      <div class="card shadow-sm border-0">
        <div class="card-body text-center p-5" style="min-height:300px">
          <div class="mb-4">
            <i class="mdi mdi-alert-circle-outline text-warning" style="font-size: 4rem;"></i>
          </div>
          <h4 class="text-muted mb-3">No Shipping Request Selected</h4>
          <p class="text-muted mb-4">Please select a shipping request from the list to view details.</p>
          <button class="btn btn-primary" (click)="onCancel()">
            <i class="mdi mdi-format-list-bulleted me-2"></i>Go to Request List
          </button>
        </div>
      </div>
      
    </div>
  </div>
</div>

<div class="container-fluid" [hidden]="!data && !id">
  <div class="row justify-content-center">
    <div class="col-12 col-lg-11 col-xl-10 col-xxl-9">
      
      <!-- Page Header with Context -->
      <div class="mb-4">
        <div class="d-flex align-items-center mb-3">
          <button 
            type="button" 
            class="btn btn-outline-secondary me-3"
            (click)="goBack()"
            *ngIf="goBack"
            title="Back to Request List">
            <i class="mdi mdi-arrow-left me-2"></i>Back
          </button>
          <div class="bg-primary bg-gradient rounded-circle me-3 d-flex align-items-center justify-content-center" style="width: 60px; height: 60px;">
            <i class="mdi mdi-eye text-white fs-4"></i>
          </div>
          <div class="flex-grow-1">
            <h2 class="mb-1 text-primary">Shipping Request Summary</h2>
            <p class="text-muted mb-0" *ngIf="id">
              Request #{{id}} - {{safeDisplay(data?.companyName, 'Unknown Company')}}
              <span class="badge ms-2" [ngClass]="getStatusBadgeClass()">{{getStatus()}}</span>
              <span class="badge ms-1" [ngClass]="getPriorityBadgeClass()">{{getPriorityLevel()}}</span>
              <span class="badge bg-danger ms-1" *ngIf="isUrgent()">
                <i class="mdi mdi-alert me-1"></i>Urgent
              </span>
            </p>
            <small class="text-muted" *ngIf="data?.createdDate">
              Created {{getTimeSinceCreated()}} â€¢ {{data.createdDate | date:'short'}}
            </small>
          </div>
          <div class="ms-3">
            <div class="btn-group" role="group">
              <button class="btn btn-outline-secondary btn-sm" (click)="printRequest()" title="Print Request">
                <i class="mdi mdi-printer me-1"></i>Print
              </button>
              <button class="btn btn-outline-info btn-sm" (click)="shareRequest()" title="Share Request">
                <i class="mdi mdi-share me-1"></i>Share
              </button>
              <button class="btn btn-outline-primary" (click)="onEdit()" [disabled]="isLoading">
                <i class="mdi mdi-pencil me-1"></i>Edit
              </button>
            </div>
          </div>
        </div>
      </div>

      <div *ngIf="isLoading" class="text-center p-5">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
        <p class="text-muted mt-3 mb-0">Loading shipping request details...</p>
      </div>

      <!-- Main Content Card -->
      <div class="card shadow-sm border-0" *ngIf="!isLoading">
        <div class="card-body p-0">
          
          <!-- Shipping Request Information Table -->
          <div class="table-responsive">
            <table class="table table-borderless mb-0">
              <tbody>
                <!-- Requestor Information -->
                <tr class="bg-light">
                  <td colspan="4" class="fw-bold text-primary py-3 px-4">
                    <i class="mdi mdi-account me-2"></i>Requestor Information
                  </td>
                </tr>
                <tr>
                  <td class="px-4 py-2 fw-semibold text-dark" style="width: 20%;">Requestor Name</td>
                  <td class="px-4 py-2" style="width: 30%;">{{safeDisplay(data?.requestorName)}}</td>
                  <td class="px-4 py-2 fw-semibold text-dark" style="width: 20%;">Email Address</td>
                  <td class="px-4 py-2" style="width: 30%;">
                    <a *ngIf="data?.emailAddress && data.emailAddress !== 'Not specified'" 
                       [href]="'mailto:' + data.emailAddress" 
                       class="text-decoration-none">
                      {{data.emailAddress}}
                    </a>
                    <span *ngIf="!data?.emailAddress || data.emailAddress === 'Not specified'" 
                          class="text-muted">Not specified</span>
                  </td>
                </tr>
                <tr>
                  <td class="px-4 py-2 fw-semibold text-dark">Company Name</td>
                  <td class="px-4 py-2">{{safeDisplay(data?.companyName)}}</td>
                  <td class="px-4 py-2 fw-semibold text-dark">Contact Name</td>
                  <td class="px-4 py-2">{{safeDisplay(data?.contactName)}}</td>
                </tr>
                <tr>
                  <td class="px-4 py-2 fw-semibold text-dark">Phone Number</td>
                  <td class="px-4 py-2">{{safeDisplay(data?.phoneNumber)}}</td>
                  <td class="px-4 py-2 fw-semibold text-dark">Created Date</td>
                  <td class="px-4 py-2">{{data?.createdDate ? (data.createdDate | date:'medium') : 'Not specified'}}</td>
                </tr>

                <!-- Shipping Address -->
                <tr class="bg-light">
                  <td colspan="4" class="fw-bold text-primary py-3 px-4">
                    <i class="mdi mdi-map-marker me-2"></i>Shipping Address
                  </td>
                </tr>
                <tr>
                  <td class="px-4 py-2 fw-semibold text-dark">Full Address</td>
                  <td class="px-4 py-2" colspan="3">
                    <div class="d-flex align-items-start">
                      <i class="mdi mdi-map-marker-outline me-2 text-muted mt-1"></i>
                      <div>{{getFullAddress()}}</div>
                    </div>
                  </td>
                </tr>

                <!-- Service Details -->
                <tr class="bg-light">
                  <td colspan="4" class="fw-bold text-primary py-3 px-4">
                    <i class="mdi mdi-truck-delivery me-2"></i>Service Details
                  </td>
                </tr>
                <tr>
                  <td class="px-4 py-2 fw-semibold text-dark">Service Type</td>
                  <td class="px-4 py-2">{{getServiceTypeDisplay()}}</td>
                  <td class="px-4 py-2 fw-semibold text-dark">Saturday Delivery</td>
                  <td class="px-4 py-2">
                    <span class="badge" [ngClass]="data?.saturdayDelivery === 'Yes' ? 'bg-info' : 'bg-secondary'">
                      {{formatBoolean(data?.saturdayDelivery)}}
                    </span>
                  </td>
                </tr>
                <tr>
                  <td class="px-4 py-2 fw-semibold text-dark">Freight Charges</td>
                  <td class="px-4 py-2">{{safeDisplay(data?.freightCharges)}}</td>
                  <td class="px-4 py-2 fw-semibold text-dark">Estimated Cost</td>
                  <td class="px-4 py-2">
                    <span class="fw-semibold">{{getFormattedCost()}}</span>
                    <small class="text-muted ms-2" *ngIf="data?.cost && data.cost > 0">
                      ({{data.cost | currency:'USD':'symbol':'1.2-2'}})
                    </small>
                  </td>
                </tr>
                <tr>
                  <td class="px-4 py-2 fw-semibold text-dark">Third Party Account</td>
                  <td class="px-4 py-2" colspan="3">{{safeDisplay(data?.thridPartyAccountNumber)}}</td>
                </tr>

                <!-- Tracking & Status -->
                <tr class="bg-light">
                  <td colspan="4" class="fw-bold text-primary py-3 px-4">
                    <i class="mdi mdi-package-variant-closed me-2"></i>Tracking & Status
                  </td>
                </tr>
                <tr>
                  <td class="px-4 py-2 fw-semibold text-dark">Status</td>
                  <td class="px-4 py-2">
                    <span class="badge fs-6" [ngClass]="getStatusBadgeClass()">
                      <i class="mdi mdi-circle-medium me-1"></i>{{getStatus()}}
                    </span>
                  </td>
                  <td class="px-4 py-2 fw-semibold text-dark">Tracking Number</td>
                  <td class="px-4 py-2">
                    <div *ngIf="isTrackingNumberValid(); else noTracking" class="d-flex align-items-center gap-2">
                      <span class="badge bg-info">{{data.trackingNumber}}</span>
                      <div class="btn-group btn-group-sm" role="group">
                        <button class="btn btn-outline-secondary btn-sm" 
                                (click)="copyTrackingNumber()" 
                                title="Copy tracking number">
                          <i class="mdi mdi-content-copy"></i>
                        </button>
                        <a *ngIf="getTrackingUrl()" 
                           [href]="getTrackingUrl()" 
                           target="_blank" 
                           class="btn btn-outline-primary btn-sm"
                           title="Track package">
                          <i class="mdi mdi-open-in-new"></i>
                        </a>
                      </div>
                    </div>
                    <ng-template #noTracking>
                      <span class="text-muted">Not assigned</span>
                    </ng-template>
                  </td>
                </tr>
                <tr *ngIf="data?.completedDate && data.completedDate !== 'Not specified'">
                  <td class="px-4 py-2 fw-semibold text-dark">Completed Date</td>
                  <td class="px-4 py-2">{{data.completedDate | date:'medium'}}</td>
                  <td class="px-4 py-2 fw-semibold text-dark">Completed By</td>
                  <td class="px-4 py-2">{{safeDisplay(data?.completedBy)}}</td>
                </tr>
                <tr>
                  <td class="px-4 py-2 fw-semibold text-dark">Send Tracking To</td>
                  <td class="px-4 py-2" colspan="3">
                    <div *ngIf="data?.sendTrackingNumberTo?.length > 0; else noRecipients" class="d-flex flex-wrap gap-1">
                      <span *ngFor="let email of data.sendTrackingNumberTo" 
                            class="badge me-1 mb-1"
                            [ngClass]="isValidEmail(email) ? 'bg-primary' : 'bg-warning'">
                        <i class="mdi mdi-email me-1"></i>{{email}}
                        <i *ngIf="!isValidEmail(email)" class="mdi mdi-alert-circle ms-1" title="Invalid email format"></i>
                      </span>
                    </div>
                    <ng-template #noRecipients>
                      <span class="text-muted">
                        <i class="mdi mdi-email-off me-1"></i>No tracking recipients specified
                      </span>
                    </ng-template>
                  </td>
                </tr>

                <!-- Additional Information -->
                <tr class="bg-light" *ngIf="data?.comments && data.comments !== 'Not specified'">
                  <td colspan="4" class="fw-bold text-primary py-3 px-4">
                    <i class="mdi mdi-comment-text-outline me-2"></i>Comments
                  </td>
                </tr>
                <tr *ngIf="data?.comments && data.comments !== 'Not specified'">
                  <td class="px-4 py-2 fw-semibold text-dark">Comments</td>
                  <td class="px-4 py-2" colspan="3">
                    <div class="bg-light p-3 rounded border">{{data.comments}}</div>
                  </td>
                </tr>

                <!-- System Information -->
                <tr class="bg-light">
                  <td colspan="4" class="fw-bold text-primary py-3 px-4">
                    <i class="mdi mdi-information-outline me-2"></i>System Information
                  </td>
                </tr>
                <tr>
                  <td class="px-4 py-2 fw-semibold text-dark">Created By ID</td>
                  <td class="px-4 py-2">{{safeDisplay(data?.createdById)}}</td>
                  <td class="px-4 py-2 fw-semibold text-dark">Active Status</td>
                  <td class="px-4 py-2">
                    <span class="badge" [ngClass]="data?.active ? 'bg-success' : 'bg-danger'">
                      {{data?.active ? 'Active' : 'Inactive'}}
                    </span>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          
        </div>
        
        <!-- Card Footer -->
        <div class="card-footer bg-light border-top d-flex align-items-center p-3">
          <button type="button" class="btn btn-outline-secondary me-2" (click)="onCancel()">
            <i class="mdi mdi-close me-1"></i>Close
          </button>
          
          <!-- Status Summary -->
          <div class="ms-3 me-auto">
            <small class="text-muted">
              <i class="mdi mdi-information-outline me-1"></i>
              Status: <strong>{{getStatus()}}</strong>
              <span *ngIf="isUrgent()" class="text-danger ms-2">
                <i class="mdi mdi-clock-alert-outline me-1"></i>Requires attention
              </span>
            </small>
          </div>

          <div class="ms-auto">
            <div class="btn-group" role="group">
              <button type="button" class="btn btn-outline-secondary btn-sm me-2" (click)="printRequest()">
                <i class="mdi mdi-printer me-1"></i>Print
              </button>
              <button type="button" class="btn btn-primary" (click)="onEdit()" [disabled]="isLoading">
                <i class="mdi mdi-pencil me-1"></i>Edit Request
              </button>
            </div>
          </div>
        </div>
      </div>
      
    </div>
  </div>
</div>