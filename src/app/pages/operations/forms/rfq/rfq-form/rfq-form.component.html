<form [formGroup]="form" class="settings-form" autocomplete="off">

  <!-- Form Lock Status Alert -->
  <div class="alert alert-info d-flex align-items-center mb-4" *ngIf="isFormDisabled">
    <i class="mdi mdi-lock-outline me-2 fs-5"></i>
    <div>
      <strong>Read-Only Mode:</strong> This form is locked to prevent modifications and maintain data integrity.
    </div>
  </div>

  <div class="body">

    <!-- Vendor & Contact Information Section -->
    <div class="mb-4 pb-4 border-bottom">
      <div class="mb-3">
        <h3 class="h5 mb-1">Vendor & Contact Information</h3>
        <p class="text-muted mb-0">
          Primary vendor contact details and communication preferences.
        </p>
      </div>

      <div class="row">
        <div class="col-md-6 mb-3">
          <label class="form-label required">
            Vendor
          </label>
          <ng-select [items]="formValues?.info" [searchable]="true" formControlName="vendor" placeholder="Select vendor"
            bindLabel="company" addTagText="Add emails" [ngClass]="{ 'is-invalid': submitted && f['vendor'].errors }">
          </ng-select>
          <div class="form-text">
            <i class="mdi mdi-information-outline me-1"></i>
            Primary vendor for this RFQ request.
          </div>
        </div>

        <div class="col-md-6 mb-3">
          <label class="form-label required">
            Subject Line
          </label>
          <input type="text" class="form-control" placeholder="Enter subject line" formControlName="subjectLine"
            [ngClass]="{ 'is-invalid': submitted && f['subjectLine'].errors }">
          <div class="form-text">
            <i class="mdi mdi-information-outline me-1"></i>
            Email subject line for vendor communication.
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-md-6 mb-3">
          <label class="form-label required">
            Primary Email Recipients
          </label>
          <ng-select [addTag]="addEmail" [multiple]="true" formControlName='emailToSendTo'
            [ngClass]="{ 'is-invalid': submitted && f['emailToSendTo'].errors }" placeholder="Enter email address">
          </ng-select>
          <div class="form-text">
            <i class="mdi mdi-information-outline me-1"></i>
            Main recipients for the RFQ email.
          </div>
        </div>

        <div class="col-md-6 mb-3">
          <label class="form-label required">
            CC Email Recipients
          </label>
          <ng-select [addTag]="addEmail" [multiple]="true" formControlName='ccEmails'
            [ngClass]="{ 'is-invalid': submitted && f['ccEmails'].errors }" placeholder="Enter email address">
          </ng-select>
          <div class="form-text">
            <i class="mdi mdi-information-outline me-1"></i>
            Additional recipients to copy on the email.
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-md-6 mb-3">
          <label class="form-label required">
            BOL Fax/Email Recipients
          </label>
          <ng-select [addTag]="addEmail" [multiple]="true" formControlName='bolFaxEmail'
            [ngClass]="{ 'is-invalid': submitted && f['bolFaxEmail'].errors }" placeholder="Enter email address">
          </ng-select>
          <div class="form-text">
            <i class="mdi mdi-information-outline me-1"></i>
            Recipients for Bill of Lading documents.
          </div>
        </div>
      </div>
    </div>

    <!-- Shipping Information Section -->
    <div class="mb-4 pb-4 border-bottom">
      <div class="mb-3">
        <h3 class="h5 mb-1">Shipping Information</h3>
        <p class="text-muted mb-0">
          Origin shipping details and pickup information.
        </p>
      </div>

      <div class="row">
        <div class="col-md-6 mb-3">
          <label class="form-label required">
            Sales Order Number
          </label>
          <input type="text" class="form-control" placeholder="Enter sales order number" formControlName="sod_nbr"
            [ngClass]="{ 'is-invalid': submitted && f['sod_nbr'].errors }">
          <div class="form-text">
            <i class="mdi mdi-information-outline me-1"></i>
            Reference sales order for this shipment.
          </div>
        </div>

        <div class="col-md-6 mb-3">
          <label class="form-label required">
            Shipper Name
          </label>
          <input type="text" class="form-control" placeholder="Enter shipper's name" formControlName="shipperName"
            [ngClass]="{ 'is-invalid': submitted && f['shipperName'].errors }">
          <div class="form-text">
            <i class="mdi mdi-information-outline me-1"></i>
            Name of the shipping company or person.
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-md-6 mb-3">
          <label class="form-label required">
            Requestor Name
          </label>
          <input type="text" class="form-control" placeholder="Enter requestor's name" formControlName="requestorName"
            [ngClass]="{ 'is-invalid': submitted && f['requestorName'].errors }">
          <div class="form-text">
            <i class="mdi mdi-information-outline me-1"></i>
            Person requesting this RFQ.
          </div>
        </div>

        <div class="col-md-6 mb-3">
          <label class="form-label required">
            Phone Number
          </label>
          <input type="text" class="form-control" placeholder="Enter phone number" formControlName="phone"
            [ngClass]="{ 'is-invalid': submitted && f['phone'].errors }">
          <div class="form-text">
            <i class="mdi mdi-information-outline me-1"></i>
            Contact phone number for coordination.
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-md-6 mb-3">
          <label class="form-label required">
            Contact Name
          </label>
          <input type="text" class="form-control" placeholder="Enter contact name" formControlName="contactName"
            [ngClass]="{ 'is-invalid': submitted && f['contactName'].errors }">
          <div class="form-text">
            <i class="mdi mdi-information-outline me-1"></i>
            Main contact person for pickup coordination.
          </div>
        </div>

        <div class="col-md-6 mb-3">
          <label class="form-label required">
            Shipping Hours
          </label>
          <input type="text" class="form-control" placeholder="Enter shipping hours" formControlName="shippingHours"
            [ngClass]="{ 'is-invalid': submitted && f['shippingHours'].errors }">
          <div class="form-text">
            <i class="mdi mdi-information-outline me-1"></i>
            Available hours for pickup operations.
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-md-6 mb-3">
          <label class="form-label required">
            Ready Date & Time
          </label>
          <input type="datetime-local" class="form-control" formControlName="readyDateTime" 
            [ngClass]="{ 'is-invalid': submitted && f['readyDateTime'].errors }">
          <div class="form-text">
            <i class="mdi mdi-information-outline me-1"></i>
            When shipment will be ready for pickup.
          </div>
        </div>

        <div class="col-md-6 mb-3">
          <label class="form-label required">
            PU Number
          </label>
          <input type="text" class="form-control" placeholder="Enter PU number" formControlName="puNumber"
            [ngClass]="{ 'is-invalid': submitted && f['puNumber'].errors }">
          <div class="form-text">
            <i class="mdi mdi-information-outline me-1"></i>
            Pickup reference number.
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-md-6 mb-3">
          <label class="form-label required">
            PO Number
          </label>
          <input type="text" class="form-control" placeholder="Enter PO number" formControlName="poNumber"
            [ngClass]="{ 'is-invalid': submitted && f['poNumber'].errors }">
          <div class="form-text">
            <i class="mdi mdi-information-outline me-1"></i>
            Purchase order reference number.
          </div>
        </div>

        <div class="col-md-6 mb-3">
          <label class="form-label required">Is PO Shipping in Full?</label>
          <div class="mt-2">
            <div class="form-check form-check-inline" *ngFor="let row of ['Yes', 'No'];let i = index;">
              <input type="radio" class="form-check-input" name="poShippingFull" id="poShippingFull-{{i}}"
                formControlName="poShippingFull" [ngClass]="{ 'is-invalid': submitted && f['poShippingFull'].errors }" [value]="row">
              <label class="form-check-label" for="poShippingFull-{{i}}">{{row}}</label>
            </div>
          </div>
          <div class="form-text">
            <i class="mdi mdi-information-outline me-1"></i>
            Is the complete PO being shipped?
          </div>
        </div>
      </div>

      <!-- Pickup Address -->
      <div class="mb-3">
        <label class="form-label">
          <strong>Pickup Address</strong>
        </label>
      </div>
      
      <div class="row">
        <div class="col-12 mb-3">
          <label class="form-label required">
            Street Address
          </label>
          <input type="text" class="form-control" placeholder="Enter address" formControlName="address"
            [ngClass]="{ 'is-invalid': submitted && f['address'].errors }">
        </div>
      </div>
      
      <div class="row">
        <div class="col-md-4 mb-3">
          <label class="form-label required">
            City
          </label>
          <input type="text" class="form-control" placeholder="Enter city" formControlName="city"
            [ngClass]="{ 'is-invalid': submitted && f['city'].errors }">
        </div>
        <div class="col-md-4 mb-3">
          <label class="form-label required">
            State
          </label>
          <input type="text" class="form-control" placeholder="Enter state" formControlName="state"
            [ngClass]="{ 'is-invalid': submitted && f['state'].errors }">
        </div>
        <div class="col-md-4 mb-3">
          <label class="form-label required">
            ZIP Code
          </label>
          <input type="text" class="form-control" placeholder="Enter zip code" formControlName="zip"
            [ngClass]="{ 'is-invalid': submitted && f['zip'].errors }">
        </div>
      </div>

      <!-- Shipping Options -->
      <div class="row">
        <div class="col-md-6 mb-3">
          <label class="form-label required">Appointment Required?</label>
          <div class="mt-2">
            <div class="form-check form-check-inline" *ngFor="let row of ['Yes', 'No'];let i = index;">
              <input type="radio" class="form-check-input" name="appointmentRequired" id="appointmentRequired-{{i}}"
                formControlName="appointmentRequired"
                [ngClass]="{ 'is-invalid': submitted && f['appointmentRequired'].errors }" [value]="row">
              <label class="form-check-label" for="appointmentRequired-{{i}}">{{row}}</label>
            </div>
          </div>
          <div class="form-text">
            <i class="mdi mdi-information-outline me-1"></i>
            Is an appointment needed for pickup?
          </div>
        </div>

        <div class="col-md-6 mb-3">
          <label class="form-label required">Lift Gate Required?</label>
          <div class="mt-2">
            <div class="form-check form-check-inline" *ngFor="let row of ['Yes', 'No'];let i = index;">
              <input type="radio" class="form-check-input" name="liftGateRequired" id="liftGateRequired-{{i}}"
                formControlName="liftGateRequired" [ngClass]="{ 'is-invalid': submitted && f['liftGateRequired'].errors }"
                [value]="row">
              <label class="form-check-label" for="liftGateRequired-{{i}}">{{row}}</label>
            </div>
          </div>
          <div class="form-text">
            <i class="mdi mdi-information-outline me-1"></i>
            Does the truck need lift gate service?
          </div>
        </div>
      </div>
    </div>

    <!-- Delivery Information Section -->
    <div class="mb-4 pb-4 border-bottom">
      <div class="mb-3">
        <h3 class="h5 mb-1">Delivery Information</h3>
        <p class="text-muted mb-0">
          Destination details and delivery requirements.
        </p>
      </div>

      <div class="row">
        <div class="col-md-6 mb-3">
          <label class="form-label required">
            Company Name
          </label>
          <input type="text" class="form-control" placeholder="Enter company name" formControlName="dest_companyName"
            [ngClass]="{ 'is-invalid': submitted && f['dest_companyName'].errors }">
          <div class="form-text">
            <i class="mdi mdi-information-outline me-1"></i>
            Destination company name.
          </div>
        </div>

        <div class="col-md-6 mb-3">
          <label class="form-label required">
            Contact Name
          </label>
          <input type="text" class="form-control" placeholder="Enter contact name" formControlName="dest_contactName"
            [ngClass]="{ 'is-invalid': submitted && f['dest_contactName'].errors }">
          <div class="form-text">
            <i class="mdi mdi-information-outline me-1"></i>
            Primary contact at destination.
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-md-6 mb-3">
          <label class="form-label required">
            Delivery Number
          </label>
          <input type="text" class="form-control" placeholder="Enter delivery number" formControlName="dest_deliveryNumber"
            [ngClass]="{ 'is-invalid': submitted && f['dest_deliveryNumber'].errors }">
          <div class="form-text">
            <i class="mdi mdi-information-outline me-1"></i>
            Reference delivery or PO number.
          </div>
        </div>

        <div class="col-md-6 mb-3">
          <label class="form-label required">
            Delivery Date
          </label>
          <input type="date" class="form-control" formControlName="dest_deliveryDate"
            [ngClass]="{ 'is-invalid': submitted && f['dest_deliveryDate'].errors }">
          <div class="form-text">
            <i class="mdi mdi-information-outline me-1"></i>
            Requested delivery date.
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-md-6 mb-3">
          <label class="form-label required">
            Phone Number
          </label>
          <input type="text" class="form-control" placeholder="Enter phone number" formControlName="dest_phone"
            [ngClass]="{ 'is-invalid': submitted && f['dest_phone'].errors }">
          <div class="form-text">
            <i class="mdi mdi-information-outline me-1"></i>
            Contact phone at destination.
          </div>
        </div>

        <div class="col-md-6 mb-3">
          <label class="form-label required">Appointment Required?</label>
          <div class="mt-2">
            <div class="form-check form-check-inline" *ngFor="let row of ['Yes', 'No'];let i = index;">
              <input type="radio" class="form-check-input" name="dest_appointmentRequired"
                id="dest_appointmentRequired-{{i}}" formControlName="dest_appointmentRequired"
                [ngClass]="{ 'is-invalid': submitted && f['dest_appointmentRequired'].errors }" [value]="row">
              <label class="form-check-label" for="dest_appointmentRequired-{{i}}">{{row}}</label>
            </div>
          </div>
          <div class="form-text">
            <i class="mdi mdi-information-outline me-1"></i>
            Is an appointment needed for delivery?
          </div>
        </div>
      </div>

      <!-- Delivery Address -->
      <div class="mb-3">
        <label class="form-label">
          <strong>Delivery Address</strong>
        </label>
      </div>
      
      <div class="row">
        <div class="col-12 mb-3">
          <label class="form-label required">
            Street Address
          </label>
          <input type="text" class="form-control" placeholder="Enter delivery address" formControlName="dest_address"
            [ngClass]="{ 'is-invalid': submitted && f['dest_address'].errors }">
        </div>
      </div>

      <div class="row">
        <div class="col-12 mb-3">
          <label class="form-label">
            Address Line 2
          </label>
          <input type="text" class="form-control" placeholder="Enter address line 2" formControlName="dest_address2"
            [ngClass]="{ 'is-invalid': submitted && f['dest_address2'].errors }">
        </div>
      </div>
      
      <div class="row">
        <div class="col-md-4 mb-3">
          <label class="form-label required">
            City
          </label>
          <input type="text" class="form-control" placeholder="Enter city" formControlName="dest_city"
            [ngClass]="{ 'is-invalid': submitted && f['dest_city'].errors }">
        </div>
        <div class="col-md-4 mb-3">
          <label class="form-label required">
            State
          </label>
          <input type="text" class="form-control" placeholder="Enter state" formControlName="dest_state"
            [ngClass]="{ 'is-invalid': submitted && f['dest_state'].errors }">
        </div>
        <div class="col-md-4 mb-3">
          <label class="form-label required">
            ZIP Code
          </label>
          <input type="text" class="form-control" placeholder="Enter zip code" formControlName="dest_zip"
            [ngClass]="{ 'is-invalid': submitted && f['dest_zip'].errors }">
        </div>
      </div>

      <div class="row">
        <div class="col-md-6 mb-3">
          <label class="form-label required">
            Country
          </label>
          <input type="text" class="form-control" placeholder="Enter country" formControlName="dest_country"
            [ngClass]="{ 'is-invalid': submitted && f['dest_country'].errors }">
          <div class="form-text">
            <i class="mdi mdi-information-outline me-1"></i>
            Destination country for international shipping.
          </div>
        </div>
      </div>
    </div>

    <!-- Commodity Information Section -->
    <div class="mb-4 pb-4 border-bottom">
      <div class="mb-3">
        <h3 class="h5 mb-1">Commodity Information</h3>
        <p class="text-muted mb-0">
          Details about the items being shipped and their specifications.
        </p>
      </div>

      <div class="row">
        <div class="col-md-6 mb-3">
          <label class="form-label required">
            Product Description
          </label>
          <input type="text" class="form-control" placeholder="Enter description of product"
            formControlName="descriptionOfProduct"
            [ngClass]="{ 'is-invalid': submitted && f['descriptionOfProduct'].errors }">
          <div class="form-text">
            <i class="mdi mdi-information-outline me-1"></i>
            Brief description of the commodity.
          </div>
        </div>

        <div class="col-md-6 mb-3">
          <label class="form-label required">
            Weight
          </label>
          <input type="text" class="form-control" placeholder="Enter weight" formControlName="weight"
            [ngClass]="{ 'is-invalid': submitted && f['weight'].errors }">
          <div class="form-text">
            <i class="mdi mdi-information-outline me-1"></i>
            Total shipment weight.
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-md-6 mb-3">
          <label class="form-label required">
            Declared Value
          </label>
          <input type="text" class="form-control" placeholder="Enter value" formControlName="value"
            [ngClass]="{ 'is-invalid': submitted && f['value'].errors }">
          <div class="form-text">
            <i class="mdi mdi-information-outline me-1"></i>
            Total declared value (calculated from line items).
          </div>
        </div>

        <div class="col-md-6 mb-3">
          <label class="form-label required">
            Freight Class
          </label>
          <input type="text" class="form-control" placeholder="Enter freight class" formControlName="freightClass"
            [ngClass]="{ 'is-invalid': submitted && f['freightClass'].errors }">
          <div class="form-text">
            <i class="mdi mdi-information-outline me-1"></i>
            NMFC freight classification code.
          </div>
        </div>
      </div>

      <!-- Package Information -->
      <div class="mb-3">
        <label class="form-label">
          <strong>Package Information</strong>
        </label>
      </div>

      <div class="row">
        <div class="col-md-6 mb-3">
          <label class="form-label required">
            Package Type
          </label>
          <select class="form-select" formControlName="piecesQtyUoM"
            [ngClass]="{ 'is-invalid': submitted && f['piecesQtyUoM'].errors }">
            <option selected disabled [value]="null">--SELECT--</option>
            <option *ngFor="let row of ['Pallets', 'Pieces', 'Cartons']" [value]="row">{{row}}</option>
          </select>
          <div class="form-text">
            <i class="mdi mdi-information-outline me-1"></i>
            Type of packaging for the shipment.
          </div>
        </div>

        <div class="col-md-6 mb-3">
          <label class="form-label required">
            Quantity
          </label>
          <input type="text" class="form-control" placeholder="Enter quantity" formControlName="piecesQty"
            [ngClass]="{ 'is-invalid': submitted && f['piecesQty'].errors }">
          <div class="form-text">
            <i class="mdi mdi-information-outline me-1"></i>
            Total number of packages.
          </div>
        </div>
      </div>

      <!-- Pallet Size Information (conditional) -->
      <div *ngIf="form.value.piecesQtyUoM === 'Pallets'" class="mb-3">
        <div class="mb-3">
          <label class="form-label">
            <strong>Pallet Size Information</strong>
          </label>
        </div>
        <div formArrayName="palletSizeInformationSendInfo" 
          *ngFor="let item of form.get('palletSizeInformationSendInfo')['controls']; let i = index;">
          <div class="row mb-3" [formGroupName]="i">
            <div class="col-10">
              <label class="form-label required">Pallet {{i + 1}} Size</label>
              <input type="text" class="form-control" placeholder="Enter size information" formControlName="size"
                [ngClass]="{ 'is-invalid': submitted && item.get('size').errors }">
            </div>
            <div class="col-2 d-flex align-items-end">
              <button type="button" class="btn btn-outline-danger" (click)="deletePallet(i)">
                <i class="mdi mdi-trash-can-outline"></i>
              </button>
            </div>
          </div>
        </div>
        <button class="btn btn-outline-primary btn-sm" type="button" (click)="addPallets()">
          <i class="mdi mdi-plus me-1"></i> Add Pallet Size
        </button>
      </div>

      <div class="row">
        <div class="col-md-6 mb-3">
          <label class="form-label">Include Insurance?</label>
          <div class="form-check form-switch mt-2">
            <input class="form-check-input" type="checkbox" id="insuranceToggle" formControlName="insuranceIncluded">
            <label class="form-check-label" for="insuranceToggle">
              Include Insurance Coverage
            </label>
          </div>
          <div class="form-text">
            <i class="mdi mdi-information-outline me-1"></i>
            Add insurance coverage for this shipment.
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-12 mb-3">
          <label class="form-label">
            Special Requirements
          </label>
          <textarea class="form-control" placeholder="Enter special requirements" rows="4"
            formControlName="specialRequirements"
            [ngClass]="{ 'is-invalid': submitted && f['specialRequirements'].errors }"></textarea>
          <div class="form-text">
            <i class="mdi mdi-information-outline me-1"></i>
            Any special handling or delivery instructions.
          </div>
        </div>
      </div>
    </div>

    <!-- Line Items Section -->
    <div class="mb-4">
      <div class="mb-3">
        <h3 class="h5 mb-1">Line Information</h3>
        <p class="text-muted mb-0">
          Detailed breakdown of parts and quantities for this shipment.
        </p>
      </div>

      <div class="table-responsive">
        <table class="table table-bordered">
          <thead class="table-light">
            <tr>
              <th>Part Number</th>
              <th>Unit Price</th>
              <th>Qty Shipping</th>
              <th>Include in Form</th>
            </tr>
          </thead>
          <tbody formArrayName="lines" *ngFor="let item of form.get('lines')['controls']; let i = index;">
            <tr [formGroupName]="i" class="align-middle">
              <td class="fw-medium">{{item.value.sod_part}}</td>
              <td>{{item.value.sod_list_pr | currency}}</td>
              <td style="width:200px">
                <input type="number" class="form-control" placeholder="Enter quantity" formControlName="qty"
                  [ngClass]="{ 'is-invalid': submitted && item.get('qty').errors }" (change)="calculateValue()">
              </td>
              <td style="width:150px" class="text-center">
                <div class="form-check form-switch">
                  <input class="form-check-input" type="checkbox" formControlName="addItemsList"
                    (change)="calculateValue()">
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

  </div> <!-- end body container -->
</form>