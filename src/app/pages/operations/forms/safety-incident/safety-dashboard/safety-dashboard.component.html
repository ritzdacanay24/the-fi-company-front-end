<div class="safety-dashboard" [class.display-mode]="isDisplayMode" [class.p-4]="isDisplayMode">
  <div class="container-fluid">
    
      <!-- Header Section -->
    <div class="row mb-4">
      <div class="col-12">
        <div class="dashboard-header text-center py-4 px-3" style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%); border-radius: 15px;">
          <div class="d-flex align-items-center justify-content-center mb-3">
            <div class="bg-white rounded-circle me-3 shadow d-flex align-items-center justify-content-center" style="width: 80px; height: 80px;">
              <i class="mdi mdi-shield-check text-success" style="font-size: 2.5rem; line-height: 1;"></i>
            </div>
            <div class="text-white">
              <h1 class="mb-0 display-4 fw-bold">Safety Dashboard</h1>
              <p class="mb-0 fs-5 opacity-90">Working Together for a Safer Tomorrow</p>
            </div>
          </div>
          
          <!-- Display Mode Button - Only show when not in display mode -->
          <div class="mb-3" *ngIf="showDisplayButton && !isDisplayMode">
            <a [href]="'/safety-dashboard-display'" target="_blank" class="btn btn-light btn-lg shadow">
              <i class="mdi mdi-monitor me-2"></i>
              Open Display Mode
            </a>
          </div>          <!-- Key Metrics Row -->
          <div class="row text-center mt-4">
            <div class="col-md-3 col-lg-2">
              <div class="metric-card bg-white rounded-lg p-3 mx-2 shadow h-100 text-center d-flex flex-column justify-content-center">
                <div class="metric-value display-6 fw-bold" [ngClass]="getDaysSinceColor()">
                  {{metrics.daysSinceLastIncident}}
                </div>
                <div class="metric-label text-muted">Days Since Last Incident</div>
              </div>
            </div>
            <div class="col-md-3 col-lg-2">
              <div class="metric-card bg-white rounded-lg p-3 mx-2 shadow h-100 text-center d-flex flex-column justify-content-center">
                <div class="metric-value display-6 fw-bold text-success">
                  {{metrics.longestSafetyStreak}}
                </div>
                <div class="metric-label text-muted">Record to Beat (Days)</div>
              </div>
            </div>
            <div class="col-md-3 col-lg-2">
              <div class="metric-card bg-white rounded-lg p-3 mx-2 shadow h-100 text-center d-flex flex-column justify-content-center">
                <div class="metric-value display-6 fw-bold text-primary">
                  {{metrics.totalIncidents}}
                </div>
                <div class="metric-label text-muted">Total Incidents This Year</div>
              </div>
            </div>
            <div class="col-md-3 col-lg-2">
              <div class="metric-card bg-white rounded-lg p-3 mx-2 shadow h-100 text-center d-flex flex-column justify-content-center">
                <div class="metric-value display-6 fw-bold text-info">
                  {{metrics.averageResolutionDays}}
                </div>
                <div class="metric-label text-muted">Avg. Resolution Days</div>
              </div>
            </div>
            <div class="col-md-3 col-lg-2">
              <div class="metric-card bg-white rounded-lg p-3 mx-2 shadow h-100 text-center d-flex flex-column justify-content-center">
                <div class="d-flex align-items-center justify-content-center mb-2">
                  <span class="metric-value display-6 fw-bold" [ngClass]="getPerformanceColor()">
                    {{Math.abs(metrics.improvementPercentage).toFixed(1)}}%
                  </span>
                  <i class="mdi ms-2 fs-3" [ngClass]="getPerformanceIcon() + ' ' + getPerformanceColor()"></i>
                </div>
                <div class="metric-label text-muted">Monthly Performance</div>
              </div>
            </div>
            <div class="col-md-3 col-lg-2">
              <div class="metric-card bg-white rounded-lg p-3 mx-2 shadow h-100 text-center d-flex flex-column justify-content-center">
                <div class="d-flex align-items-center justify-content-center mb-2">
                  <i class="mdi mdi-trophy text-warning me-2" style="font-size: 1.5rem;"></i>
                  <span class="metric-value fs-4 fw-bold" [ngClass]="metrics.daysSinceLastIncident >= metrics.longestSafetyStreak ? 'text-success' : 'text-muted'">
                    {{metrics.daysSinceLastIncident >= metrics.longestSafetyStreak ? 'NEW RECORD!' : 'In Progress'}}
                  </span>
                </div>
                
                <!-- Progress Bar -->
                <div class="progress mb-2" style="height: 8px;">
                  <div class="progress-bar" 
                       [class]="metrics.daysSinceLastIncident >= metrics.longestSafetyStreak ? 'bg-success progress-bar-striped progress-bar-animated' : 'bg-primary'"
                       role="progressbar" 
                       [style.width.%]="Math.min((metrics.daysSinceLastIncident / metrics.longestSafetyStreak) * 100, 100)"
                       [attr.aria-valuenow]="metrics.daysSinceLastIncident"
                       [attr.aria-valuemin]="0"
                       [attr.aria-valuemax]="metrics.longestSafetyStreak">
                  </div>
                </div>
                
                <!-- Progress Text -->
                <div class="small text-muted mb-1">
                  {{metrics.daysSinceLastIncident}} / {{metrics.longestSafetyStreak}} days
                </div>
                
                <div class="metric-label text-muted">Safety Challenge</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Charts Section -->
    <div class="row" *ngIf="!isLoading">
      
      <!-- Monthly Trend Chart -->
      <div class="col-lg-8 mb-4">
        <div class="card shadow-sm h-100">
          <div class="card-body">
            <apx-chart
              [series]="monthlyTrendChart.series"
              [chart]="monthlyTrendChart.chart"
              [xaxis]="monthlyTrendChart.xaxis"
              [yaxis]="monthlyTrendChart.yaxis"
              [stroke]="monthlyTrendChart.stroke"
              [markers]="monthlyTrendChart.markers"
              [grid]="monthlyTrendChart.grid"
              [colors]="monthlyTrendChart.colors"
              [title]="monthlyTrendChart.title"
              [tooltip]="monthlyTrendChart.tooltip">
            </apx-chart>
          </div>
        </div>
      </div>

      <!-- Status Chart -->
      <div class="col-lg-4 mb-4">
        <div class="card shadow-sm h-100">
          <div class="card-body d-flex align-items-center justify-content-center">
            <apx-chart
              [series]="statusChart.series"
              [chart]="statusChart.chart"
              [labels]="statusChart.labels"
              [colors]="statusChart.colors"
              [legend]="statusChart.legend"
              [title]="statusChart.title">
            </apx-chart>
          </div>
        </div>
      </div>

      <!-- Incident Types Chart -->
      <div class="col-lg-6 mb-4">
        <div class="card shadow-sm h-100">
          <div class="card-body">
            <apx-chart
              [series]="incidentTypeChart.series"
              [chart]="incidentTypeChart.chart"
              [labels]="incidentTypeChart.labels"
              [colors]="incidentTypeChart.colors"
              [plotOptions]="incidentTypeChart.plotOptions"
              [legend]="incidentTypeChart.legend"
              [title]="incidentTypeChart.title">
            </apx-chart>
          </div>
        </div>
      </div>

      <!-- Location Chart -->
      <div class="col-lg-6 mb-4">
        <div class="card shadow-sm h-100">
          <div class="card-body">
            <apx-chart
              [series]="locationChart.series"
              [chart]="locationChart.chart"
              [plotOptions]="locationChart.plotOptions"
              [xaxis]="locationChart.xaxis"
              [yaxis]="locationChart.yaxis"
              [colors]="locationChart.colors"
              [title]="locationChart.title">
            </apx-chart>
          </div>
        </div>
      </div>

      <!-- Resolution Time Trend Chart -->
      <div class="col-lg-6 mb-4">
        <div class="card shadow-sm h-100">
          <div class="card-body">
            <apx-chart
              [series]="resolutionTimeChart.series"
              [chart]="resolutionTimeChart.chart"
              [xaxis]="resolutionTimeChart.xaxis"
              [yaxis]="resolutionTimeChart.yaxis"
              [stroke]="resolutionTimeChart.stroke"
              [markers]="resolutionTimeChart.markers"
              [colors]="resolutionTimeChart.colors"
              [title]="resolutionTimeChart.title"
              [tooltip]="resolutionTimeChart.tooltip">
            </apx-chart>
          </div>
        </div>
      </div>

      <!-- Time of Day Analysis -->
      <div class="col-lg-6 mb-4">
        <div class="card shadow-sm h-100">
          <div class="card-body">
            <apx-chart
              [series]="timeOfDayChart.series"
              [chart]="timeOfDayChart.chart"
              [plotOptions]="timeOfDayChart.plotOptions"
              [xaxis]="timeOfDayChart.xaxis"
              [yaxis]="timeOfDayChart.yaxis"
              [colors]="timeOfDayChart.colors"
              [title]="timeOfDayChart.title"
              [dataLabels]="timeOfDayChart.dataLabels">
            </apx-chart>
          </div>
        </div>
      </div>

      <!-- Corrective Action Owners -->
      <div class="col-lg-12 mb-4">
        <div class="card shadow-sm h-100">
          <div class="card-header bg-light">
            <h5 class="mb-0 text-center"><i class="mdi mdi-account-hard-hat me-2 text-warning"></i>Safety Champions - Corrective Action Ownership</h5>
          </div>
          <div class="card-body">
            <apx-chart
              [series]="actionOwnerChart.series"
              [chart]="actionOwnerChart.chart"
              [plotOptions]="actionOwnerChart.plotOptions"
              [xaxis]="actionOwnerChart.xaxis"
              [yaxis]="actionOwnerChart.yaxis"
              [colors]="actionOwnerChart.colors"
              [title]="actionOwnerChart.title"
              [dataLabels]="actionOwnerChart.dataLabels"
              [grid]="actionOwnerChart.grid">
            </apx-chart>
          </div>
        </div>
      </div>

    </div>

    <!-- Loading State -->
    <div class="row" *ngIf="isLoading">
      <div class="col-12 text-center py-5">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
        <p class="mt-3 text-muted">Loading safety data...</p>
      </div>
    </div>

    <!-- Safety Messages -->
    <div class="row mt-4">
      <div class="col-12">
        <div class="alert alert-info border-0 shadow-sm">
          <div class="d-flex align-items-center">
            <div class="flex-shrink-0 me-3">
              <i class="mdi mdi-lightbulb-on text-info" style="font-size: 2rem;"></i>
            </div>
            <div class="flex-grow-1">
              <h5 class="alert-heading text-info mb-2">Safety Reminder</h5>
              <p class="mb-2">
                <strong>Every incident is an opportunity to improve.</strong> 
                Report all near-misses, incidents, and safety concerns immediately.
              </p>
              <p class="mb-0">
                <i class="mdi mdi-clock-outline me-1"></i>
                Together we can maintain our goal of <strong>zero workplace incidents</strong>.
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <div class="row mt-4" *ngIf="!isDisplayMode">
      <div class="col-12">
        <div class="text-center text-muted">
          <div class="d-flex align-items-center justify-content-between">
            <div>
              <i class="mdi mdi-update me-1"></i>
              Last updated: {{lastUpdated | date:'short'}}
            </div>
            <div>
              <button class="btn btn-outline-secondary btn-sm me-2" 
                      (click)="openDisplayMode()" 
                      style="z-index: 1000; position: relative; pointer-events: auto;">
                <i class="mdi mdi-fullscreen me-1"></i>Display Mode
              </button>
              <button class="btn btn-outline-primary btn-sm" 
                      (click)="refresh()" 
                      style="z-index: 1000; position: relative; pointer-events: auto;">
                <i class="mdi mdi-refresh me-1"></i>Refresh
              </button>
            </div>
            <div>
              <i class="mdi mdi-shield-check me-1 text-success"></i>
              Safety First - Always
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Display Mode Footer - Show last updated only -->
    <div class="row mt-4" *ngIf="isDisplayMode">
      <div class="col-12">
        <div class="text-center text-muted">
          <div class="d-flex align-items-center justify-content-between">
            <div>
              <i class="mdi mdi-update me-1"></i>
              Last updated: {{lastUpdated | date:'short'}}
            </div>
            <div>
              <i class="mdi mdi-shield-check me-1 text-success"></i>
              Safety First - Always
            </div>
            <div>
              <small class="text-muted">Auto-refresh: Daily</small>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>