<!-- Header -->
<div class="row mb-3">
  <div class="col">
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="/operations">Operations</a></li>
        <li class="breadcrumb-item"><a href="/operations/material-request">Material Request</a></li>
        <li class="breadcrumb-item active" aria-current="page">Kanban Board</li>
      </ol>
    </nav>
    <h1 class="page-title">Material Request Kanban</h1>
  </div>
</div>

<div class="card">
    <div class="card-body">
        <div class="row g-2">
            <div class="col-lg-auto">
                <div class="hstack gap-2">
                    <button type="button" class="btn btn-primary" (click)="createNewRequest()">
                        <i class="mdi mdi-plus-circle align-bottom me-1"></i> New Request
                    </button>
                    <button type="button" class="btn btn-outline-secondary" (click)="manualRefresh()" [disabled]="isLoading">
                        <i class="mdi mdi-refresh align-bottom me-1"></i> 
                        <span *ngIf="!isLoading">Refresh</span>
                        <span *ngIf="isLoading">Loading...</span>
                    </button>
                    <button type="button" class="btn btn-outline-secondary" (click)="exportData()">
                        <i class="mdi mdi-download align-bottom me-1"></i> Export
                    </button>
                    <button type="button" class="btn btn-outline-info" (click)="openHelpGuide()" title="Process Guide">
                        <i class="mdi mdi-help-circle align-bottom me-1"></i> Help Guide
                    </button>
                </div>
            </div><!--end col-->
            <div class="col-lg-3 col-auto">
                <div class="search-box">
                    <input type="text" class="form-control search" placeholder="Search for requests, requester, department..." [(ngModel)]="searchTerm" (input)="updateUrlParams()">
                    <i class="ri-search-line search-icon"></i>
                </div>
            </div>
            <div class="col-lg-2 col-auto">
                <select class="form-select" [(ngModel)]="selectedDepartment" (change)="updateUrlParams()">
                    <option value="">All Departments</option>
                    <option *ngFor="let dept of departments" [value]="dept">{{ dept }}</option>
                </select>
            </div>
            <div class="col-lg-2 col-auto">
                <select class="form-select" [(ngModel)]="selectedPriority" (change)="updateUrlParams()">
                    <option value="">All Priorities</option>
                    <option value="high">High</option>
                    <option value="normal">Normal</option>
                    <option value="low">Low</option>
                </select>
            </div>
            <div class="col-lg-2 col-auto">
                <div class="dropdown" ngbDropdown>
                    <button class="btn btn-outline-secondary dropdown-toggle" style="z-index:1" type="button" ngbDropdownToggle>
                        <i class="mdi mdi-filter-variant me-1"></i> Productivity Filters
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end" ngbDropdownMenu style="min-width: 250px;">
                        <li><h6 class="dropdown-header">Quick Filters</h6></li>
                        <li><label class="dropdown-item" (click)="$event.stopPropagation()">
                            <input type="checkbox" class="form-check-input me-2" [(ngModel)]="showHighPriorityOnly" (change)="updateUrlParams()">
                            High Priority Only
                        </label></li>
                        <li><label class="dropdown-item" (click)="$event.stopPropagation()">
                            <input type="checkbox" class="form-check-input me-2" [(ngModel)]="showOverdueOnly" (change)="updateUrlParams()">
                            Overdue Items Only
                        </label></li>
                        <li><label class="dropdown-item" (click)="$event.stopPropagation()">
                            <input type="checkbox" class="form-check-input me-2" [(ngModel)]="showMyRequestsOnly" (change)="updateUrlParams()">
                            My Requests Only
                        </label></li>
                        <li><label class="dropdown-item" (click)="$event.stopPropagation()">
                            <input type="checkbox" class="form-check-input me-2" [(ngModel)]="showMyDepartmentOnly" (change)="updateUrlParams()">
                            My Department Only
                        </label></li>
                        
                        <li><hr class="dropdown-divider"></li>
                        <li><h6 class="dropdown-header">Advanced Filters</h6></li>
                        
                        <li class="px-3 py-1" (click)="$event.stopPropagation()">
                            <label class="form-label mb-1 small">Validation Status</label>
                            <select class="form-select form-select-sm" [(ngModel)]="selectedValidationStatus" (change)="updateUrlParams()">
                                <option value="">All Statuses</option>
                                <option value="pending">Pending Validation</option>
                                <option value="partial">Partially Validated</option>
                                <option value="complete">Validation Complete</option>
                            </select>
                        </li>
                        
                        <li class="px-3 py-1" (click)="$event.stopPropagation()">
                            <label class="form-label mb-1 small">Age Range</label>
                            <select class="form-select form-select-sm" [(ngModel)]="selectedAgeRange" (change)="updateUrlParams()">
                                <option value="">All Ages</option>
                                <option value="today">Today</option>
                                <option value="week">This Week</option>
                                <option value="month">This Month</option>
                                <option value="overdue">Overdue</option>
                            </select>
                        </li>
                        
                        <li class="px-3 py-1" (click)="$event.stopPropagation()">
                            <label class="form-label mb-1 small">Value Range</label>
                            <select class="form-select form-select-sm" [(ngModel)]="selectedValueRange" (change)="updateUrlParams()">
                                <option value="">All Values</option>
                                <option value="low">Low (&lt; $1,000)</option>
                                <option value="medium">Medium ($1,000 - $10,000)</option>
                                <option value="high">High (&gt; $10,000)</option>
                            </select>
                        </li>
                        
                        <li><hr class="dropdown-divider"></li>
                        <li><button class="dropdown-item text-danger" (click)="clearFilters()">
                            <i class="mdi mdi-filter-remove me-2"></i> Clear All Filters
                        </button></li>
                    </ul>
                </div>
            </div>
            <div class="col-auto">
                <div class="dropdown" ngbDropdown>
                    <button class="btn btn-outline-info dropdown-toggle" type="button" ngbDropdownToggle>
                        <i class="mdi mdi-view-column me-1"></i> Columns
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end" ngbDropdownMenu>
                        <li><h6 class="dropdown-header">Show/Hide Columns</h6></li>
                        <li><label class="dropdown-item" (click)="$event.stopPropagation()">
                            <input type="checkbox" class="form-check-input me-2" 
                                   [(ngModel)]="visibleColumns['validation']" (change)="updateUrlParams()">
                            Validation Queue
                        </label></li>
                        <li><label class="dropdown-item" (click)="$event.stopPropagation()">
                            <input type="checkbox" class="form-check-input me-2" 
                                   [(ngModel)]="visibleColumns['ready_picking']" (change)="updateUrlParams()">
                            Ready for Picking
                        </label></li>
                        <li><label class="dropdown-item" (click)="$event.stopPropagation()">
                            <input type="checkbox" class="form-check-input me-2" 
                                   [(ngModel)]="visibleColumns['in_picking']" (change)="updateUrlParams()">
                            In Picking
                        </label></li>
                        <li><label class="dropdown-item" (click)="$event.stopPropagation()">
                            <input type="checkbox" class="form-check-input me-2" 
                                   [(ngModel)]="visibleColumns['complete']" (change)="updateUrlParams()">
                            Complete
                        </label></li>
                        
                        <li><hr class="dropdown-divider"></li>
                        <li><h6 class="dropdown-header">Quick Presets</h6></li>
                        <li><button class="dropdown-item" (click)="applyQuickFilter('validation-needed')">
                            <i class="mdi mdi-clipboard-check me-2"></i> Validation Focus
                        </button></li>
                        <li><button class="dropdown-item" (click)="applyQuickFilter('picking-focus')">
                            <i class="mdi mdi-package-variant me-2"></i> Picking Focus
                        </button></li>
                        <li><button class="dropdown-item" (click)="applyQuickFilter('all')">
                            <i class="mdi mdi-view-column me-2"></i> Show All Columns
                        </button></li>
                    </ul>
                </div>
            </div>
            <div class="col-auto ms-sm-auto">
                <div class="d-flex gap-2">
                    <div class="text-center">
                        <div class="badge bg-primary">{{ totalRequests }}</div>
                        <small class="d-block text-muted">Total</small>
                    </div>
                    <div class="text-center">
                        <div class="badge bg-warning">{{ overdueCount }}</div>
                        <small class="d-block text-muted">Overdue</small>
                    </div>
                    <div class="text-center">
                        <div class="badge bg-success">{{ avgProcessingTime }}</div>
                        <small class="d-block text-muted">Avg Days</small>
                    </div>
                </div>
            </div><!--end col-->
        </div><!--end row-->
    </div><!--end card-body-->
</div><!--end card-->

<!-- Loading Spinner -->
<div *ngIf="isLoading" class="text-center my-5">
    <div class="spinner-border text-primary avatar-sm" role="status">
        <span class="visually-hidden">Loading...</span>
    </div>
</div>

<div class="tasks-board mb-3 d-flex justify-content-center" id="material-request-kanban" *ngIf="!isLoading">
  <div class="d-flex gap-3" style="max-width: 1400px;">
    <div class="tasks-list" *ngFor="let column of getVisibleColumns(); trackBy: trackByColumnId" style="min-width: 300px; flex: 1;">
    <!-- Column Header with Background Color -->
    <div class="card h-100" style="background-color: transparent;box-shadow:unset;padding:0">
      <div class="card-header border-0 bg-{{ column.color }} text-white">
        <div class="d-flex justify-content-between align-items-center">
          <div class="d-flex align-items-center">
            <i class="{{ column.icon }} me-2"></i>
            <span class="fw-bold">{{ column.title }}</span>
          </div>
          <span class="badge bg-white text-{{ column.color }}">
            {{ getFilteredItems(column).length }}
          </span>
        </div>
        <small class="d-block mt-1 opacity-75">{{ column.description }}</small>
      </div>
      
      <!-- Column Body -->
      <div class="card-body py-2 px-0 drop-zone" 
           (dragover)="onDragOver($event)" 
           (dragenter)="onDragEnter($event, column)" 
           (dragleave)="onDragLeave($event)" 
           (drop)="onDrop($event, column)">
        <ngx-simplebar class="tasklist-content" data-simplebar style="max-height: 600px;">
          <div class="tasks">
            <!-- Request Cards -->
            <div *ngFor="let request of getFilteredItems(column); trackBy: trackByRequestId">
              <ng-template [ngTemplateOutlet]="RequestCard" [ngTemplateOutletContext]="{request: request, column: column}">
              </ng-template>
            </div>
            
            <!-- Empty State -->
            <div *ngIf="getFilteredItems(column).length === 0" class="text-center py-4">
              <i class="{{ column.icon }} text-muted" style="font-size: 2rem;"></i>
              <p class="text-muted mt-2 mb-0">No requests</p>
              <small class="text-muted">Drop requests here or use the move option</small>
            </div>
          </div>
        </ngx-simplebar>
      </div>
    </div><!--end tasks-list-->
  </div><!--end flex container-->
</div><!--end tasks-board-->
</div><!--end tasks-board-->

<!-- Request Card Template -->
<ng-template #RequestCard let-request="request" let-column="column">
  <div class="card tasks-box mb-2 request-card" 
       draggable="true"
       (dragstart)="onDragStart($event, request)"
       (dragend)="onDragEnd($event)">
    <div *ngIf="request.validationSummary?.reviewInfo?.count > 0" class="alert alert-warning py-1 px-2 mb-2 d-flex align-items-center" style="font-size:0.95rem;">
      <i class="mdi mdi-account-clock-outline me-2"></i>
      <span><strong>{{ request.validationSummary.reviewInfo.count }}</strong> pending review<span *ngIf="request.validationSummary.reviewInfo.count > 1">s</span></span>
      <span *ngIf="request.validationSummary.reviewInfo.text" class="ms-2 text-muted">({{ request.validationSummary.reviewInfo.text }})</span>
    </div>
    <div class="card-body">
      <div class="d-flex mb-2">
        <h6 class="fs-15 mb-0 flex-grow-1 text-truncate task-title">
          <a href="javascript:void(0)" class="text-primary fw-bold" (click)="openRequestDetail(request)">
            {{ request.requestNumber }}
          </a>
        </h6>
        <div class="dropdown" ngbDropdown container="body">
          <a href="javascript:void(0);" class="text-muted arrow-none" data-bs-toggle="dropdown" aria-expanded="false" ngbDropdownToggle>
            <i class="mdi mdi-dots-vertical"></i>
          </a>
          <ul class="dropdown-menu dropdown-menu-end" ngbDropdownMenu>
            <li><h6 class="dropdown-header">View Options</h6></li>
            <li><a class="dropdown-item" href="javascript:void(0);" (click)="viewRequest(request)">
              <i class="mdi mdi-eye align-bottom me-2 text-muted float-start"></i> View Details
            </a></li>
            
            <!-- Validation Options - Only for validation queue -->
            <li *ngIf="column.id === 'validation'"><a class="dropdown-item" href="javascript:void(0);" (click)="validateRequest(request)">
              <i class="mdi mdi-check-circle align-bottom me-2 text-muted float-start"></i> Validate Request
            </a></li>
            
            <!-- Review Options - Only for reviews queue -->
            <li *ngIf="column.id === 'reviews'"><a class="dropdown-item" href="javascript:void(0);" (click)="validateRequest(request)">
              <i class="mdi mdi-clipboard-check align-bottom me-2 text-muted float-start"></i> View Validation Details
            </a></li>
            <li *ngIf="column.id === 'reviews'"><a class="dropdown-item" href="javascript:void(0);" (click)="reviewRequest(request)">
              <i class="mdi mdi-account-group align-bottom me-2 text-muted float-start"></i> Review Request
            </a></li>
            
            <!-- Picking Options - Only for fulfillment queue -->
            <li *ngIf="column.id === 'fulfillment'"><a class="dropdown-item" href="javascript:void(0);" (click)="viewPicking(request)">
              <i class="mdi mdi-package-variant align-bottom me-2 text-muted float-start"></i> View Picking
            </a></li>
            
            
            <li><div class="dropdown-divider"></div></li>
            <li><h6 class="dropdown-header">Quick Actions</h6></li>
            
            <!-- Edit - Only for validation queue and not validated -->
            <li *ngIf="column.id === 'validation' && !request.validated"><a class="dropdown-item" href="javascript:void(0);" (click)="editRequest(request)">
              <i class="mdi mdi-pencil align-bottom me-2 text-muted float-start"></i> Edit Request
            </a></li>
            
            <!-- Duplicate - Available for all queues -->
            <li><a class="dropdown-item" href="javascript:void(0);" (click)="duplicateRequest(request)">
              <i class="mdi mdi-content-copy align-bottom me-2 text-muted float-start"></i> Duplicate Request
            </a></li>
            
            <li><div class="dropdown-divider"></div></li>
            <li><h6 class="dropdown-header">Move to Queue</h6></li>
            
            <!-- Move to other queues - Dynamic options based on current column -->
            <li *ngFor="let targetColumn of getAvailableTargetColumns(column.id)">
              <a class="dropdown-item" href="javascript:void(0);" (click)="moveRequestToQueue(request, targetColumn.id)">
                <i class="{{ targetColumn.icon }} align-bottom me-2 text-muted float-start"></i> 
                Move to {{ targetColumn.title }}
              </a>
            </li>
          </ul>
        </div>
      </div>
      
      <!-- Requester & Department Info -->
      <p class="text-muted mb-2">
        <i class="mdi mdi-account me-1"></i>
        <strong>{{ request.requesterName }}</strong>
        <span *ngIf="request.department" class="ms-2">
          <i class="mdi mdi-office-building me-1"></i>
          {{ request.department }}
        </span>
      </p>
      
      <!-- Items Count -->
      <p class="text-muted mb-2">
        <i class="mdi mdi-package me-1"></i>
        {{ request.itemCount }} item(s)
        <span *ngIf="request.totalValue" class="text-muted ms-2">
          • ${{ request.totalValue | number:'1.2-2' }}
        </span>
      </p>
      
      <!-- Progress Bar (for validation column) -->
      <div *ngIf="request.validationProgress >= 0" class="mb-3">
        <div class="d-flex mb-1">
          <div class="flex-grow-1">
            <h6 class="text-muted mb-0">
              <span class="text-secondary">{{ request.validationProgress }}%</span> validated
            </h6>
          </div>
          <div class="flex-shrink-0">
            <span class="text-muted">{{ request.ageText }}</span>
          </div>
        </div>
        <div class="rounded-3">
          <div class="progress progress-sm">
            <div class="progress-bar bg-warning" 
                 [style.width.%]="request.validationProgress"
                 [attr.aria-valuenow]="request.validationProgress"
                 aria-valuemin="0" 
                 aria-valuemax="100"></div>
          </div>
        </div>
      </div>
      
      <!-- Status Badges -->
      <div class="d-flex align-items-center">
        <div class="flex-grow-1">
          <div class="d-flex gap-1">
            <span *ngIf="request.statusBadge" [class]="request.statusBadge.class">
              {{ request.statusBadge.text }}
            </span>
            <span [class]="request.priorityClass">
              {{ request.priority || 'Normal' }}
            </span>
            <!-- Fulfillment Stage Badge -->
            <span *ngIf="request.fulfillmentStage" [class]="request.fulfillmentStage.class">
              <i class="{{ request.fulfillmentStage.icon }} me-1"></i>
              {{ request.fulfillmentStage.text }}
            </span>
          </div>
        </div>
        <div class="flex-shrink-0">
          <!-- Dynamic Quick Actions -->
          <div class="d-flex gap-1">
            <button 
              *ngFor="let action of getQuickActions(request); trackBy: trackByAction"
              type="button" 
              [class]="action.class"
              (click)="handleQuickAction(action.action, request, $event)"
              [title]="action.tooltip">
              <i class="{{ action.icon }}"></i>
              <span class="d-none d-lg-inline ms-1">{{ action.label }}</span>
            </button>
          </div>
        </div>
      </div>
    </div>
    
    <div class="card-footer border-top-dashed">
      <div class="d-flex">
        <div class="flex-grow-1">
          <span class="text-muted">
            <i class="mdi mdi-clock-outline align-bottom"></i>
            {{ request.ageText }}
          </span>
        </div>
        <div class="flex-shrink-0">
          <ul class="link-inline mb-0 p-0">
            <li class="list-inline-item">
              <a href="javascript:void(0)" class="text-muted">
                <i class="mdi mdi-package-variant align-bottom"></i>
                {{ request.itemCount }}
              </a>
            </li>
            <li class="list-inline-item" *ngIf="request.totalValue">
              <a href="javascript:void(0)" class="text-muted">
                <i class="mdi mdi-currency-usd align-bottom"></i>
                {{ request.totalValue | number:'1.0-0' }}
              </a>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</ng-template>

<!-- Move Queue Modal -->
<div class="modal fade" id="moveQueueModal" tabindex="-1" aria-labelledby="moveQueueModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-md">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="moveQueueModalLabel">
          <i class="bx bx-move-horizontal me-2 text-primary"></i>
          Move Work Order to Queue
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div *ngIf="selectedRequestForMove" class="mb-3">
          <div class="card border-info">
            <div class="card-body py-2">
              <h6 class="card-title mb-1">
                <i class="bx bx-document me-1"></i>
                MRF #{{ selectedRequestForMove.mrf_number }}
              </h6>
              <p class="card-text text-muted mb-1">{{ selectedRequestForMove.short_description }}</p>
              <div class="d-flex align-items-center">
                <span class="badge bg-secondary me-2">Current Queue:</span>
                <strong class="text-primary">{{ getCurrentQueueInfo()?.label || 'Unknown' }}</strong>
              </div>
            </div>
          </div>
        </div>

        <div class="mb-3">
          <label class="form-label fw-bold">Select Target Queue:</label>
          <div class="list-group">
            <div 
              *ngFor="let queue of getQueueOptions()" 
              class="list-group-item list-group-item-action d-flex justify-content-between align-items-center"
              [class.active]="queue.value === selectedRequestForMove?.status"
              [class.disabled]="queue.value === selectedRequestForMove?.status"
              [class.border-warning]="queue.isBackward && queue.value !== selectedRequestForMove?.status"
              (click)="queue.value !== selectedRequestForMove?.status ? selectTargetQueue(queue.value) : null"
              style="cursor: pointer;">
              
              <div class="d-flex align-items-center">
                <i class="bx" [ngClass]="queue.icon" style="font-size: 1.2em; margin-right: 8px;"></i>
                <div>
                  <div class="fw-medium">{{ queue.label }}</div>
                  <small class="text-muted">{{ queue.description }}</small>
                  <div *ngIf="queue.isBackward && queue.value !== selectedRequestForMove?.status" class="mt-1">
                    <small class="text-warning">
                      <i class="bx bx-error-circle me-1"></i>
                      <strong>Backward Movement:</strong> This goes against normal workflow
                    </small>
                  </div>
                </div>
              </div>

              <div class="d-flex align-items-center">
                <span 
                  *ngIf="queue.recommended" 
                  class="badge bg-success me-2"
                  title="Recommended next step">
                  <i class="bx bx-check-circle me-1"></i>Recommended
                </span>
                <span 
                  *ngIf="queue.isBackward && queue.value !== selectedRequestForMove?.status" 
                  class="badge bg-warning me-2"
                  title="Backward movement - requires confirmation">
                  <i class="bx bx-error-circle me-1"></i>Backward
                </span>
                <span 
                  *ngIf="queue.value === selectedRequestForMove?.status" 
                  class="badge bg-secondary">
                  Current
                </span>
                <i 
                  *ngIf="queue.value !== selectedRequestForMove?.status"
                  class="bx bx-chevron-right text-muted"></i>
              </div>
            </div>
          </div>
        </div>

        <div class="alert alert-info d-flex align-items-start" role="alert">
          <i class="bx bx-info-circle me-2 mt-1"></i>
          <div>
            <strong>Queue Movement Guidelines:</strong>
            <ul class="mb-0 mt-1">
              <li>Choose the most appropriate queue for the current work order status</li>
              <li><span class="badge bg-success">Recommended</span> queues are highlighted for optimal workflow</li>
              <li><span class="badge bg-warning">Backward</span> movements require confirmation and may undo work</li>
              <li>Consider department requirements and approval processes</li>
            </ul>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          <i class="bx bx-x me-1"></i>Cancel
        </button>
      </div>
    </div>
  </div>
</div>

<style>
.request-card {
  transition: transform 0.2s, box-shadow 0.2s;
}

.request-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

.cursor-pointer {
  cursor: pointer;
}

.validation-modal,
.view-modal,
.review-modal,
.picking-modal,
.edit-modal,
.queue-modal {
  z-index: 2000;
}

.validation-modal .modal-dialog,
.view-modal .modal-dialog,
.review-modal .modal-dialog,
.picking-modal .modal-dialog,
.edit-modal .modal-dialog,
.queue-modal .modal-dialog {
  z-index: 2001;
}

.dropdown-toggle::after {
  display: none;
}

.card .dropdown-toggle {
  border: none;
  background: transparent;
  color: #6c757d;
}

.card .dropdown-toggle:hover {
  background: rgba(0,0,0,0.05);
  color: #495057;
}

.card .dropdown-toggle:focus {
  box-shadow: none;
}

/* Quick Action Button Styling */
.btn-sm {
  padding: 0.25rem 0.4rem;
  font-size: 0.75rem;
  border-radius: 0.375rem;
  transition: all 0.2s ease;
}

.btn-sm:hover {
  transform: translateY(-1px);
  box-shadow: 0 2px 4px rgba(0,0,0,0.15);
}

.btn-outline-warning:hover {
  background-color: #ffc107;
  border-color: #ffc107;
  color: #000;
}

.btn-outline-info:hover {
  background-color: #0dcaf0;
  border-color: #0dcaf0;
  color: #000;
}

.btn-outline-success:hover {
  background-color: #198754;
  border-color: #198754;
  color: #fff;
}

.btn-outline-primary:hover {
  background-color: #0d6efd;
  border-color: #0d6efd;
  color: #fff;
}

.btn-outline-dark:hover {
  background-color: #212529;
  border-color: #212529;
  color: #fff;
}

/* Quick Action Container */
.d-flex.gap-1 {
  gap: 0.25rem !important;
}

/* Tooltip-like styling for buttons */
.btn-sm[title] {
  position: relative;
}

.btn-sm[title]:hover::after {
  content: attr(title);
  position: absolute;
  top: -2rem;
  left: 50%;
  transform: translateX(-50%);
  background: #000;
  color: #fff;
  padding: 0.25rem 0.5rem;
  border-radius: 0.25rem;
  font-size: 0.75rem;
  white-space: nowrap;
  z-index: 1000;
  opacity: 0.9;
}

/* Responsive quick actions */
@media (max-width: 768px) {
  .d-flex.gap-1 {
    flex-direction: column;
    gap: 0.125rem !important;
  }
  
  .btn-sm {
    padding: 0.125rem 0.25rem;
    font-size: 0.625rem;
  }
}

/* Drag and Drop Styles */
.request-card[draggable="true"] {
  cursor: grab;
}

.request-card[draggable="true"]:active {
  cursor: grabbing;
}

.request-card.dragging {
  opacity: 0.5;
  transform: rotate(5deg);
  box-shadow: 0 8px 16px rgba(0,0,0,0.2);
  z-index: 1000;
}

.drop-zone {
  transition: all 0.3s ease;
  min-height: 200px;
}

.drop-zone.drag-over {
  background-color: rgba(13, 110, 253, 0.1);
  border: 2px dashed #0d6efd;
  border-radius: 8px;
}

.drop-zone.drag-over::before {
  content: "Drop here to move request";
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: #0d6efd;
  color: white;
  padding: 0.5rem 1rem;
  border-radius: 4px;
  font-weight: bold;
  z-index: 100;
  pointer-events: none;
}

.drop-zone.invalid-drop {
  background-color: rgba(220, 53, 69, 0.1);
  border: 2px dashed #dc3545;
  border-radius: 8px;
}

.drop-zone.invalid-drop::before {
  content: "Cannot move here";
  background: #dc3545;
}

/* Move confirmation tooltip */
.move-tooltip {
  position: fixed;
  background: #000;
  color: #fff;
  padding: 0.5rem;
  border-radius: 4px;
  font-size: 0.75rem;
  z-index: 2000;
  pointer-events: none;
}

/* Manual move button styling */
.move-queue-btn {
  background: linear-gradient(45deg, #f8f9fa, #e9ecef);
  border: 1px solid #dee2e6;
  transition: all 0.2s ease;
}

.move-queue-btn:hover {
  background: linear-gradient(45deg, #e9ecef, #dee2e6);
  transform: translateY(-1px);
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}
</style>
