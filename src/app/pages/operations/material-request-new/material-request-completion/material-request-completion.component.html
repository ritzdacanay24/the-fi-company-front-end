<div class="container-fluid" *ngIf="!isLoading && requestData">
  
  <!-- Success Header -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="card completion-header">
        <div class="card-body text-center">
          <div class="success-animation mb-4">
            <div class="checkmark-circle">
              <div class="checkmark"></div>
            </div>
          </div>
          
          <h2 class="text-success mb-3">Material Request Completed!</h2>
          <p class="lead text-muted mb-4">
            Request #{{requestId}} has been successfully processed and completed.
          </p>
          
          <div class="completion-badges">
            <span class="badge bg-success me-2">
              <i class="ri-checkbox-circle-line"></i> Completed
            </span>
            <span class="badge" [class]="getPriorityClass(requestData.priority)">
              {{requestData.priority}} Priority
            </span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Completion Metrics -->
  <div class="row mb-4">
    <div class="col-md-3 mb-3">
      <div class="card metric-card">
        <div class="card-body text-center">
          <div class="metric-icon">
            <i class="ri-list-check text-primary"></i>
          </div>
          <div class="metric-value">{{completionMetrics.totalItems}}</div>
          <div class="metric-label">Total Items</div>
        </div>
      </div>
    </div>
    
    <div class="col-md-3 mb-3">
      <div class="card metric-card">
        <div class="card-body text-center">
          <div class="metric-icon">
            <i class="ri-checkbox-line text-success"></i>
          </div>
          <div class="metric-value">{{completionMetrics.pickedItems}}</div>
          <div class="metric-label">Items Picked</div>
        </div>
      </div>
    </div>
    
    <div class="col-md-3 mb-3">
      <div class="card metric-card">
        <div class="card-body text-center">
          <div class="metric-icon">
            <i class="ri-error-warning-line text-warning"></i>
          </div>
          <div class="metric-value">{{completionMetrics.shortageItems}}</div>
          <div class="metric-label">Shortages</div>
        </div>
      </div>
    </div>
    
    <div class="col-md-3 mb-3">
      <div class="card metric-card">
        <div class="card-body text-center">
          <div class="metric-icon">
            <i [class]="getAccuracyIcon() + ' ' + getAccuracyClass()"></i>
          </div>
          <div class="metric-value" [class]="getAccuracyClass()">{{completionMetrics.accuracy}}%</div>
          <div class="metric-label">Accuracy</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Request Summary -->
  <div class="row mb-4">
    <div class="col-lg-8">
      <div class="card">
        <div class="card-header">
          <h5 class="mb-0">Request Summary</h5>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-6">
              <h6 class="text-muted mb-3">Request Information</h6>
              <p class="mb-2"><strong>Requestor:</strong> {{requestData.requestor}}</p>
              <p class="mb-2"><strong>Assembly Number:</strong> {{requestData.assemblyNumber}}</p>
              <p class="mb-2"><strong>Line Number:</strong> {{requestData.lineNumber}}</p>
              <p class="mb-2"><strong>Pick List:</strong> {{requestData.pickList}}</p>
              <p class="mb-2"><strong>Due Date:</strong> {{requestData.dueDate | date:'medium'}}</p>
            </div>
            <div class="col-md-6">
              <h6 class="text-muted mb-3">Completion Details</h6>
              <p class="mb-2"><strong>Completed:</strong> {{completionMetrics.completionTime | date:'medium'}}</p>
              <p class="mb-2"><strong>Picking Duration:</strong> {{completionMetrics.pickingDuration || 'N/A'}}</p>
              <p class="mb-2"><strong>Completed By:</strong> {{requestData.pickedBy || 'System'}}</p>
              <p class="mb-2"><strong>Printed:</strong> {{requestData.printedDate | date:'medium'}}</p>
              <p class="mb-2"><strong>Printed By:</strong> {{requestData.printedBy}}</p>
            </div>
          </div>
          
          <div class="mt-4" *ngIf="requestData.specialInstructions">
            <h6 class="text-muted mb-2">Special Instructions</h6>
            <p class="text-muted">{{requestData.specialInstructions}}</p>
          </div>
        </div>
      </div>
    </div>
    
    <div class="col-lg-4">
      <div class="card">
        <div class="card-header">
          <h5 class="mb-0">Timeline</h5>
        </div>
        <div class="card-body">
          <div class="timeline">
            <div class="timeline-item completed">
              <div class="timeline-marker">
                <i class="ri-file-add-line"></i>
              </div>
              <div class="timeline-content">
                <h6>Request Created</h6>
                <p class="text-muted small">{{requestData.createdDate | date:'medium'}}</p>
              </div>
            </div>
            
            <div class="timeline-item completed" *ngIf="requestData.validated">
              <div class="timeline-marker">
                <i class="ri-shield-check-line"></i>
              </div>
              <div class="timeline-content">
                <h6>Admin Validated</h6>
                <p class="text-muted small">{{requestData.validated | date:'medium'}}</p>
              </div>
            </div>
            
            <div class="timeline-item completed" *ngIf="requestData.printedDate">
              <div class="timeline-marker">
                <i class="ri-printer-line"></i>
              </div>
              <div class="timeline-content">
                <h6>Pick Sheet Printed</h6>
                <p class="text-muted small">{{requestData.printedDate | date:'medium'}}</p>
              </div>
            </div>
            
            <div class="timeline-item completed">
              <div class="timeline-marker">
                <i class="ri-checkbox-circle-line"></i>
              </div>
              <div class="timeline-content">
                <h6>Picking Completed</h6>
                <p class="text-muted small">{{completionMetrics.completionTime | date:'medium'}}</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Items Details -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="card">
        <div class="card-header">
          <h5 class="mb-0">Picked Items Details</h5>
        </div>
        <div class="card-body p-0">
          <div class="table-responsive">
            <table class="table table-hover mb-0">
              <thead class="table-light">
                <tr>
                  <th>Part Number</th>
                  <th>Description</th>
                  <th>Requested</th>
                  <th>Picked</th>
                  <th>Status</th>
                  <th>Notes</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let item of requestData.details" 
                    [class]="(item.qtyPicked || 0) < (item.qty || 0) ? 'table-warning' : 'table-success'">
                  <td><strong>{{item.partNumber}}</strong></td>
                  <td>{{item.itemDescription || item.description || 'N/A'}}</td>
                  <td>{{item.qty}}</td>
                  <td>{{item.qtyPicked || 0}}</td>
                  <td>
                    <span class="badge" 
                          [class]="(item.qtyPicked || 0) >= (item.qty || 0) ? 'bg-success' : 'bg-warning'">
                      <i [class]="(item.qtyPicked || 0) >= (item.qty || 0) ? 'ri-checkbox-circle-line' : 'ri-error-warning-line'"></i>
                      {{(item.qtyPicked || 0) >= (item.qty || 0) ? 'Complete' : 'Shortage'}}
                    </span>
                  </td>
                  <td>{{item.notes || '-'}}</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Action Buttons -->
  <div class="row">
    <div class="col-12">
      <div class="card">
        <div class="card-body text-center">
          <div class="action-buttons">
            <button class="btn btn-outline-secondary me-3" (click)="goToList()">
              <i class="ri-list-check"></i> View All Requests
            </button>
            
            <button class="btn btn-outline-primary me-3" (click)="viewDetails()">
              <i class="ri-eye-line"></i> View Details
            </button>
            
            <button class="btn btn-outline-info me-3" (click)="printReport()">
              <i class="ri-printer-line"></i> Print Report
            </button>
            
            <button class="btn btn-success" (click)="createNewRequest()">
              <i class="ri-add-line"></i> Create New Request
            </button>
          </div>
          
          <div class="completion-message mt-4">
            <p class="text-muted mb-0">
              <i class="ri-information-line me-2"></i>
              This material request workflow has been completed successfully. 
              All materials have been processed and are ready for use.
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>

</div>

<!-- Loading State -->
<div class="d-flex justify-content-center align-items-center" style="min-height: 400px;" *ngIf="isLoading">
  <div class="text-center">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="mt-3 text-muted">Loading completion details...</p>
  </div>
</div>
