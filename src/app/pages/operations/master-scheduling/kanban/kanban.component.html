<div class="card">
    <div class="card-body d-flex text-nowrap">
        <div class="search-box">
            <input type="text" class="form-control search" placeholder="Search for work order number"
                style="width:300px" [(ngModel)]="searchTerm">
            <i class="ri-search-line search-icon"></i>
        </div>

        <button class="btn btn-primary ms-3" (click)="addToKanban()">Add to Kanban</button>
        <select class="form-select ms-3" [(ngModel)]="currentQueueView" (ngModelChange)="onChangeCurrentQueueView()"
            style="width:300px">
            <option *ngFor="let row of data?.queues" [value]="row.name">
                {{row.name}} - {{row.details.length}}
            </option>
            <option [value]="'All'"> All </option>
        </select>
    </div><!--end card-body-->
</div><!--end card-->

<div class="tasks-board" id="kanbanboard" style="overflow:auto;height: calc(100vh - 169px);">
    <div class="tasks-list" *ngFor="let tasks of data?.queues"
        [ngClass]="{'center-task m-auto' : currentQueueView != 'All'}">
        <ng-container *ngIf="currentQueueView == tasks.name || currentQueueView == 'All'">
            <div class="d-flex mb-3 sticky-top" style="z-index:1">
                <div class="flex-grow-1 text-center bg-light p-3 rounded">
                    <h6 class="fs-14 text-uppercase fw-bold mb-0">{{tasks?.name}} <small
                            class="badge bg-success-subtle text-success align-bottom ms-1"
                            [ngClass]="{'bg-danger-subtle text-danger' : tasks.details?.length > 0}">{{tasks.details?.length}}</small>
                    </h6>
                </div>
            </div>
            <ngx-simplebar class="tasklist-content">
                <div id="unassigned-task" class="tasks" [dndDropzone] dndEffectAllowed="move"
                    (dndDrop)="onDrop($event, tasks.details, tasks.id)">
                    <div class="dndPlaceholder p-1 bg-warning-subtle text-warning border border-warning rounded"
                        dndPlaceholderRef>Place here</div>
                    @for(task of tasks.details | myfilter:searchTerm;track $index){
                    <div [dndDraggable]="task" dndEffectAllowed="move" (dndMoved)="onDragged(task, tasks.details)"
                        (onBeforeDrop)="onBeforeDrop(task)" [dndDisableIf]="tasks.disable == 'true'">

                        <ng-template [ngTemplateOutlet]="ready" [ngTemplateOutletContext]="{task:task}"
                            *ngIf="tasks.task_content == 'ready'"></ng-template>
                        <ng-template [ngTemplateOutlet]="picking" [ngTemplateOutletContext]="{task:task}"
                            *ngIf="tasks.task_content == 'picking'"></ng-template>
                        <ng-template [ngTemplateOutlet]="staging" [ngTemplateOutletContext]="{task:task}"
                            *ngIf="tasks.task_content == 'staging'"></ng-template>
                        <ng-template [ngTemplateOutlet]="production" [ngTemplateOutletContext]="{task:task}"
                            *ngIf="tasks.task_content == 'production'"></ng-template>
                        <ng-template [ngTemplateOutlet]="proto" [ngTemplateOutletContext]="{task:task}"
                            *ngIf="tasks.task_content == 'proto'"></ng-template>
                        <ng-template [ngTemplateOutlet]="qa" [ngTemplateOutletContext]="{task:task}"
                            *ngIf="tasks.task_content == 'qa'"></ng-template>
                        <ng-template [ngTemplateOutlet]="logistics" [ngTemplateOutletContext]="{task:task}"
                            *ngIf="tasks.task_content == 'logistics'"></ng-template>
                        <ng-template [ngTemplateOutlet]="completed" [ngTemplateOutletContext]="{task:task}"
                            *ngIf="tasks.task_content == 'completed'"></ng-template>
                    </div>
                    }
                </div>
            </ngx-simplebar>
        </ng-container>
    </div><!--end tasks-list-->

</div><!--end task-board-->

<!-- Task  -->
<ng-template #ready let-task='task'>
    <div class="card tasks-box">
        <div class="card-body">
            <div class="d-flex mb-2">
                <h6 class="fs-15 mb-0 flex-grow-1 text-truncate">
                    <a (click)="openPickSheet(task.wo_nbr)"
                        class="link-primary pointer link-underline-primary ">{{task.wo_nbr}}</a>
                </h6>
                <div class="dropdown" ngbDropdown container="body">
                    <a href="javascript:void(0);" class="text-muted arrow-none" id="dropdownMenuLink1"
                        data-bs-toggle="dropdown" aria-expanded="false" ngbDropdownToggle><i
                            class="ri-more-fill"></i></a>
                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownMenuLink1" ngbDropdownMenu>
                        <li (click)="openQueueSelection(task)" class="pointer">
                            <a class="dropdown-item">
                                <i class="ri-eye-fill align-bottom me-2 text-muted"></i> Select Queue </a>
                        </li>
                        <li (click)="editKanban(task.id)" class="pointer">
                            <a class="dropdown-item">
                                <i class="ri-edit-2-line align-bottom me-2 text-muted"></i> Edit</a>
                        </li>       
                        <li (click)="confirm($event, task)" class="pointer">
                            <a class="dropdown-item" data-bs-toggle="modal">
                                <i class="ri-delete-bin-5-line align-bottom me-2 text-muted"></i> Delete</a>
                        </li>
                    </ul>
                </div>
            </div>
            <p class="text-muted">SO: {{task.so_nbr}}</p>
            <p class="text-muted">Qty: {{task.qty}}</p>
            <p class="text-muted">Due Date: {{task.due_date}}</p>
        </div>
        <div class="card-footer border-top-dashed py-2">
            <div class="d-flex">
                <div class="flex-grow-1">
                </div>
                <div class="flex-shrink-0">
                    <ul class="link-inline mb-0">
                        <li class="list-inline-item" (click)="openQueueSelection(task)">
                            <a href="javascript:void(0)" class="text-muted"><i class="ri-eye-line align-bottom"></i>
                                {{task.view}}</a>
                        </li>
                        <li class="list-inline-item" (click)="viewComment(task)">
                            <a href="javascript:void(0)" class="text-muted">
                                <i class="ri-question-answer-line align-bottom"
                                    [ngClass]="{'text-info':task.comment?.id}"></i></a>
                        </li>
                    </ul>
                </div>
            </div>
        </div><!--end card-body-->
    </div><!--end card-->
</ng-template>

<!-- Task  -->
<ng-template #picking let-task='task'>
    <div class="card tasks-box">
        <div class="card-body">
            <div class="d-flex mb-2">
                <h6 class="fs-15 mb-0 flex-grow-1 text-truncate">
                    <a (click)="openPickSheet(task.wo_nbr)"
                        class="link-primary pointer link-underline-primary ">{{task.wo_nbr}}</a>
                </h6>
                <div class="dropdown" ngbDropdown container="body">
                    <a href="javascript:void(0);" class="text-muted arrow-none" id="dropdownMenuLink1"
                        data-bs-toggle="dropdown" aria-expanded="false" ngbDropdownToggle><i
                            class="ri-more-fill"></i></a>
                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownMenuLink1" ngbDropdownMenu>
                        <li>
                            <a class="dropdown-item" (click)="openQueueSelection(task)">
                                <i class="ri-eye-fill align-bottom me-2 text-muted"></i> Select Queue </a>
                        </li>
                        <li>
                            <a class="dropdown-item" (click)="false">
                                <i class="ri-edit-2-line align-bottom me-2 text-muted"></i> Edit</a>
                        </li>
                        <li>
                            <a class="dropdown-item" data-bs-toggle="modal" (click)="confirm($event, task)">
                                <i class="ri-delete-bin-5-line align-bottom me-2 text-muted"></i> Delete</a>
                        </li>
                    </ul>
                </div>
            </div>
            <p class="text-muted">SO: {{task.so_nbr}}</p>
            <p class="text-muted">Qty: {{task.qty}}</p>
            <p class="text-muted">Due Date: {{task.due_date}}</p>
            <p class="text-muted align-middle position-relative ps-3">
                <i class="ri-printer-line position-absolute" style="top:0px;left:-3px"></i>
                {{task.print_details?.printedDate | date:'short' || 'No started'}}
            </p>
        </div>
        <div class="card-footer border-top-dashed py-2">
            <div class="d-flex">
                <div class="flex-grow-1">
                </div>
                <div class="flex-shrink-0">
                    <ul class="link-inline mb-0">
                        <li class="list-inline-item" (click)="openQueueSelection(task)">
                            <a href="javascript:void(0)" class="text-muted"><i class="ri-eye-line align-bottom"></i>
                                {{task.view}}</a>
                        </li>
                        <li class="list-inline-item" (click)="viewComment(task)">
                            <a href="javascript:void(0)" class="text-muted">
                                <i class="ri-question-answer-line align-bottom"
                                    [ngClass]="{'text-info':task.comment?.id}"></i></a>
                        </li>
                    </ul>
                </div>
            </div>
        </div><!--end card-body-->
    </div><!--end card-->
</ng-template>

<!-- Task  -->
<ng-template #staging let-task='task'>
    <div class="card tasks-box">
        <div class="card-body">
            <div class="d-flex mb-2">
                <h6 class="fs-15 mb-0 flex-grow-1 text-truncate">
                    <a (click)="openPickSheet(task.wo_nbr)"
                        class="link-primary pointer link-underline-primary ">{{task.wo_nbr}}</a>
                </h6>
                <div class="dropdown" ngbDropdown container="body">
                    <a href="javascript:void(0);" class="text-muted arrow-none" id="dropdownMenuLink1"
                        data-bs-toggle="dropdown" aria-expanded="false" ngbDropdownToggle><i
                            class="ri-more-fill"></i></a>
                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownMenuLink1" ngbDropdownMenu>
                        <li (click)="openQueueSelection(task)" class="pointer">
                            <a class="dropdown-item">
                                <i class="ri-eye-fill align-bottom me-2 text-muted"></i> Select Queue </a>
                        </li>
                        <li (click)="editKanban(task.id)" class="pointer">
                            <a class="dropdown-item">
                                <i class="ri-edit-2-line align-bottom me-2 text-muted"></i> Edit</a>
                        </li>       
                        <li (click)="confirm($event, task)" class="pointer">
                            <a class="dropdown-item" data-bs-toggle="modal">
                                <i class="ri-delete-bin-5-line align-bottom me-2 text-muted"></i> Delete</a>
                        </li>
                    </ul>
                </div>
            </div>
            <p class="text-muted">Staging Bay: {{task.staging_bay}}</p>
            <p class="text-muted">SO: {{task.so_nbr}}</p>
            <p class="text-muted">Qty: {{task.qty}}</p>
            <p class="text-muted">Due Date: {{task.due_date}}</p>
        </div>
        <div class="card-footer border-top-dashed py-2">
            <div class="d-flex">
                <div class="flex-grow-1">
                </div>
                <div class="flex-shrink-0">
                    <ul class="link-inline mb-0">
                        <li class="list-inline-item" (click)="openQueueSelection(task)">
                            <a href="javascript:void(0)" class="text-muted"><i class="ri-eye-line align-bottom"></i>
                                {{task.view}}</a>
                        </li>
                        <li class="list-inline-item" (click)="viewComment(task)">
                            <a href="javascript:void(0)" class="text-muted">
                                <i class="ri-question-answer-line align-bottom"
                                    [ngClass]="{'text-info':task.comment?.id}"></i></a>
                        </li>
                    </ul>
                </div>
            </div>
        </div><!--end card-body-->
    </div><!--end card-->
</ng-template>

<!-- Task  -->
<ng-template #production let-task='task'>
    <div class="card tasks-box">
        <div class="card-body">
            <div class="d-flex mb-2">
                <h6 class="fs-15 mb-0 flex-grow-1 text-truncate">
                    <a (click)="openPickSheet(task.wo_nbr)"
                        class="link-primary pointer link-underline-primary ">{{task.wo_nbr}}</a>
                </h6>
                <div class="dropdown" ngbDropdown container="body">
                    <a href="javascript:void(0);" class="text-muted arrow-none" id="dropdownMenuLink1"
                        data-bs-toggle="dropdown" aria-expanded="false" ngbDropdownToggle><i
                            class="ri-more-fill"></i></a>
                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownMenuLink1" ngbDropdownMenu>
                        <li (click)="openQueueSelection(task)" class="pointer">
                            <a class="dropdown-item">
                                <i class="ri-eye-fill align-bottom me-2 text-muted"></i> Select Queue </a>
                        </li>
                        <li (click)="editKanban(task.id)" class="pointer">
                            <a class="dropdown-item">
                                <i class="ri-edit-2-line align-bottom me-2 text-muted"></i> Edit</a>
                        </li>       
                        <li (click)="confirm($event, task)" class="pointer">
                            <a class="dropdown-item" data-bs-toggle="modal">
                                <i class="ri-delete-bin-5-line align-bottom me-2 text-muted"></i> Delete</a>
                        </li>
                    </ul>
                </div>
            </div>
            <p class="text-muted">Prod Line: {{task.prod_line}}</p>
            <p class="text-muted">SO: {{task.so_nbr}}</p>
            <p class="text-muted">Qty: {{task.qty}}</p>
            <p class="text-muted">Due Date: {{task.due_date}}</p>
        </div>
        <div class="card-footer border-top-dashed py-2">
            <div class="d-flex">
                <div class="flex-grow-1">
                </div>
                <div class="flex-shrink-0">
                    <ul class="link-inline mb-0">
                        <li class="list-inline-item" (click)="openQueueSelection(task)">
                            <a href="javascript:void(0)" class="text-muted"><i class="ri-eye-line align-bottom"></i>
                                {{task.view}}</a>
                        </li>
                        <li class="list-inline-item" (click)="viewComment(task)">
                            <a href="javascript:void(0)" class="text-muted">
                                <i class="ri-question-answer-line align-bottom"
                                    [ngClass]="{'text-info':task.comment?.id}"></i></a>
                        </li>
                    </ul>
                </div>
            </div>
        </div><!--end card-body-->
    </div><!--end card-->
</ng-template>

<!-- Task  -->
<ng-template #proto let-task='task'>
    <div class="card tasks-box">
        <div class="card-body">
            <div class="d-flex mb-2">
                <h6 class="fs-15 mb-0 flex-grow-1 text-truncate">
                    <a (click)="openPickSheet(task.wo_nbr)"
                        class="link-primary pointer link-underline-primary ">{{task.wo_nbr}}</a>
                </h6>
                <div class="dropdown" ngbDropdown container="body">
                    <a href="javascript:void(0);" class="text-muted arrow-none" id="dropdownMenuLink1"
                        data-bs-toggle="dropdown" aria-expanded="false" ngbDropdownToggle><i
                            class="ri-more-fill"></i></a>
                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownMenuLink1" ngbDropdownMenu>
                        <li (click)="openQueueSelection(task)" class="pointer">
                            <a class="dropdown-item">
                                <i class="ri-eye-fill align-bottom me-2 text-muted"></i> Select Queue </a>
                        </li>
                        <li (click)="editKanban(task.id)" class="pointer">
                            <a class="dropdown-item">
                                <i class="ri-edit-2-line align-bottom me-2 text-muted"></i> Edit</a>
                        </li>       
                        <li (click)="confirm($event, task)" class="pointer">
                            <a class="dropdown-item" data-bs-toggle="modal">
                                <i class="ri-delete-bin-5-line align-bottom me-2 text-muted"></i> Delete</a>
                        </li>
                    </ul>
                </div>
            </div>
            <p class="text-muted">Prod Line: {{task.prod_line}}</p>
            <p class="text-muted">SO: {{task.so_nbr}}</p>
            <p class="text-muted">Qty: {{task.qty}}</p>
            <p class="text-muted">Due Date: {{task.due_date}}</p>
        </div>
        <div class="card-footer border-top-dashed py-2">
            <div class="d-flex">
                <div class="flex-grow-1">
                </div>
                <div class="flex-shrink-0">
                    <ul class="link-inline mb-0">
                        <li class="list-inline-item" (click)="openQueueSelection(task)">
                            <a href="javascript:void(0)" class="text-muted"><i class="ri-eye-line align-bottom"></i>
                                {{task.view}}</a>
                        </li>
                        <li class="list-inline-item" (click)="viewComment(task)">
                            <a href="javascript:void(0)" class="text-muted">
                                <i class="ri-question-answer-line align-bottom"
                                    [ngClass]="{'text-info':task.comment?.id}"></i></a>
                        </li>
                    </ul>
                </div>
            </div>
        </div><!--end card-body-->
    </div><!--end card-->
</ng-template>

<!-- Task  -->
<ng-template #qa let-task='task'>
    <div class="card tasks-box">
        <div class="card-body">
            <div class="d-flex mb-2">
                <h6 class="fs-15 mb-0 flex-grow-1 text-truncate">
                    <a (click)="openPickSheet(task.wo_nbr)"
                        class="link-primary pointer link-underline-primary ">{{task.wo_nbr}}</a>
                </h6>
                <div class="dropdown" ngbDropdown container="body">
                    <a href="javascript:void(0);" class="text-muted arrow-none" id="dropdownMenuLink1"
                        data-bs-toggle="dropdown" aria-expanded="false" ngbDropdownToggle><i
                            class="ri-more-fill"></i></a>
                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownMenuLink1" ngbDropdownMenu>
                        <li (click)="openQueueSelection(task)" class="pointer">
                            <a class="dropdown-item">
                                <i class="ri-eye-fill align-bottom me-2 text-muted"></i> Select Queue </a>
                        </li>
                        <li (click)="editKanban(task.id)" class="pointer">
                            <a class="dropdown-item">
                                <i class="ri-edit-2-line align-bottom me-2 text-muted"></i> Edit</a>
                        </li>       
                        <li (click)="confirm($event, task)" class="pointer">
                            <a class="dropdown-item" data-bs-toggle="modal">
                                <i class="ri-delete-bin-5-line align-bottom me-2 text-muted"></i> Delete</a>
                        </li>
                    </ul>
                </div>
            </div>
            <p class="text-muted">Prod Line: {{task.prod_line}}</p>
            <p class="text-muted">SO: {{task.so_nbr}}</p>
            <p class="text-muted">Qty: {{task.qty}}</p>
            <p class="text-muted">Due Date: {{task.due_date}}</p>
        </div>
        <div class="card-footer border-top-dashed py-2">
            <div class="d-flex">
                <div class="flex-grow-1">
                </div>
                <div class="flex-shrink-0">
                    <ul class="link-inline mb-0">
                        <li class="list-inline-item" (click)="openQueueSelection(task)">
                            <a href="javascript:void(0)" class="text-muted"><i class="ri-eye-line align-bottom"></i>
                                {{task.view}}</a>
                        </li>
                        <li class="list-inline-item" (click)="viewComment(task)">
                            <a href="javascript:void(0)" class="text-muted">
                                <i class="ri-question-answer-line align-bottom"
                                    [ngClass]="{'text-info':task.comment?.id}"></i></a>
                        </li>
                    </ul>
                </div>
            </div>
        </div><!--end card-body-->
    </div><!--end card-->
</ng-template>

<!-- Task  -->
<ng-template #logistics let-task='task'>
    <div class="card tasks-box">
        <div class="card-body">
            <div class="d-flex mb-2">
                <h6 class="fs-15 mb-0 flex-grow-1 text-truncate">
                    <a (click)="openPickSheet(task.wo_nbr)"
                        class="link-primary pointer link-underline-primary ">{{task.wo_nbr}}</a>
                </h6>
                <div class="dropdown" ngbDropdown container="body">
                    <a href="javascript:void(0);" class="text-muted arrow-none" id="dropdownMenuLink1"
                        data-bs-toggle="dropdown" aria-expanded="false" ngbDropdownToggle><i
                            class="ri-more-fill"></i></a>
                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownMenuLink1" ngbDropdownMenu>
                        <li (click)="openQueueSelection(task)" class="pointer">
                            <a class="dropdown-item">
                                <i class="ri-eye-fill align-bottom me-2 text-muted"></i> Select Queue </a>
                        </li>
                        <li (click)="editKanban(task.id)" class="pointer">
                            <a class="dropdown-item">
                                <i class="ri-edit-2-line align-bottom me-2 text-muted"></i> Edit</a>
                        </li>       
                        <li (click)="confirm($event, task)" class="pointer">
                            <a class="dropdown-item" data-bs-toggle="modal">
                                <i class="ri-delete-bin-5-line align-bottom me-2 text-muted"></i> Delete</a>
                        </li>
                    </ul>
                </div>
            </div>
            <p class="text-muted">Prod Line: {{task.prod_line}}</p>
            <p class="text-muted">SO: {{task.so_nbr}}</p>
            <p class="text-muted">Qty: {{task.qty}}</p>
            <p class="text-muted">Due Date: {{task.due_date}}</p>
        </div>
        <div class="card-footer border-top-dashed py-2">
            <div class="d-flex">
                <div class="flex-grow-1">
                </div>
                <div class="flex-shrink-0">
                    <ul class="link-inline mb-0">
                        <li class="list-inline-item" (click)="openQueueSelection(task)">
                            <a href="javascript:void(0)" class="text-muted"><i class="ri-eye-line align-bottom"></i>
                                {{task.view}}</a>
                        </li>
                        <li class="list-inline-item" (click)="viewComment(task)">
                            <a href="javascript:void(0)" class="text-muted">
                                <i class="ri-question-answer-line align-bottom"
                                    [ngClass]="{'text-info':task.comment?.id}"></i></a>
                        </li>
                    </ul>
                </div>
            </div>
        </div><!--end card-body-->
    </div><!--end card-->
</ng-template>

<!-- Task  -->
<ng-template #completed let-task='task'>
    <div class="card tasks-box">
        <div class="card-body">
            <div class="d-flex mb-2">
                <h6 class="fs-15 mb-0 flex-grow-1 text-truncate">
                    <a (click)="openPickSheet(task.wo_nbr)"
                        class="link-primary pointer link-underline-primary ">{{task.wo_nbr}}</a>
                </h6>
                <div class="dropdown" ngbDropdown container="body">
                    <a href="javascript:void(0);" class="text-muted arrow-none" id="dropdownMenuLink1"
                        data-bs-toggle="dropdown" aria-expanded="false" ngbDropdownToggle><i
                            class="ri-more-fill"></i></a>
                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownMenuLink1" ngbDropdownMenu>
                        <li (click)="openQueueSelection(task)" class="pointer">
                            <a class="dropdown-item">
                                <i class="ri-eye-fill align-bottom me-2 text-muted"></i> Select Queue </a>
                        </li>
                        <li (click)="editKanban(task.id)" class="pointer">
                            <a class="dropdown-item">
                                <i class="ri-edit-2-line align-bottom me-2 text-muted"></i> Edit</a>
                        </li>       
                        <li (click)="confirm($event, task)" class="pointer">
                            <a class="dropdown-item" data-bs-toggle="modal">
                                <i class="ri-delete-bin-5-line align-bottom me-2 text-muted"></i> Delete</a>
                        </li>
                    </ul>
                </div>
            </div>
            <p class="text-muted">Prod Line: {{task.prod_line}}</p>
            <p class="text-muted">SO: {{task.so_nbr}}</p>
            <p class="text-muted">Qty: {{task.qty}}</p>
            <p class="text-muted">Due Date: {{task.due_date}}</p>
        </div>
        <div class="card-footer border-top-dashed py-2">
            <div class="d-flex">
                <div class="flex-grow-1">
                </div>
                <div class="flex-shrink-0">
                    <ul class="link-inline mb-0">
                        <li class="list-inline-item" (click)="openQueueSelection(task)">
                            <a href="javascript:void(0)" class="text-muted"><i class="ri-eye-line align-bottom"></i>
                                {{task.view}}</a>
                        </li>
                        <li class="list-inline-item" (click)="viewComment(task)">
                            <a href="javascript:void(0)" class="text-muted">
                                <i class="ri-question-answer-line align-bottom"
                                    [ngClass]="{'text-info':task.comment?.id}"></i></a>
                        </li>
                    </ul>
                </div>
            </div>
        </div><!--end card-body-->
    </div><!--end card-->
</ng-template>