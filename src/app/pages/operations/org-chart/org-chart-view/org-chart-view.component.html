<div class="container-fluid">
  <div class="row justify-content-center">
    <div class="col-12">
      
      <!-- Breadcrumb -->
      <nav aria-label="breadcrumb" class="mb-3">
        <ol class="breadcrumb mb-0">
          <li class="breadcrumb-item">
            <a href="#" class="text-decoration-none" (click)="$event.preventDefault()">
              <i class="mdi mdi-home-outline me-1"></i>Operations
            </a>
          </li>
          <li class="breadcrumb-item active" aria-current="page">
            Organization Chart
          </li>
        </ol>
      </nav>
      
      <!-- Page Header with Context -->
      <div class="mb-4">
        <div class="d-flex align-items-center justify-content-between mb-3">
          <div class="d-flex align-items-center">
            <div class="bg-primary bg-gradient rounded-circle me-3 d-flex align-items-center justify-content-center" style="width: 60px; height: 60px;">
              <i class="mdi mdi-sitemap text-white fs-4"></i>
            </div>
            <div>
              <h2 class="mb-1 text-primary">Organization Chart</h2>
              <p class="text-muted mb-0">Interactive organizational structure and employee hierarchy visualization</p>
            </div>
          </div>
          <div class="d-flex gap-2">
            <button 
              type="button" 
              class="btn btn-primary"
              (click)="addNode()"
              title="Add new employee">
              <i class="mdi mdi-account-plus me-2"></i>Add Employee
            </button>
          </div>
        </div>
        
        <div class="alert alert-primary border-primary border-opacity-25 bg-primary bg-opacity-10" role="alert">
          <div class="d-flex align-items-start">
            <i class="mdi mdi-information text-primary me-3 mt-1 fs-5"></i>
            <div>
              <h6 class="alert-heading text-primary mb-2">Organization Chart Overview</h6>
              <p class="mb-0">
                View and manage the company's <strong>organizational structure</strong> with interactive charts. 
                Click on employees to view details, expand/collapse departments, and track reporting relationships.
              </p>
            </div>
          </div>
        </div>
      </div>

      <div class="card shadow-sm border-0">
        <div class="card-header">
          <div class="d-flex align-items-center flex-wrap gap-3">
            <div class="form-icon flex-grow-1" style="max-width: 400px;">
              <app-user-search-v1 (notifyParent)="notifyParent($event)" [value]="query" [showLabel]="false"
                  [appendToBody]="'body'" [ngClass]="'mb-0'" [placeholder]="'Search employees...'"
                  [editableSearchTerm]="false"></app-user-search-v1>
            </div>
            
            <button class="btn btn-outline-secondary" (click)="getData()" title="Refresh chart">
              <i class="mdi mdi-refresh me-1"></i>Refresh
            </button>
            
            <div class="ms-auto">
              <div class="d-flex align-items-center">
                <div class="me-4 d-flex gap-4 small text-muted">
                  <span>
                    <i class="mdi mdi-account-multiple text-info me-1"></i>
                    <strong>{{originalData?.length || 0}}</strong> Employees
                  </span>
                  <span *ngIf="currentView">
                    <i class="mdi mdi-account-circle text-primary me-1"></i>
                    Viewing: <strong>{{currentView}}</strong>
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <div class="card-body p-0 position-relative" style="height: calc(100vh - 300px);">
          <div #chartContainer id="chartContainer"></div>
          
          <!-- Status Legend - Inside Chart Area -->
          <div class="position-absolute top-0 end-0 m-3" style="z-index: 1000;">
            <div class="card shadow border-0" style="min-width: 220px;">
              <div class="card-header bg-body-secondary border-0 py-2">
                <h6 class="mb-0 text-body-secondary fw-semibold">
                  <i class="mdi mdi-information-outline me-2"></i>
                  Status Legend
                </h6>
              </div>
              <div class="card-body p-3">
                <table class="table table-sm mb-0">
                  <tbody>
                    <tr>
                      <td class="px-2 py-1">
                        <div class="rounded-circle"
                            style="background-color:gray;width: 12px; height: 12px; margin-top: 2px;"></div>
                      </td>
                      <td class="py-1">
                        <small class="text-body-secondary">Hire date not set</small>
                      </td>
                    </tr>
                    <tr>
                      <td class="px-2 py-1">
                        <div class="rounded-circle"
                            style="background-color:orange;width: 12px; height: 12px; margin-top: 2px;"></div>
                      </td>
                      <td class="py-1">
                        <small class="text-body-secondary">New Position</small>
                      </td>
                    </tr>
                    <tr>
                      <td class="px-2 py-1">
                        <div class="rounded-circle"
                            style="background-color:rgb(0, 195, 255);width: 12px; height: 12px; margin-top: 2px;"></div>
                      </td>
                      <td class="py-1">
                        <small class="text-body-secondary">Less than 6 months</small>
                      </td>
                    </tr>
                    <tr>
                      <td class="px-2 py-1">
                        <div class="rounded-circle"
                            style="background-color:#4B0082;width: 12px; height: 12px; margin-top: 2px;"></div>
                      </td>
                      <td class="py-1">
                        <small class="text-body-secondary">Less than 12 months</small>
                      </td>
                    </tr>
                    <tr>
                      <td class="px-2 py-1">
                        <div class="rounded-circle"
                            style="background-color:#002D62;width: 12px; height: 12px; margin-top: 2px;"></div>
                      </td>
                      <td class="py-1">
                        <small class="text-body-secondary">12+ months</small>
                      </td>
                    </tr>
                    <tr>
                      <td class="px-2 py-1">
                        <div class="rounded-circle"
                            style="background-color:red;width: 12px; height: 12px; margin-top: 2px;"></div>
                      </td>
                      <td class="py-1">
                        <small class="text-body-secondary">Open Position</small>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>

      
      <!-- Floating Action Buttons -->
      <div class="action-buttons" style="position: absolute;bottom: 40px;right: 35px;">
        <div class="card shadow border-0">
          <div class="card-body p-3">
            <div class="btn-group-verticalw-50">
              <div class="mb-2" *ngIf="currentView">
                <div class="alert alert-info py-2 px-3 mb-2 border-0">
                  <div class="d-flex align-items-center justify-content-between">
                    <small class="text-body">
                      <i class="mdi mdi-account-circle me-1"></i>
                      Viewing User: <strong>{{currentView}}</strong>
                    </small>
                    <button class="btn btn-sm btn-outline-info" (click)="clearMark()">
                      <i class="mdi mdi-close"></i>
                    </button>
                  </div>
                </div>
              </div>

              <div *ngIf="currentView" class="mb-2">
                <button (click)="chart?.setExpanded && chart.setExpanded(currentView).render()"
                    class="btn btn-info mb-1w-50"
                    [disabled]="!chart?.setExpanded">
                    <i class="mdi mdi-plus me-1"></i>Set Expand
                </button>
                <button (click)="chart?.setExpanded && chart.setExpanded(currentView, false).render()"
                    class="btn btn-info mb-1w-50"
                    [disabled]="!chart?.setExpanded">
                    <i class="mdi mdi-minus me-1"></i>Collapse
                </button>
                <button (click)="chart?.setUpToTheRootHighlighted && chart.setUpToTheRootHighlighted(currentView).render().fit()"
                    class="btn btn-info mb-2w-50"
                    [disabled]="!chart?.setUpToTheRootHighlighted">
                    <i class="mdi mdi-sitemap me-1"></i>Mark Root
                </button>
              </div>

              <button (click)="chart?.expandAll && chart.expandAll()" 
                      class="btn btn-primary mb-2w-50"
                      [disabled]="!chart?.expandAll">
                  <i class="mdi mdi-unfold-more-horizontal me-1"></i>Expand All
              </button>
              <button (click)="chart?.collapseAll && chart.collapseAll()" 
                      class="btn btn-primary mb-2w-50"
                      [disabled]="!chart?.collapseAll">
                  <i class="mdi mdi-unfold-less-horizontal me-1"></i>Collapse All
              </button>
              <button (click)="chart?.fit && chart.fit()" 
                      class="btn btn-primary mb-2w-50"
                      [disabled]="!chart?.fit">
                  <i class="mdi mdi-fit-to-screen me-1"></i>Fit
              </button>
            </div>
          </div>
        </div>
      </div>
      
    </div>
  </div>
</div>