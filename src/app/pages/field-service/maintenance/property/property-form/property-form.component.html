<form [formGroup]="form" autocomplete="off">

  <div class="mb-3">
    <label class="form-label required">Search by casino name or by address</label>
    <app-address-search [addTag]="true" (notifyParent)="notifyParent($event)"
      [ngClass]="{ 'is-invalid': submitted && f.property.value }" [editableSearchTerm]="false" [hideSelected]="false"
      [showLabel]="false" [placeholder]="'Search by casino name or address'" [showCategories]="true"
      [addTag]="true"></app-address-search>
  </div>

  <h4 class="bg-light p-2 mb-3">Address Information</h4>

  <div class="row">
    <div class="col-md-12 mb-3">
      <label class="form-label required">Property name</label>
      <input type="text" class="form-control" name="property" formControlName="property" placeholder="Enter property"
        [ngClass]="{ 'is-invalid': submitted && f.property.errors }" />
    </div>
  </div>

  <div class="row">
    <div class="col-md-9 mb-3">
      <label class="form-label required">Address</label>
      <input type="text" class="form-control" name="address1" formControlName="address1" placeholder="Enter address"
        [ngClass]="{ 'is-invalid': submitted && f.address1.errors }" autocomplete="off" />
    </div>
    <div class="col-md-3 mb-3">
      <label class="form-label">Suite #</label>
      <input type="text" class="form-control" name="address2" formControlName="address2" placeholder="Suite Number"
        [ngClass]="{ 'is-invalid': submitted && f.address2.errors }" />
    </div>
  </div>

  <div class="row">
    <div class="col-md mb-3">
      <label class="form-label required">City</label>
      <input type="text" class="form-control" name="city" formControlName="city" placeholder="City"
        [ngClass]="{ 'is-invalid': submitted && f.city.errors }" />
    </div>
    <div class="col-md mb-3">
      <label class="form-label required">State</label>
      <select class="form-select" name="a4" formControlName="state" aria-label="Floating label select example"
        [ngClass]="{ 'is-invalid': submitted && f.state.errors }">
        <option disabled selected value="">Select State</option>
        <option [value]="row.abbreviation" *ngFor="let row of states">
          {{ row.name }}
        </option>
      </select>
    </div>
    <div class="col-md mb-3">
      <label class="form-label required">Zip Code</label>
      <input type="tel" class="form-control" name="a5" formControlName="zip_code" placeholder="Zip Code"
        pattern="^[0-9]{5}(?:[0-9]{4})?$" mask="00000" [showMaskTyped]="true"
        [ngClass]="{ 'is-invalid': submitted && f.zip_code.errors }" />
    </div>
  </div>

  <div class="mb-3">
    <label class="form-label required">Country</label>
    <input type="text" class="form-control" name="country" formControlName="country" placeholder="Enter country"
      [ngClass]="{ 'is-invalid': submitted && f.country.errors }" />
  </div>

  <div *ngIf="urlView" style="width: 100%" class="mb-2 mt-2">
    <iframe width="100%" height="300" frameborder="0" scrolling="no" marginheight="0" marginwidth="0" [src]="urlView">
      <a [href]="urlView">Address</a>
    </iframe>
  </div>
  <div *ngIf="!urlView" style="width: 100%" class="mb-2 mt-2">
    <p>Loading Map..</p>
  </div>

  <div class="row">
    <div class="col-md mb-3">
      <label class="form-label">Property Phone</label>
      <input type="tel" class="form-control" name="property_phone" formControlName="property_phone"
        placeholder="Enter Property Phone" [ngClass]="{ 'is-invalid': submitted && f.property_phone.errors }"
        prefix="+1" mask="(000) 000-0000" [showMaskTyped]="true" />
    </div>
  </div>

  <div class="row">
    <div class="col-md-6 mb-3">
      <label class="form-label required">Latitude</label>
      <input type="text" class="form-control" name="lat" formControlName="lat" placeholder="Enter latitude"
        [ngClass]="{ 'is-invalid': submitted && f.lat.errors }" />
      <small>Track jobs on map</small>
    </div>
    <div class="col-md-6 mb-3">
      <label class="form-label required">Longitude</label>
      <input type="text" class="form-control" name="lon" formControlName="lon" placeholder="Enter longitude"
        [ngClass]="{ 'is-invalid': submitted && f.lon.errors }" />
      <small>Track jobs on map</small>
    </div>
    <p class="mb-1">Full address: <b>"{{currentUrlAddress}}"</b></p>
    <small class="mb-2">
      To find Lat & Lon, use this
      <a target="_blank" href="https://www.latlong.net/convert-address-to-lat-long.html">link</a>.
    </small>
  </div>

  <div class="mb-3">
    <label class="form-label">Notes</label>
    <textarea type="text" class="form-control" name="notes" formControlName="notes" rows="5"
      placeholder="Enter property notes" [ngClass]="{ 'is-invalid': submitted && f.notes.errors }"></textarea>
  </div>

  <div class="mb-3">
    <div class="form-check form-switch form-switch-md form-switch-md">
      <input class="form-check-input" type="checkbox" id="out_of_town" formControlName="out_of_town">
      <label class="form-check-label" for="out_of_town">Out Of Town</label>
    </div>
  </div>

  <h4 class="bg-light p-2 mb-3 text-center">Compliance Information</h4>


  <h4 class="bg-light p-2 mb-3 ps-3">License Information</h4>
  <div class="mb-3">
    <label class="form-check-label me-3">License Required</label>
    <div class="form-check form-check-inline" *ngFor="let row of ['Yes', 'No', 'NA']; let i = index">
      <input class="form-check-input" type="radio" name="license_required" id="license_required-{{i}}" [value]="row"
        formControlName="license_required">
      <label class="form-check-label" for="license_required-{{i}}">{{row}}</label>
    </div>
  </div>

  <div class="mb-3">
    <label class="form-label">License Expired Date</label>
    <input type="date" class="form-control" formControlName="license_expired_date"
      [ngClass]="{ 'is-invalid': submitted && f.license_expired_date.errors }" />
  </div>


  <h4 class="bg-light p-2 mb-3 ps-3">Compliance Address Information</h4>

  <div class="row">
    <div class="col-md-12 mb-3">
      <label class="form-label required">Name</label>
      <input type="text" class="form-control" formControlName="compliance_name" placeholder="Enter compliance name"
        [ngClass]="{ 'is-invalid': submitted && f.compliance_name.errors }" />
    </div>
  </div>

  <div class="row">
    <div class="col-md-9 mb-3">
      <label class="form-label required">Address</label>
      <input type="text" class="form-control" name="address1" formControlName="compliance_address1"
        placeholder="Enter address" [ngClass]="{ 'is-invalid': submitted && f.compliance_address1.errors }"
        autocomplete="off" />
    </div>
    <div class="col-md-3 mb-3">
      <label class="form-label">Suite #</label>
      <input type="text" class="form-control" formControlName="compliance_address2" placeholder="Suite Number"
        [ngClass]="{ 'is-invalid': submitted && f.compliance_address2.errors }" />
    </div>
  </div>

  <div class="row">
    <div class="col-md mb-3">
      <label class="form-label required">City</label>
      <input type="text" class="form-control" formControlName="compliance_city" placeholder="City"
        [ngClass]="{ 'is-invalid': submitted && f.compliance_city.errors }" />
    </div>
    <div class="col-md mb-3">
      <label class="form-label required">State</label>
      <select class="form-select" formControlName="compliance_state" aria-label="Floating label select example"
        [ngClass]="{ 'is-invalid': submitted && f.compliance_state.errors }">
        <option disabled selected value="null">Select State</option>
        <option [value]="row.abbreviation" *ngFor="let row of states">
          {{ row.name }}
        </option>
      </select>
    </div>
    <div class="col-md mb-3">
      <label class="form-label required">Zip Code</label>
      <input type="tel" class="form-control" name="a5" formControlName="compliance_zip_code" placeholder="Zip Code"
        pattern="^[0-9]{5}(?:[0-9]{4})?$" mask="00000" [showMaskTyped]="true"
        [ngClass]="{ 'is-invalid': submitted && f.compliance_zip_code.errors }" />
    </div>
  </div>

  <div class="row">
    <div class="col-md mb-3">
      <label class="form-label required">Website</label>
      <input type="text" class="form-control" formControlName="compliance_website" placeholder="Enter website URL"
        [ngClass]="{ 'is-invalid': submitted && f.compliance_website.errors }" />
    </div>
  </div>

  <div class="row">
    <div class="col-md mb-3">
      <label class="form-label required">Phone number</label>
      <ng-select formControlName="compliance_phone_numbers"  [multiple]="true" placeholder="Enter phone numbers"
        placeholder="Enter phone number" #select [clearSearchOnAdd]="true" [addTag]="addTag" [closeOnSelect]="true" [closeOnSelect]="false">
      </ng-select>
    </div>
  </div>

  <div class="mb-3">
    <label class="form-label">License Notes</label>
    <textarea type="text" class="form-control" name="license_notes" formControlName="license_notes" rows="5"
      placeholder="Enter License notes" [ngClass]="{ 'is-invalid': submitted && f.license_notes.errors }"></textarea>
  </div>
  

  <div class="mb-3">
    <label class="form-label">Licensed Techs</label>
    <ng-select [items]="users$" formControlName="licensed_techs" [multiple]="false" bindLabel="user" bindValue="id"
      placeholder="Select tech name" placeholder="--Select--" [clearSearchOnAdd]="true" [closeOnSelect]="true"
      (open)="getUserService()" [multiple]="true" [closeOnSelect]="false" (change)="onTechSelectChange($event)">
    </ng-select>

  </div>

  <div class="form-check form-switch form-switch-md form-switch-md mt-2">
    <input class="form-check-input" type="checkbox" id="active" formControlName="active"
      (change)="setBooleanToNumber('active')">
    <label class="form-check-label" for="active">Active</label>
  </div>

</form>