<div class="container-fluid">
  <div class="row justify-content-center">
    <div class="col-12 col-lg-11 col-xl-10 col-xxl-8">

      <!-- Page Header with Context -->
      <div class="mb-4">
        <div class="d-flex align-items-center mb-3">
          <button type="button" class="btn btn-outline-secondary me-3" (click)="goBack()" title="Back to IGT List">
            <i class="mdi mdi-arrow-left me-2"></i>Back
          </button>
          <div class="bg-primary bg-gradient rounded-circle me-3 d-flex align-items-center justify-content-center"
            style="width: 60px; height: 60px;">
            <i class="mdi mdi-barcode-scan text-white fs-4"></i>
          </div>
          <div>
            <h2 class="mb-1 text-primary">Serial Number Generator</h2>
            <p class="text-muted mb-0">Generate sequential serial number ranges for IGT asset tracking</p>
          </div>
        </div>

        <div class="alert alert-primary border-primary border-opacity-25 bg-primary bg-opacity-10" role="alert">
          <div class="d-flex align-items-start">
            <i class="mdi mdi-information text-primary me-3 mt-1 fs-5"></i>
            <div>
              <h6 class="alert-heading text-primary mb-2">Range Generation Tool</h6>
              <p class="mb-2">
                Generate sequential serial numbers with <strong>customizable prefixes and padding</strong>.
                All serial numbers are validated for uniqueness across the entire system.
              </p>
            </div>
          </div>
        </div>
      </div>

      <div class="card shadow-sm border-0">
        <div class="card-body p-4">
          <form [formGroup]="rangeForm" class="settings-form">
            <div class="body">

              <!-- Range Configuration Section -->
              <div class="mb-4 pb-4 border-bottom">
                <div class="mb-3">
                  <h3 class="h5 mb-1">Range Configuration</h3>
                  <p class="text-muted mb-0">
                    Define the serial number range with prefix and number sequence.
                  </p>
                </div>

                <div class="row">
                  <div class="col-md-3 mb-3">
                    <label class="form-label">
                      Prefix
                    </label>
                    <input type="text" class="form-control" formControlName="prefix" placeholder="Z" maxlength="10"
                      (input)="onRangeFormChange()" (blur)="onRangeFormChange()"
                      [ngClass]="{ 'is-invalid': rangeForm.get('prefix')?.invalid && rangeForm.get('prefix')?.touched }">
                    <div class="form-text">
                      <i class="mdi mdi-information-outline me-1"></i>
                      Optional prefix for serial numbers (default: Z).
                    </div>
                  </div>

                  <div class="col-md-3 mb-3">
                    <label class="form-label">
                      Start Number <span class="text-danger">*</span>
                    </label>
                    <input type="number" class="form-control" formControlName="startNumber" placeholder="1" min="0"
                      max="999999" (input)="onRangeFormChange()" (blur)="onRangeFormChange()"
                      [ngClass]="{ 'is-invalid': rangeForm.get('startNumber')?.invalid && rangeForm.get('startNumber')?.touched }">
                    <div class="form-text">
                      <i class="mdi mdi-information-outline me-1"></i>
                      Starting number for the range.
                    </div>
                    @if (rangeForm.get('startNumber')?.invalid && rangeForm.get('startNumber')?.touched) {
                    <div class="invalid-feedback d-block">
                      <i class="mdi mdi-alert-circle me-1"></i> Start number is required
                    </div>
                    }
                  </div>

                  <div class="col-md-3 mb-3">
                    <label class="form-label">
                      End Number <span class="text-danger">*</span>
                    </label>
                    <input type="number" class="form-control" formControlName="endNumber" placeholder="100" min="0"
                      max="999999" (input)="onRangeFormChange()" (blur)="onRangeFormChange()"
                      [ngClass]="{ 'is-invalid': rangeForm.get('endNumber')?.invalid && rangeForm.get('endNumber')?.touched }">
                    <div class="form-text">
                      <i class="mdi mdi-information-outline me-1"></i>
                      Ending number for the range.
                    </div>
                    @if (rangeForm.get('endNumber')?.invalid && rangeForm.get('endNumber')?.touched) {
                    <div class="invalid-feedback d-block">
                      <i class="mdi mdi-alert-circle me-1"></i> End number is required
                    </div>
                    }
                  </div>

                  <div class="col-md-3 mb-3">
                    <label class="form-label">
                      Number Padding
                    </label>
                    <select class="form-select" formControlName="padding" (change)="onRangeFormChange()">
                      <option value="0">No padding</option>
                      <option value="2">2 digits (01, 02...)</option>
                      <option value="3">3 digits (001, 002...)</option>
                      <option value="4">4 digits (0001, 0002...)</option>
                      <option value="5">5 digits (00001, 00002...)</option>
                    </select>
                    <div class="form-text">
                      <i class="mdi mdi-information-outline me-1"></i>
                      Zero-padding for consistent number formatting.
                    </div>
                  </div>
                </div>
              </div>

              <!-- Settings & Options Section -->
              <div class="mb-4 pb-4 border-bottom">
                <div class="mb-3">
                  <h3 class="h5 mb-1">Settings & Options</h3>
                  <p class="text-muted mb-0">
                    Configure duplicate handling and categorization options.
                  </p>
                </div>

                <div class="row">
                  <div class="col-md-6 mb-3">
                    <label class="form-label">
                      Duplicate Strategy
                    </label>
                    <select class="form-select" formControlName="duplicateStrategy" (change)="onRangeFormChange()">
                      <option value="skip">Skip Duplicates (Recommended)</option>
                      <option value="error">Fail on Duplicates</option>
                    </select>
                    <div class="form-text">
                      <i class="mdi mdi-information-outline me-1"></i>
                      How to handle existing serial numbers in the range.
                      <br>
                      <small class="text-primary">
                        <i class="mdi mdi-alert-circle-outline me-1"></i>
                        Serial numbers are unique across ALL categories.
                      </small>
                    </div>
                  </div>

                  <div class="col-md-6 mb-3">
                    <label class="form-label">
                      Category
                    </label>
                    <select class="form-select" formControlName="category" (change)="onRangeFormChange()">
                      <option value="gaming">Gaming Equipment</option>
                      <option value="peripheral">Peripheral Devices</option>
                      <option value="system">System Components</option>
                      <option value="other">Other Hardware</option>
                    </select>
                    <div class="form-text">
                      <i class="mdi mdi-information-outline me-1"></i>
                      Category classification for the generated serial numbers.
                    </div>
                  </div>
                </div>
              </div>

              <!-- Preview Section -->
              <div class="mb-4" *ngIf="getPreviewRange().length > 0">
                <div class="mb-3">
                  <h3 class="h5 mb-1">Preview Generated Numbers</h3>
                  <p class="text-muted mb-0">
                    Preview of {{getPreviewRange().length}} serial numbers to be generated.
                  </p>
                </div>

                <div class="alert  border p-3">
                  <div class="d-flex justify-content-between align-items-center mb-2">
                    <h6 class="fw-bold text-secondary mb-0">
                      <i class="mdi mdi-eye me-1"></i>
                      Generated Serial Numbers ({{getPreviewRange().length}})
                    </h6>
                    <button *ngIf="getPreviewRange().length > 10" type="button" class="btn btn-sm btn-outline-secondary"
                      (click)="togglePreviewDisplay()">
                      <i class="mdi " [ngClass]="showAllPreview ? ' mdi-chevron-up ' : ' mdi-chevron-down '"></i>
                      {{ showAllPreview ? 'Show Less' : 'Show All (' + getPreviewRange().length + ')' }}
                    </button>
                  </div>
                  <div class="d-flex flex-wrap gap-2">
                    <span *ngFor="let item of getDisplayPreviewRangeWithStatus()"
                      [ngClass]="'badge ' + getSerialDuplicateStatus(item.serial).color"
                      [title]="getSerialStatusDescription(item.serial)">
                      <i [ngClass]="getSerialDuplicateStatus(item.serial).icon" class="me-1"></i>
                      {{item.serial}}
                    </span>
                    <span *ngIf="!showAllPreview && getRemainingPreviewCount() > 0"
                      class="badge bg-info-subtle text-dark" style="cursor: pointer;" (click)="togglePreviewDisplay()"
                      title="Click to show all serial numbers">
                      ...and {{getRemainingPreviewCount()}} more
                    </span>
                  </div>

                  <!-- Summary of new vs duplicate -->
                  <div *ngIf="rangeValidation" class="mt-2 text-muted small">
                    <span class="text-success">
                      <i class="mdi mdi-check-circle me-1"></i>
                      {{ rangeValidation.newSerials?.length || 0 }} new
                    </span>
                    <span *ngIf="rangeValidation.activeDuplicates && rangeValidation.activeDuplicates.length > 0"
                      class="text-danger ms-3">
                      <i class="mdi mdi-close-circle me-1"></i>
                      {{ rangeValidation.activeDuplicates.length }} already exist
                    </span>
                    <span
                      *ngIf="rangeValidation.softDeletedDuplicates && rangeValidation.softDeletedDuplicates.length > 0"
                      class="text-primary ms-3">
                      <i class="mdi mdi-alert-circle-outline me-1"></i>
                      {{ rangeValidation.softDeletedDuplicates.length }} soft-deleted
                    </span>
                  </div>
                </div>
              </div>

            </div> <!-- end body container -->
          </form>
        </div>

        <div class="card-footer bg-light border-top d-flex p-3">
          <button type="button" class="btn btn-outline-secondary me-2" (click)="goBack()">
            <i class="mdi mdi-arrow-left me-1"></i>Back to IGT List
          </button>
          <button type="submit" class="btn btn-primary ms-auto"
            [disabled]="isGenerating || !rangeForm.valid || getPreviewRange().length === 0" (click)="generateRange()">
            @if (isGenerating) {
            <span class="spinner-border spinner-border-sm me-2" role="status"></span>
            Generating...
            } @else {
            <i class="mdi mdi-auto-fix me-1"></i>Generate Serial Numbers
            }
          </button>
        </div>
      </div>

    </div>
  </div>
</div>
