<div class="container-fluid">
  <div class="row justify-content-center">
    <div class="col-12 col-lg-11 col-xl-10 col-xxl-9">
      
      <!-- Breadcrumb -->
      <nav aria-label="breadcrumb" class="mb-3">
        <ol class="breadcrumb mb-0">
          <li class="breadcrumb-item">
            <a href="#" class="text-decoration-none" (click)="$event.preventDefault(); goToSessions()">
              <i class="mdi mdi-home-outline me-1"></i>Training
            </a>
          </li>
          <li class="breadcrumb-item">
            <a href="#" class="text-decoration-none" (click)="$event.preventDefault(); goToSessions()">
              Training Sessions
            </a>
          </li>
          <li class="breadcrumb-item active" aria-current="page" *ngIf="session">
            {{ session.title }}
          </li>
          <li class="breadcrumb-item active" aria-current="page" *ngIf="!session">
            Attendance Dashboard
          </li>
        </ol>
      </nav>
      
      <!-- Page Header with Context -->
      <div class="mb-4">
        <div class="d-flex align-items-center justify-content-between mb-3">
          <div class="d-flex align-items-center">
            <div class="bg-primary bg-gradient rounded-circle me-3 d-flex align-items-center justify-content-center" style="width: 60px; height: 60px;">
              <i class="mdi mdi-clipboard-list text-white fs-4"></i>
            </div>
            <div>
              <h2 class="mb-1 text-primary">Attendance Dashboard</h2>
              <p class="text-muted mb-0" *ngIf="session">
                {{ session.title }} - {{ formatDate(session.date) }}
              </p>
              <p class="text-muted mb-0" *ngIf="!session">
                Track training session attendance and completion status
              </p>
            </div>
          </div>
          <div class="d-flex gap-2">
            <button 
              class="btn btn-outline-secondary" 
              (click)="refresh()"
              [disabled]="isLoading"
              title="Refresh attendance data">
              <i class="mdi mdi-refresh me-2" [class.mdi-spin]="isLoading"></i>Refresh
            </button>
            
            <button 
              class="btn btn-outline-primary" 
              (click)="exportAttendanceSheet()"
              *ngIf="session"
              title="Export attendance sheet">
              <i class="mdi mdi-download me-2"></i>Export
            </button>
            
            <button 
              class="btn btn-primary" 
              (click)="goToSignOff()"
              *ngIf="isSessionActive()"
              title="Go to sign-off page">
              <i class="mdi mdi-card-account-details me-2"></i>Sign Off
            </button>
            
            <button 
              class="btn btn-outline-secondary" 
              (click)="goToSessions()"
              title="Back to training sessions">
              <i class="mdi mdi-arrow-left me-2"></i>Back
            </button>
          </div>
        </div>
        
        <div class="alert alert-primary border-primary border-opacity-25 bg-primary bg-opacity-10" role="alert">
          <div class="d-flex align-items-start">
            <i class="mdi mdi-information text-primary me-3 mt-1 fs-5"></i>
            <div>
              <h6 class="alert-heading text-primary mb-2">Attendance Tracking</h6>
              <p class="mb-0">
                Monitor <strong>real-time attendance</strong> for training sessions. 
                Track completion rates, sign-off times, and attendance duration for comprehensive training records.
              </p>
            </div>
          </div>
        </div>
      </div>

  <!-- Loading State -->
  <div *ngIf="isLoading && !session" class="text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <div class="mt-2">Loading session data...</div>
  </div>

  <!-- Dashboard Content -->
  <div *ngIf="session" class="dashboard-content">
    
    <!-- Main Attendance Card -->
    <div class="card shadow-sm border-0">
      <div class="card-header bg-light">
        <div class="d-flex justify-content-between align-items-center">
          <h5 class="mb-0">
            <i class="mdi mdi-clipboard-list text-primary me-2"></i>
            {{ session.title }}
          </h5>
          <div class="session-status">
            <span [class]="getStatusClass()">{{ getSessionStatus() }}</span>
          </div>
        </div>
      </div>
      
      <div class="card-body">
        <!-- Session Info -->
        <div class="row mb-4">
          <div class="col-md-8">
            <div class="session-details">
              <div class="text-muted mb-2">
                <i class="mdi mdi-clock-outline me-1"></i>
                {{ formatTime(session.date + 'T' + session.startTime) }} - 
                {{ formatTime(session.date + 'T' + session.endTime) }}
              </div>
              <div class="text-muted mb-2">
                <i class="mdi mdi-map-marker-outline me-1"></i>
                {{ session.location }}
              </div>
              <div class="text-muted" *ngIf="session.description">
                <i class="mdi mdi-information-outline me-1"></i>
                {{ session.description }}
              </div>
            </div>
          </div>
          
          <div class="col-md-4 text-md-end">
            <div class="completion-metrics">
              <div class="h3 mb-0" [class]="getCompletionRateColor()">
                {{ getCompletionRate() }}%
              </div>
              <small class="text-muted">Completion Rate</small>
            </div>
          </div>
        </div>

        <hr class="my-4">

        <!-- Quick Stats -->
        <div class="row text-center mb-4" *ngIf="metrics">
          <div class="col-6 col-md-3">
            <div class="stat-item">
              <div class="stat-value text-primary">{{ metrics.totalExpected }}</div>
              <div class="stat-label">Expected</div>
            </div>
          </div>
          
          <div class="col-6 col-md-3">
            <div class="stat-item">
              <div class="stat-value text-success">{{ metrics.completedCount }}</div>
              <div class="stat-label">Completed</div>
            </div>
          </div>
          
          <div class="col-6 col-md-3">
            <div class="stat-item">
              <div class="stat-value text-warning">{{ metrics.totalExpected - metrics.completedCount }}</div>
              <div class="stat-label">Pending</div>
            </div>
          </div>
          
          <div class="col-6 col-md-3">
            <div class="stat-item">
              <div class="stat-value" [class]="getCompletionRateColor()">
                {{ getCompletionRate() }}%
              </div>
              <div class="stat-label">Attendance Rate</div>
            </div>
          </div>
        </div>

        <hr class="my-4">

        <!-- Controls -->
        <div class="controls-section mb-4">
          <div class="d-flex justify-content-between align-items-center flex-wrap gap-3">
            <!-- View Filters -->
            <div class="view-filters">
              <label class="form-label small text-muted mb-2 d-block">View:</label>
              <div class="btn-group" role="group">
                <input 
                  type="radio" 
                  class="btn-check" 
                  id="view-all" 
                  name="view" 
                  (change)="toggleView('all')"
                  [checked]="!showCompletedOnly && !showPendingOnly">
                <label class="btn btn-outline-secondary btn-sm" for="view-all">
                  All ({{ (completedAttendees.length + pendingAttendees.length) }})
                </label>

                <input 
                  type="radio" 
                  class="btn-check" 
                  id="view-completed" 
                  name="view" 
                  (change)="toggleView('completed')"
                  [checked]="showCompletedOnly">
                <label class="btn btn-outline-success btn-sm" for="view-completed">
                  Completed ({{ completedAttendees.length }})
                </label>

                <input 
                  type="radio" 
                  class="btn-check" 
                  id="view-pending" 
                  name="view" 
                  (change)="toggleView('pending')"
                  [checked]="showPendingOnly">
                <label class="btn btn-outline-warning btn-sm" for="view-pending">
                  Pending ({{ pendingAttendees.length }})
                </label>
              </div>
            </div>

            <!-- Sort Options -->
            <div class="sort-options">
              <label class="form-label small text-muted mb-2 d-block">Sort by:</label>
              <div class="btn-group" role="group">
                <button 
                  type="button" 
                  class="btn btn-outline-secondary btn-sm"
                  [class.active]="sortBy === 'name'"
                  (click)="setSortBy('name')">
                  Name
                  <i 
                    class="mdi mdi-sort-alphabetical-ascending ms-1" 
                    *ngIf="sortBy === 'name' && sortDirection === 'asc'"></i>
                  <i 
                    class="mdi mdi-sort-alphabetical-descending ms-1" 
                    *ngIf="sortBy === 'name' && sortDirection === 'desc'"></i>
                </button>
                
                <button 
                  type="button" 
                  class="btn btn-outline-secondary btn-sm"
                  [class.active]="sortBy === 'time'"
                  (click)="setSortBy('time')"
                  *ngIf="!showPendingOnly">
                  Time
                  <i 
                    class="mdi mdi-sort-numeric-ascending ms-1" 
                    *ngIf="sortBy === 'time' && sortDirection === 'asc'"></i>
                  <i 
                    class="mdi mdi-sort-numeric-descending ms-1" 
                    *ngIf="sortBy === 'time' && sortDirection === 'desc'"></i>
                </button>
                
                <button 
                  type="button" 
                  class="btn btn-outline-secondary btn-sm"
                  [class.active]="sortBy === 'department'"
                  (click)="setSortBy('department')">
                  Department
                  <i 
                    class="mdi mdi-sort-alphabetical-ascending ms-1" 
                    *ngIf="sortBy === 'department' && sortDirection === 'asc'"></i>
                  <i 
                    class="mdi mdi-sort-alphabetical-descending ms-1" 
                    *ngIf="sortBy === 'department' && sortDirection === 'desc'"></i>
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Completed Attendees Section -->
        <div class="attendees-section" *ngIf="getFilteredCompletedAttendees().length > 0">
          <div class="section-header d-flex justify-content-between align-items-center mb-3">
            <h6 class="mb-0">
              <i class="mdi mdi-check-circle text-success me-2"></i>
              Completed Sign-offs
            </h6>
            <span class="badge bg-success">{{ completedAttendees.length }}</span>
          </div>
          
          <div class="table-responsive">
            <table class="table table-hover mb-0">
              <thead class="table-light">
                <tr>
                  <th>Employee</th>
                  <th>Department</th>
                  <th>Sign-off Time</th>
                  <th>Duration</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let attendance of getFilteredCompletedAttendees()">
                  <td>
                    <div class="employee-info">
                      <div class="fw-medium">
                        {{ attendance.employee.firstName }} {{ attendance.employee.lastName }}
                      </div>
                      <small class="text-muted">{{ attendance.employee.title }}</small>
                    </div>
                  </td>
                  <td>
                    <span class="badge bg-light text-dark">
                      {{ attendance.employee.department }}
                    </span>
                  </td>
                  <td>
                    <div class="time-info">
                      <div>{{ formatTime(attendance.signInTime) }}</div>
                      <small class="text-muted">
                        {{ formatDate(attendance.signInTime) }}
                      </small>
                    </div>
                  </td>
                  <td>
                    <span 
                      class="badge"
                      [class.bg-success]="attendance.attendanceDuration >= session.durationMinutes"
                      [class.bg-warning]="attendance.attendanceDuration < session.durationMinutes">
                      {{ attendance.attendanceDuration }} min
                    </span>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Pending Attendees Section -->
        <div class="attendees-section" *ngIf="getFilteredPendingAttendees().length > 0" [class.mt-4]="getFilteredCompletedAttendees().length > 0">
          <div class="section-header d-flex justify-content-between align-items-center mb-3">
            <h6 class="mb-0">
              <i class="mdi mdi-clock-outline text-warning me-2"></i>
              Pending Sign-offs
            </h6>
            <span class="badge bg-warning">{{ pendingAttendees.length }}</span>
          </div>
          
          <div class="table-responsive">
            <table class="table table-hover mb-0">
              <thead class="table-light">
                <tr>
                  <th>Employee</th>
                  <th>Department</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let employee of getFilteredPendingAttendees()">
                  <td>
                    <div class="employee-info">
                      <div class="fw-medium">
                        {{ employee.firstName }} {{ employee.lastName }}
                      </div>
                      <small class="text-muted">{{ employee.title }}</small>
                    </div>
                  </td>
                  <td>
                    <span class="badge bg-light text-dark">
                      {{ employee.department }}
                    </span>
                  </td>
                  <td>
                    <span class="badge bg-warning">
                      <i class="mdi mdi-clock-outline me-1"></i>
                      Pending
                    </span>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Empty State -->
        <div 
          class="text-center py-5"
          *ngIf="!isLoading && completedAttendees.length === 0 && pendingAttendees.length === 0">
          <i class="mdi mdi-account-group text-muted" style="font-size: 4rem;"></i>
          <h5>No Attendees Found</h5>
          <p class="text-muted">
            No attendees have been assigned to this training session yet.
          </p>
          <button class="btn btn-primary" (click)="goToSessions()">
            Manage Sessions
          </button>
        </div>
      </div>
    </div>

  </div>

  <!-- Auto-refresh indicator -->
  <div class="auto-refresh-indicator" *ngIf="isSessionActive()">
    <small class="text-muted">
      <i class="mdi mdi-autorenew fa-spin me-1"></i>
      Auto-refreshing every {{ getRefreshInterval() }} seconds
    </small>
  </div>

    </div>
  </div>
</div>