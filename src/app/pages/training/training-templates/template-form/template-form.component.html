<div class="container-fluid">
  <div class="row justify-content-center">
    <div class="col-12 col-lg-11 col-xl-10 col-xxl-8">
      
      <!-- Breadcrumb -->
      <nav aria-label="breadcrumb" class="mb-3">
        <ol class="breadcrumb mb-0">
          <li class="breadcrumb-item">
            <a href="#" class="text-decoration-none" (click)="$event.preventDefault(); onCancel()">
              <i class="mdi mdi-home-outline me-1"></i>Training
            </a>
          </li>
          <li class="breadcrumb-item">
            <a href="#" class="text-decoration-none" (click)="$event.preventDefault(); onCancel()">
              Training Templates
            </a>
          </li>
          <li class="breadcrumb-item active" aria-current="page">
            {{ isEditMode ? 'Edit Template' : 'Create Template' }}
          </li>
        </ol>
      </nav>
      
      <!-- Page Header with Context -->
      <div class="mb-4">
        <div class="d-flex align-items-center mb-3">
          <button 
            type="button" 
            class="btn btn-outline-secondary me-3"
            (click)="onCancel()"
            [disabled]="isSaving"
            title="Back to Training Templates">
            <i class="mdi mdi-arrow-left me-2"></i>Back
          </button>
          <div class="bg-primary bg-gradient rounded-circle me-3 d-flex align-items-center justify-content-center" style="width: 60px; height: 60px;">
            <i class="mdi mdi-{{ isEditMode ? 'pencil' : 'plus' }} text-white fs-4"></i>
          </div>
          <div>
            <h2 class="mb-1 text-primary">{{ isEditMode ? 'Edit' : 'Create' }} Training Template</h2>
            <p class="text-muted mb-0">{{ isEditMode ? 'Update the training template details and settings' : 'Create a reusable training session template with predefined content' }}</p>
          </div>
        </div>
        
        <div class="alert alert-primary border-primary border-opacity-25 bg-primary bg-opacity-10" role="alert">
          <div class="d-flex align-items-start">
            <i class="mdi mdi-information-outline text-primary me-3 mt-1 fs-5"></i>
            <div>
              <h6 class="alert-heading text-primary mb-2">{{ isEditMode ? 'Updating Training Template' : 'Creating a New Training Template' }}</h6>
              <p class="mb-0">
                {{ isEditMode ? 'Modify template settings and content as needed.' : 'Template will be available for selection when creating training sessions.' }}
                <strong>Required fields</strong> ensure proper template functionality.
              </p>
            </div>
          </div>
        </div>
      </div>

      <ng-container *ngIf="!isLoading; else loadingTemplate">
        <div class="card shadow-sm border-0">
          <div class="card-body p-4">
            <form [formGroup]="templateForm" (ngSubmit)="onSubmit()">
              
              <!-- Basic Information Section -->
              <div class="mb-4">
                <h5 class="mb-3">
                  <i class="mdi mdi-information-outline me-2 text-primary"></i>Basic Information
                </h5>
                <div class="row">
                  <div class="col-md-8 mb-3">
                    <label for="name" class="form-label fw-semibold">Template Name *</label>
                    <input 
                      type="text" 
                      class="form-control"
                      [class.is-invalid]="isFieldInvalid('name')"
                      id="name"
                      formControlName="name"
                      placeholder="Enter a descriptive name for the template">
                    <div class="invalid-feedback" *ngIf="isFieldInvalid('name')">
                      {{ getFieldError('name') }}
                    </div>
                  </div>
                  
                  <div class="col-md-4 mb-3">
                    <label for="categoryId" class="form-label fw-semibold">Category *</label>
                    <select 
                      class="form-select"
                      [class.is-invalid]="isFieldInvalid('categoryId')"
                      id="categoryId"
                      formControlName="categoryId">
                      <option value="">Select a category</option>
                      <option *ngFor="let category of categories" [value]="category.id">
                        {{ category.name }}
                      </option>
                    </select>
                    <div class="invalid-feedback" *ngIf="isFieldInvalid('categoryId')">
                      {{ getFieldError('categoryId') }}
                    </div>
                  </div>
                </div>
                
                <div class="mb-3">
                  <label for="titleTemplate" class="form-label fw-semibold">Title Template *</label>
                  <input 
                    type="text" 
                    class="form-control"
                    [class.is-invalid]="isFieldInvalid('titleTemplate')"
                    id="titleTemplate"
                    formControlName="titleTemplate"
                    placeholder="e.g., Safety Training - {Topic}">
                  <div class="form-text">Use placeholders like {{ '{' }}Topic{{ '}' }}, {{ '{' }}Department{{ '}' }}, {{ '{' }}Date{{ '}' }} for dynamic content</div>
                  <div class="invalid-feedback" *ngIf="isFieldInvalid('titleTemplate')">
                    {{ getFieldError('titleTemplate') }}
                  </div>
                </div>

                <div class="mb-3">
                  <label for="descriptionTemplate" class="form-label fw-semibold">Description Template *</label>
                  <textarea 
                    class="form-control"
                    [class.is-invalid]="isFieldInvalid('descriptionTemplate')"
                    id="descriptionTemplate"
                    formControlName="descriptionTemplate"
                    rows="4"
                    placeholder="Enter a template description that will be used for training sessions..."></textarea>
                  <div class="invalid-feedback" *ngIf="isFieldInvalid('descriptionTemplate')">
                    {{ getFieldError('descriptionTemplate') }}
                  </div>
                </div>

                <div class="mb-3">
                  <label for="purposeTemplate" class="form-label fw-semibold">Purpose Template</label>
                  <input 
                    type="text" 
                    class="form-control"
                    id="purposeTemplate"
                    formControlName="purposeTemplate"
                    placeholder="e.g., Safety compliance, Skills development, Certification">
                  <div class="form-text">Optional: Define the primary purpose or objective</div>
                </div>
              </div>

              <hr class="my-4">

              <!-- Default Settings Section -->
              <div class="mb-4">
                <h5 class="mb-3">
                  <i class="mdi mdi-cog-outline me-2 text-primary"></i>Default Settings
                </h5>
                <div class="row">
                  <div class="col-md-4 mb-3">
                    <label for="defaultDurationMinutes" class="form-label fw-semibold">Default Duration (minutes) *</label>
                    <input 
                      type="number" 
                      class="form-control"
                      [class.is-invalid]="isFieldInvalid('defaultDurationMinutes')"
                      id="defaultDurationMinutes"
                      formControlName="defaultDurationMinutes"
                      min="15"
                      max="480"
                      placeholder="60">
                    <div class="invalid-feedback" *ngIf="isFieldInvalid('defaultDurationMinutes')">
                      {{ getFieldError('defaultDurationMinutes') }}
                    </div>
                  </div>
                  
                  <div class="col-md-8 mb-3">
                    <label for="defaultLocation" class="form-label fw-semibold">Default Location</label>
                    <input 
                      type="text" 
                      class="form-control"
                      id="defaultLocation"
                      formControlName="defaultLocation"
                      placeholder="e.g., Training Room A, Conference Room B">
                    <div class="form-text">Optional: Default location for sessions using this template</div>
                  </div>
                </div>
              </div>

              <hr class="my-4">

              <!-- Status Section -->
              <div class="mb-3">
                <h5 class="mb-3">
                  <i class="mdi mdi-toggle-switch me-2 text-primary"></i>Status
                </h5>
                <div class="form-check form-switch">
                  <input 
                    class="form-check-input" 
                    type="checkbox" 
                    role="switch" 
                    id="isActive"
                    formControlName="isActive">
                  <label class="form-check-label fw-semibold" for="isActive">
                    Active Template
                  </label>
                  <div class="form-text">Inactive templates won't appear in template selection</div>
                </div>
              </div>

              <!-- Form Actions -->
              <div class="d-flex justify-content-between align-items-center pt-4 mt-4 border-top">
                <button type="button" class="btn btn-outline-secondary" [disabled]="isSaving" (click)="onCancel()">
                  <i class="mdi mdi-close me-1"></i>Cancel
                </button>
                <button type="submit" class="btn btn-primary" [disabled]="templateForm.invalid || isSaving">
                  <span *ngIf="isSaving" class="spinner-border spinner-border-sm me-2" role="status"></span>
                  <i *ngIf="!isSaving" [class]="'mdi me-1 mdi-' + (isEditMode ? 'content-save' : 'check-circle-outline')"></i>
                  <span *ngIf="isSaving">{{ isEditMode ? 'Updating...' : 'Creating...' }}</span>
                  <span *ngIf="!isSaving">{{ isEditMode ? 'Update Template' : 'Create Template' }}</span>
                </button>
              </div>

            </form>
          </div>
        </div>
      </ng-container>

      <!-- Loading Template -->
      <ng-template #loadingTemplate>
        <div class="d-flex justify-content-center align-items-center py-5">
          <div class="text-center">
            <div class="spinner-border text-primary mb-3" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
            <p class="text-muted">Loading template...</p>
          </div>
        </div>
      </ng-template>
      
    </div>
  </div>
</div>