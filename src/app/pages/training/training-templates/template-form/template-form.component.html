<div class="container-fluid">
  <div class="row justify-content-center">
    <div class="col-12 col-xl-10">
      
      <!-- Breadcrumb -->
      <nav aria-label="breadcrumb" class="mb-3">
        <ol class="breadcrumb mb-0">
          <li class="breadcrumb-item">
            <a href="#" class="text-decoration-none" (click)="$event.preventDefault()">
              <i class="mdi mdi-home-outline me-1"></i>Training
            </a>
          </li>
          <li class="breadcrumb-item">
            <a href="#" class="text-decoration-none" (click)="$event.preventDefault()">
              Training Templates
            </a>
          </li>
          <li class="breadcrumb-item active" aria-current="page">
            {{ isEditMode ? 'Edit Template' : 'Create Template' }}
          </li>
        </ol>
      </nav>
      
      <!-- Page Header -->
      <div class="mb-4">
        <div class="d-flex align-items-center justify-content-between mb-3">
          <div class="d-flex align-items-center">
            <div class="bg-primary bg-gradient rounded-circle me-3 d-flex align-items-center justify-content-center" style="width: 60px; height: 60px;">
              <i class="mdi mdi-{{ isEditMode ? 'pencil' : 'plus' }} text-white fs-4"></i>
            </div>
            <div>
              <h2 class="mb-1 text-primary">{{ isEditMode ? 'Edit' : 'Create' }} Training Template</h2>
              <p class="text-muted mb-0">{{ isEditMode ? 'Update the training template details' : 'Create a reusable training session template' }}</p>
            </div>
          </div>
          <div class="d-flex gap-2">
            <button 
              type="button" 
              class="btn btn-outline-primary"
              (click)="onCancel()"
              [disabled]="isSaving">
              <i class="mdi mdi-arrow-left me-2"></i>Back to Templates
            </button>
          </div>
        </div>
      </div>

      <ng-container *ngIf="!isLoading; else loadingTemplate">
        <form [formGroup]="templateForm" (ngSubmit)="onSubmit()">
          <div class="row">
            <!-- Main Form Column -->
            <div class="col-lg-8">
              
              <!-- Basic Information Card -->
              <div class="card shadow-sm border-0 mb-4">
                <div class="card-header">
                  <h5 class="card-title mb-0">
                    <i class="mdi mdi-information-outline me-2"></i>Basic Information
                  </h5>
                </div>
                <div class="card-body">
                  <div class="row">
                    <div class="col-md-8 mb-3">
                      <label for="name" class="form-label fw-semibold">Template Name *</label>
                      <input 
                        type="text" 
                        class="form-control"
                        [class.is-invalid]="isFieldInvalid('name')"
                        id="name"
                        formControlName="name"
                        placeholder="Enter a descriptive name for the template">
                      <div class="invalid-feedback" *ngIf="isFieldInvalid('name')">
                        {{ getFieldError('name') }}
                      </div>
                    </div>
                    
                    <div class="col-md-4 mb-3">
                      <label for="categoryId" class="form-label fw-semibold">Category *</label>
                      <select 
                        class="form-select"
                        [class.is-invalid]="isFieldInvalid('categoryId')"
                        id="categoryId"
                        formControlName="categoryId">
                        <option value="">Select a category</option>
                        <option *ngFor="let category of categories" [value]="category.id">
                          {{ category.name }}
                        </option>
                      </select>
                      <div class="invalid-feedback" *ngIf="isFieldInvalid('categoryId')">
                        {{ getFieldError('categoryId') }}
                      </div>
                    </div>
                  </div>
                  
                  <div class="mb-3">
                    <label for="titleTemplate" class="form-label fw-semibold">Title Template *</label>
                    <input 
                      type="text" 
                      class="form-control"
                      [class.is-invalid]="isFieldInvalid('titleTemplate')"
                      id="titleTemplate"
                      formControlName="titleTemplate"
                      placeholder="Template for training session titles (e.g., '{topic} Training - {date}')">
                    <div class="invalid-feedback" *ngIf="isFieldInvalid('titleTemplate')">
                      {{ getFieldError('titleTemplate') }}
                    </div>
                    <div class="form-text">Use placeholders like {{ '{' }}topic{{ '}' }}, {{ '{' }}date{{ '}' }}, {{ '{' }}instructor{{ '}' }} for dynamic content</div>
                  </div>
                  
                  <div class="mb-3">
                    <label for="descriptionTemplate" class="form-label fw-semibold">Description Template *</label>
                    <textarea 
                      class="form-control"
                      [class.is-invalid]="isFieldInvalid('descriptionTemplate')"
                      id="descriptionTemplate"
                      formControlName="descriptionTemplate"
                      rows="4"
                      placeholder="Template for training session descriptions..."></textarea>
                    <div class="invalid-feedback" *ngIf="isFieldInvalid('descriptionTemplate')">
                      {{ getFieldError('descriptionTemplate') }}
                    </div>
                  </div>
                  
                  <div class="mb-3">
                    <label for="purposeTemplate" class="form-label fw-semibold">Purpose Template *</label>
                    <textarea 
                      class="form-control"
                      [class.is-invalid]="isFieldInvalid('purposeTemplate')"
                      id="purposeTemplate"
                      formControlName="purposeTemplate"
                      rows="3"
                      placeholder="Template for training session purpose and objectives..."></textarea>
                    <div class="invalid-feedback" *ngIf="isFieldInvalid('purposeTemplate')">
                      {{ getFieldError('purposeTemplate') }}
                    </div>
                  </div>
                  
                  <div class="row">
                    <div class="col-md-6 mb-3">
                      <label for="defaultDurationMinutes" class="form-label fw-semibold">Default Duration (minutes) *</label>
                      <select 
                        class="form-select"
                        [class.is-invalid]="isFieldInvalid('defaultDurationMinutes')"
                        id="defaultDurationMinutes"
                        formControlName="defaultDurationMinutes">
                        <option *ngFor="let option of durationOptions" [value]="option.value">
                          {{ option.label }}
                        </option>
                      </select>
                      <div class="invalid-feedback" *ngIf="isFieldInvalid('defaultDurationMinutes')">
                        {{ getFieldError('defaultDurationMinutes') }}
                      </div>
                    </div>
                    
                    <div class="col-md-6 mb-3">
                      <label for="defaultLocation" class="form-label fw-semibold">Default Location</label>
                      <input 
                        type="text" 
                        class="form-control"
                        id="defaultLocation"
                        formControlName="defaultLocation"
                        placeholder="Conference Room A, Online, etc. (optional)">
                      <div class="form-text">Leave empty if location varies by session</div>
                    </div>
                  </div>
                </div>
              </div>
              
            </div>

            <!-- Sidebar Column -->
            <div class="col-lg-4">
              
              <!-- Template Settings Card -->
              <div class="card shadow-sm border-0 mb-4">
                <div class="card-header">
                  <h6 class="card-title mb-0">
                    <i class="mdi mdi-cog-outline me-2"></i>Template Settings
                  </h6>
                </div>
                <div class="card-body">
                  <div class="form-check form-switch mb-3">
                    <input 
                      class="form-check-input" 
                      type="checkbox" 
                      id="isActive"
                      formControlName="isActive">
                    <label class="form-check-label" for="isActive">
                      Active Template
                    </label>
                    <div class="form-text">Inactive templates won't appear in template selection</div>
                  </div>
                </div>
              </div>

              <!-- Form Actions Card -->
              <div class="card shadow-sm border-0">
                <div class="card-body">
                  <div class="d-grid gap-2">
                    <button 
                      type="submit" 
                      class="btn btn-primary"
                      [disabled]="templateForm.invalid || isSaving">
                      <span *ngIf="isSaving" class="spinner-border spinner-border-sm me-2" role="status"></span>
                      <i class="mdi mdi-content-save me-2" *ngIf="!isSaving"></i>
                      {{ isSaving ? 'Saving...' : (isEditMode ? 'Update Template' : 'Create Template') }}
                    </button>
                    
                    <button 
                      type="button" 
                      class="btn btn-outline-primary"
                      (click)="onCancel()"
                      [disabled]="isSaving">
                      <i class="mdi mdi-close me-2"></i>Cancel
                    </button>
                  </div>
                  
                  <div class="mt-3 text-center">
                    <small class="text-muted">
                      * Required fields
                    </small>
                  </div>
                </div>
              </div>
              
            </div>
          </div>
        </form>
      </ng-container>

      <!-- Loading Template -->
      <ng-template #loadingTemplate>
        <div class="d-flex justify-content-center align-items-center py-5">
          <div class="text-center">
            <div class="spinner-border text-primary mb-3" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
            <p class="text-muted">Loading template...</p>
          </div>
        </div>
      </ng-template>
      
    </div>
  </div>
</div>